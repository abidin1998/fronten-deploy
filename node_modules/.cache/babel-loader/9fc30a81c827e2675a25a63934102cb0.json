{"ast":null,"code":"/* START OF FILE - core.js */\n\n/**\r\n * @class Riot\r\n * @singleton\r\n * The global riot games namespace.\r\n */\n\n/**\r\n * @class Riot.DDragon\r\n * @singleton\r\n * The global Data Dragon class.\r\n */\n\n/**\r\n * @class Riot.DDragon.fn\r\n * @singleton\r\n * An object used to store all static utility function.\r\n */\nRiot.DDragon.fn = {};\nRiot.DDragon.dataTypes = ['item', 'champion', 'mastery', 'rune', 'summoner', 'language'];\n\n(function () {\n  var rg = Riot,\n      dd = rg.DDragon,\n      fn = dd.fn;\n\n  fn.isArray = function (item) {\n    return Object.prototype.toString.call(item) === '[object Array]';\n  };\n  /**\r\n   * @method\r\n   * This requires the ajax functions within loader.js. This simplifies and attaches the functions\r\n   * together but targets the data to json packets only.\r\n   * @param {String} file The file to load.\r\n   * @param {Function} callback The callback function to execute when the data is returned.\r\n   */\n\n\n  fn.getJSON = function (file, c) {\n    if (dd.xhr.ready) {\n      dd.xhr.load(file, function (data) {\n        c(JSON.parse(data));\n      });\n    } else {\n      var m = /([A-Za-z0-9]+)\\.json/.exec(file);\n\n      window['rg_data_callback_' + m[1]] = function (data) {\n        c(data);\n      };\n\n      dd.jsonp(file + 'p');\n    }\n  };\n  /** \r\n   * @method\r\n   * Attaches a new stylesheet to the page.\r\n   * @param {String} file The url to the desired stylesheet.\r\n   */\n\n\n  fn.getCSS = function (file) {\n    var s = document.createElement('link');\n    s.rel = 'stylesheet';\n    s.type = 'text/css';\n    s.href = file;\n    fn.$('head', true)[0].appendChild(s);\n  };\n  /**\r\n   * @method\r\n   * This merges each argument after data 'under' the data object effectively treating each\r\n   * additional object passed as a default to the one before it.\r\n   * \tfunction myFunc (config) {\r\n   * \t\tconfig = rg.dd.fn.rebase(config, {\r\n   * \t\t\tconditions: true,\r\n   * \t\t\tactions: true\r\n   * \t\t});\r\n   * \t\r\n   * \t\tif (config.conditions) {\r\n   * \t\t\tconsole.log('Conditions Run!');\r\n   * \t\t}\r\n   * \t\r\n   * \t\tif (config.actions) {\r\n   * \t\t\tconsole.log('Actions Run!');\r\n   * \t\t}\r\n   * \t}\r\n   * \t\r\n   * \tmyFunc({\r\n   * \t\tconditions: false\r\n   * \t});\r\n   * \t\r\n   * \t//logs 'Actions Run!'\r\n   * @param {Object} data The base object being merged into.\r\n   * @param {Object...} under The objects used to default the base data object.\r\n   * @return {Object} The merged object.\r\n   */\n\n\n  fn.rebase = function (data) {\n    var i = 0,\n        j = arguments.length,\n        under,\n        prop,\n        type;\n\n    while (++i < j) {\n      under = arguments[i];\n\n      for (prop in under) {\n        if (under.hasOwnProperty(prop)) {\n          type = typeof under[prop]; // We add base to that prop, since it's missing\n\n          if (typeof data[prop] === 'undefined') {\n            if (type === 'object') {\n              fn.rebase(data[prop] = fn.isArray(under[prop]) ? [] : {}, under[prop]);\n            } else {\n              data[prop] = under[prop];\n            }\n          } else {\n            // We only extend it further when dealing with objects / Arrays\n            if (type === 'object' && !(typeof data[prop] === 'function')) {\n              fn.rebase(data[prop], under[prop]);\n            }\n          }\n        }\n      }\n    }\n\n    return data;\n  };\n  /**\r\n   * @method\r\n   * This takes a base object and crawls up its heirarchy using path. Path is period delimited as\r\n   * a normal object path.\r\n   * \tvar myObj = {\r\n   * \t\tstuff: {\r\n   * \t\t\tbox: {\r\n   * \t\t\t\tcolor: 'red'\r\n   * \t\t\t},\r\n   * \t\t\tsocks: true\r\n   * \t\t},\r\n   * \t\tmoves: false\r\n   * \t};\r\n   * \t\r\n   * \trg.dd.fn.objectDig(myObj, 'stuff.box.color'); //returns 'red'\r\n   * \trg.dd.fn.objectDig(myObj, 'stuff.box.contents'); //returns false\r\n   * @param {Object} obj The object to traverse.\r\n   * @param {String} path The path to the desired value.\r\n   * @return {Object}\r\n   * The value of the item the path points to. Returns null if the path cannot be followed.\r\n   */\n\n\n  fn.objectDig = function (obj, path) {\n    var i, j;\n\n    if (typeof obj === 'undefined') {\n      return null;\n    }\n\n    if (typeof path === 'undefined') {\n      return null;\n    }\n\n    if (path.indexOf('.') !== -1) {\n      path = path.split('.');\n\n      for (i = 0, j = path.length; i < j; i++) {\n        if (typeof obj[path[i]] === 'undefined') {\n          return null;\n        }\n\n        obj = obj[path[i]];\n      }\n\n      return obj;\n    } else {\n      return obj[path];\n    }\n  };\n  /** \r\n   * @method\r\n   * Executes the specified opperation on a and b and returns the result.\r\n   * \trg.dd.fn.sMath(1, '+', 2); //returns 3\r\n   * \trg.dd.fn.sMath(2, '/', 2); //returns 1\r\n   * \trg.dd.fn.sMath('hello world!', '->', 'world'); //returns true\r\n   * @param {Number/String} a The first parameter.\r\n   * @param {String} op The operation to perform. The available operations are:\r\n   * =. ==, ===, !=, !==, >, >=, <, <=, +, -, /, *, %, and ->. Most of these are self\r\n   * explanatory, however the \"->\" operation checks to see if the first parameter contains the second parameter.\r\n   * @param {Number/String} b The second parameter.\r\n   */\n  // This is significantly faster than causing the javascript interpreter to do the work\n\n\n  fn.sMath = function (a, op, b) {\n    switch (op) {\n      case '=':\n      case '==':\n      case '===':\n        return a == b;\n\n      case '!=':\n      case '!==':\n        return a != b;\n\n      case '>':\n        return a > b;\n\n      case '<':\n        return a < b;\n\n      case '>=':\n        return a >= b;\n\n      case '<=':\n        return a <= b;\n\n      case '+':\n        return a + b;\n\n      case '-':\n        return a - b;\n\n      case '/':\n        return a / b;\n\n      case '*':\n        return a * b;\n\n      case '%':\n        return a % b;\n\n      case '->':\n        return a.indexOf(b) !== -1;\n\n      default:\n        return false;\n    }\n  };\n  /**\r\n   * @method\r\n   * Creates a div element.\r\n   * @param {Object} [options] The options object.\r\n   * @param {String} [options.classes] The classes to apply to the div.\r\n   * @param {String} [options.style] The styles to apply to the div.\r\n   * @param {HTMLElement} [options.append] The parent element the div should be appended to.\r\n   * @param {Object} [options.data] A set of key value pairs used to define data attributes.\r\n   * @return {HTMLElement} The created div.\r\n   */\n\n\n  fn.mkDiv = function (options) {\n    var r = document.createElement('div'),\n        i,\n        j;\n\n    if (typeof options === 'object') {\n      if (typeof options.classes === 'string') {\n        r.className = options.classes;\n      }\n\n      if (typeof options.style === 'string') {\n        r.style.cssText = options.style;\n      }\n\n      if (typeof options.append !== 'undefined') {\n        options.append.appendChild(r);\n      }\n\n      if (typeof options.data === 'object') {\n        for (i = 0, j = options.data.length; i < j; i++) {\n          r.setAttribute('data-' + options.data[i].k, options.data[i].v);\n        }\n      }\n    }\n\n    return r;\n  };\n  /**\r\n   * @method\r\n   * Removes the specified element. Internally this is only used on created divs.\r\n   * @param {HTMLElement} div The element to remove.\r\n   */\n\n\n  fn.rmDiv = function (div) {\n    div.parentNode.removeChild(div);\n  };\n  /** \r\n   * @method\r\n   * Checks to see if the specified text contains the given word.\r\n   * @param {String} text The text to search.\r\n   * @param {String} word The word to search for.\r\n   * @return {Boolean} Whether the word was found or not.\r\n   */\n\n\n  fn.hasWord = function (text, word) {\n    return new RegExp(\"(?:^|\\\\s)\" + word + \"(?!\\\\S)\", 'g').test(text);\n  };\n  /**\r\n   * @method\r\n   * Removes the given word from the specified text.\r\n   * @param {String} text The text to search.\r\n   * @param {String} word The word to remove.\r\n   * @return {String} The resulting text.\r\n   */\n\n\n  fn.removeWord = function (text, word) {\n    return text.replace(new RegExp(\"(?:^|\\\\s)\" + word + \"(?!\\\\S)\", 'g'), '');\n  };\n  /** \r\n   * @method\r\n   * Checks to see if the specified text contains the given word preceding an equals and a value.\r\n   * @param {String} text The text to search.\r\n   * @param {String} word The word to search for.\r\n   * @return {Object/Boolean} Returns either false or the resulting value\r\n   */\n\n\n  fn.hasValue = function (text, word) {\n    var reg = new RegExp(\"(?:^|\\\\s)\" + word + \"=([^\\\\s\\\\t\\\\n]*)(?!\\\\S)\"),\n        m;\n\n    if (m = reg.exec(text)) {\n      return m[1];\n    } else {\n      return false;\n    }\n  };\n  /**\r\n   * @method\r\n   * Removes the given word=value from the specified text.\r\n   * @param {String} text The text to search.\r\n   * @param {String} word The word to remove.\r\n   * @return {String} The resulting text.\r\n   */\n\n\n  fn.removeValue = function (text, word) {\n    return text.replace(new RegExp(\"(?:^|\\\\s)\" + word + \"=([^\\\\s\\\\t\\\\n]*)(?!\\\\S)\", 'g'), '');\n  };\n  /**\r\n   * @method\r\n   * Detects if the specified element has the given class.\r\n   * @param {HTMLElement} elem The element to check.\r\n   * @param {String} className The class to search for.\r\n   * @return {Boolean} Whether the class was found or not.\r\n   */\n\n\n  fn.hasClass = function (elem, class_) {\n    return fn.hasWord(elem.className, class_);\n  };\n  /** \r\n   * @method\r\n   * Adds the given class to the specified element.\r\n   * @param {HTMLElement} elem The element to add to.\r\n   * @param {String} className The class to add.\r\n   */\n\n\n  fn.addClass = function (elem, class_) {\n    elem.className += ' ' + class_;\n  };\n  /**\r\n   * @method\r\n   * Removes the specified class from the element.\r\n   * @param {HTMLElement} elem The element to remove the class from.\r\n   * @param {String} className The class to remove.\r\n   */\n\n\n  fn.removeClass = function (elem, className) {\n    elem.className = fn.removeWord(elem.className, className);\n  };\n  /**\r\n   * @method\r\n   * Removes a class from all siblings and adds it to the element\r\n   * @param {HTMLElement} elem The element to add the class to.\r\n   * @param {String} className The class to add to the element.\r\n   */\n\n\n  fn.radioClass = function (elem, className) {\n    var children = elem.parentNode.childNodes,\n        i = children.length;\n\n    while (i--) {\n      if (children[i].className) {\n        fn.removeClass(children[i], className);\n      }\n    }\n\n    fn.addClass(elem, className);\n  };\n  /**\r\n   * @method\r\n   * Retrieves a duplicate of the given element's childNodes. This verson will not auto update\r\n   * when the element's childNodes change.\r\n   * @param {HTMLElement} elem The element to pull childNodes from.\r\n   * @return {HTMLElement[]} A non living duplicate of the element's childNodes.\r\n   */\n\n\n  fn.deadChildren = function (elem) {\n    if (elem.hasChildNodes()) {\n      var children = elem.childNodes,\n          dead = [],\n          i,\n          length;\n\n      for (i = 0, length = children.length; i < length; i = i + 1) {\n        dead.push(children[i]);\n      }\n\n      return dead;\n    }\n\n    return [];\n  }; // Internals used for templating\n\n\n  var twigVarReg = /{{ (.+?) }}/;\n  /** \r\n   * @method\r\n   * Does a simple token replacement on the given template.\r\n   * @param {String/String[]} template The template that will be the subject of the replacement.\r\n   * @param {Object} data The key / value pairs to be substituded.\r\n   * @return {String} The resulting string.\r\n   */\n\n  fn.format = function (template, data) {\n    if (fn.isArray(template)) {\n      template = template.join('');\n    }\n\n    var twigMatch;\n\n    while (twigMatch = twigVarReg.exec(template)) {\n      template = template.replace(twigVarReg, fn.objectDig(data, twigMatch[1]));\n    }\n\n    return template;\n  };\n  /**\r\n   * @method\r\n   * Itterates over the given array, executing the supplied function on each. If the function\r\n   * ever returns false, the itteration will stop.\r\n   * @param {Array} arr The array to be itterated over.\r\n   * @param {Function} func The function to be executed.\r\n   */\n\n\n  fn.each = function (arr, func) {\n    if (!fn.isArray(arr)) {\n      func(arr, 0);\n      return;\n    }\n\n    for (var i = 0, length = arr.length; i < length; i = i + 1) {\n      if (func(arr[i], i) === false) {\n        return;\n      }\n    }\n  };\n  /**\r\n   * @method\r\n   * Retrieves data from an element. This doesn't have the permission controls that\r\n   * {@link #rgInfo} has so be careful when using it.\r\n   * @param {HTMLElement} elem The element to pull data off of.\r\n   * @param {String} attr The name of the attribute to pull data from.\r\n   * @return {String} The data pulled. If the data is not found, false will be returned.\r\n   */\n\n\n  fn.rgData = function (elem, attr) {\n    var r = elem.getAttribute('data-rg-' + attr);\n    return r === null || r === '' ? false : r;\n  }; // Retrieves a data object, representing the most common rg data types\n\n  /**\r\n   * @method\r\n   * Retrieves the data attribute from an element tree. This will bubble up the DOM until either the depth is\r\n   * reached, or the data is found.\r\n   * @param {HTMLElement} elem The element to pull data off of.\r\n   * @param {Number} depth The maxiumum bubble depth.\r\n   * @return {Object} data The data pulled. If the data is not found, false will be returned.\r\n   * @return {String} data.name The rgData for name.\r\n   * @return {String} data.id The rgData for id.\r\n   * @return {String} data.aux The rgData for aux.\r\n   */\n\n\n  fn.rgInfo = function (elem, depth) {\n    var r;\n\n    while (depth) {\n      // This catches element permission problems\n      try {\n        r = elem.getAttribute('data');\n      } catch (e) {\n        return false;\n      }\n\n      r = {\n        name: fn.rgData(elem, 'name'),\n        id: fn.rgData(elem, 'id'),\n        aux: fn.rgData(elem, 'aux')\n      };\n      r = r.name === false && r.id === false && r.aux === false ? false : r;\n\n      if (r !== false) {\n        return r;\n      }\n\n      if (--depth) {\n        elem = elem.parentNode;\n      }\n    }\n\n    return r;\n  };\n  /** \r\n   * @method\r\n   * Creates a test object to be used with {@link #runTest}. This will convert comparison strings\r\n   * into something that runTest can rapidly check.\r\n   * @param {String} testString The string that needs to be converted into a test.\r\n   * testString is normally structured as \"(type)(path)(operator)(compareValue)(|...)\"\r\n   * (type) is either \"!\" or empty. If it's \"!\", then the return is inversed.\r\n   * (path) is an objectDig path. {@link #objectDig}\r\n   * (operator) is either a regex operator (*=, ^=, or $=) or a sMath operator {@link #sMath}\r\n   * (compareValue) is the value to compare or use for the operation\r\n   * (|...) multiple tests can be \"or\"ed over a single bar. Each additional test uses the same\r\n   * format as before. runTest will run them all and return true if any return true.\r\n   * @return {Object} The resulting test object, or false if the object could not be created.\r\n   */\n\n\n  fn.makeTest = function (testString) {\n    var testMatch, testObject; // Blank strings autosucceed\n\n    if (testString == '') {\n      return true;\n    }\n\n    if (testMatch = /^(\\!?)([a-zA-Z][a-zA-Z0-9\\.]*)(\\->|\\*=|\\^=|\\$=|===|==|=|<=|<|>=|>|\\+|\\-|\\*|\\/|%)?([^\\|]*)?(\\|.+)?$/.exec(testString)) {\n      // Create the basic test object and determine if there's an inversion on it\n      testObject = {\n        'key': testMatch[2],\n        'inv': testMatch[1] === '!'\n      }; // If there's no op to compare with, we only check for the existence of the given key\n\n      if (typeof testMatch[3] === 'undefined') {\n        testObject.det = 1;\n      } else {\n        if (typeof testMatch[4] === 'undefined') {\n          testMatch[4] = '';\n        } // The regexs can fail at creation. We need to catch this and fail gracefully\n\n\n        try {\n          // Switch among the various possibilities for the operator\n          switch (testMatch[3]) {\n            // Regular Expression Digs\n            case '*=':\n              testObject.det = 2;\n              testObject.reg = new RegExp(testMatch[4], 'i');\n              break;\n\n            case '^=':\n              testObject.det = 2;\n              testObject.reg = new RegExp('^' + testMatch[4], 'i');\n              break;\n\n            case '$=':\n              testObject.det = 2;\n              testObject.reg = new RegExp(testMatch[4] + '$', 'i');\n              break;\n            // We don't let this fall to default in order to avoid .test errors against arrays\n\n            case '->':\n              testObject.det = 3;\n              testObject.evOp = '->';\n              testObject.evVs = testMatch[4];\n              break;\n            // Basic math digs\n\n            default:\n              testObject.det = 3;\n              testObject.evOp = testMatch[3]; // If there is something other than basic numbers, we don't parse it in to a number\n              // This is just in case there might be a case of \"string=string\"\n\n              if (/[^0-9\\.]/.test(testMatch[4]) || testMatch[4] === '') {\n                testObject.evVs = testMatch[4];\n              } else {\n                testObject.evVs = parseFloat(testMatch[4]);\n              }\n\n              break;\n          }\n        } catch (e) {\n          testObject = false;\n        }\n      } // Or Series\n\n\n      if (testMatch[5]) {\n        testObject.or = fn.makeTest(testMatch[5].substring(1));\n      } // Return\n\n\n      return testObject;\n    } // Long lists of test strings also always succeed.\n    // In expected cases, this shouldn't happen often (which is why it rests after the major brunt of the test making)\n\n\n    if (/^\\s+$/.test(testString)) {\n      return true;\n    }\n\n    return false;\n  };\n  /**\r\n   * @method\r\n   * Executes a test provided by {@link Riot.DDragon.fn#makeTest} on the given data.\r\n   * @param {Object} data The data to be tested.\r\n   * @param {Object} test The test object to be executed.\r\n   * @return {Boolean} Whether the test was successful or not.\r\n   */\n\n\n  fn.runTest = function (data, test) {\n    function testReturn(result) {\n      if (test.inv) {\n        result = !result;\n      } // Test if there's an or. If there is, and the result is still false, we keep going til we get a true\n\n\n      if (test.or && result === false) {\n        return result || fn.runTest(data, test.or);\n      }\n\n      return result;\n    } // Sometimes tests can just be definitively true or false\n\n\n    if (typeof test === 'boolean') {\n      return test;\n    }\n\n    var dataPiece = fn.objectDig(data, test.key); // If there was bad data digging, we end here\n\n    if (dataPiece === null) return testReturn(false); // There are 3 different types of tests\n    // 2 and 3 are subject to user input error, so we need to fail gracefully in those cases\n\n    try {\n      switch (test.det) {\n        // This detects if the key value simply exists\n        // Since that test is actually required before this point, we need to do nothing.\n        case 1:\n          return testReturn(true);\n        // This tests a regular expression\n\n        case 2:\n          return testReturn(test.reg.test(dataPiece));\n          break;\n        // This math tests the code\n\n        case 3:\n          return testReturn(fn.sMath(dataPiece, test.evOp, test.evVs));\n          break;\n      }\n    } catch (e) {\n      return testReturn(false);\n    } // If it somehow gets here, something really bad happend. Test failed\n\n\n    return testReturn(false);\n  }; // Minor worker function for getImg and sizing\n\n\n  function getImgSize(val, size) {\n    switch (size) {\n      default:\n      case 'normal':\n        return val;\n\n      case 'small':\n        return parseInt(val * 0.75);\n\n      case 'tiny':\n        return parseInt(val * 0.5);\n    }\n  }\n  /**\r\n   * @method\r\n   * Builds an image from the passed object. The object requires a dragontail formatted image\r\n   * property.\r\n   * @param {Object} obj The data object to build the image off of.\r\n   * @param {Object} options The configuration object for the image.\r\n   * @param {String} [options.src='sprite']\r\n   * The source of the image desired. Can be sprite, full, loading, or splash.\r\n   * @param {String} [options.version=''] The version of the data to pull the image from.\r\n   * @param {String} [options.group=''] The group to pull the image from.\r\n   * @param {String} [options.cap=''] The image file name.\r\n   * @param {Number} [options.wrap=2]\r\n   * The wrap level for the image. 2 places a ful html wrapper around it (<div> or <img). 1 is for\r\n   * sprites only and just places the rest of the sprite styling with it.\r\n   * @param {String} [options.classes=''] Any additional classes to add to the wrapper.\r\n   * @param {String} [options.attrs=''] Any additional attributes to add to the wrapper.\r\n   * @param {Number} [options.skin=0] Default skin number to use for loading and splash images (limited use).\r\n   * @param {Boolean} [options.gray=false] Whether or not to use a grayscale version of the image (limited use).\r\n   * @param {String} [options.size=normal] Which sprite size we should use. Options are normal, small (36x36) and tiny (24x24)\r\n   * @return {String} The generated image html.\r\n   */\n\n\n  fn.getImg = function (obj, options) {\n    if (!obj.image) {\n      return '<span data-rg-error=\"getImg(' + obj.id + ')\"></span>';\n    }\n\n    var img = obj.image,\n        // Defaults\n    basic = {\n      src: 'sprite',\n      path: '',\n      version: '',\n      group: '',\n      cap: '',\n      // Wrap is a \"level\" of ways to wrap the result\n      // 2 places a full html wrapper around it (<div> or <img>)\n      // 1 is for sprites only and just places the rest of the sprite styling with it.\n      wrap: 2,\n      // Classes to add to the wrap\n      classes: '',\n      // Attributes to add to the wrap\n      attrs: '',\n      // Skin number (for loading and splash)\n      skin: 0,\n      // Can opt to use grayscale versions\n      gray: false,\n      // Sprite sizes\n      size: 'normal'\n    },\n        // Pre and Post are used to construct wrappers\n    pre = '',\n        post = '';\n\n    if (typeof options !== 'object') {\n      var options = basic;\n    } else {\n      options = fn.rebase(options, basic);\n    } // Individual objects may have their own versioning\n\n\n    if (typeof obj.version === 'string') {\n      options.version = obj.version + '/';\n    } else if (options.version !== '') {\n      options.version += '/';\n    } // The different pathing constructs based on src\n\n\n    switch (options.src) {\n      case 'sprite':\n        options.group = 'sprite';\n        options.cap = img.sprite;\n\n        if (options.wrap > 0) {\n          pre = 'height:' + getImgSize(img.h, options.size) + 'px; width:' + getImgSize(img.w, options.size) + 'px; background: url(\\'';\n          post = '\\') -' + getImgSize(img.x, options.size) + 'px -' + getImgSize(img.y, options.size) + 'px no-repeat;';\n\n          if (options.wrap > 1) {\n            pre = '<div class=\"img ' + options.classes + '\" style=\"' + pre;\n            post = post + '\" ' + options.attrs + '></div>';\n          }\n        }\n\n        break;\n\n      case 'full':\n        options.group = img.group;\n        options.cap = img.full;\n\n        if (options.wrap > 1) {\n          pre = '<img class=\"' + options.classes + '\" src=\"';\n          post = '\" ' + options.attrs + ' />';\n        }\n\n        break;\n\n      case 'loading':\n        options.group = img.group + '/loading';\n\n      case 'splash':\n        if (options.group === '') {\n          options.group = img.group + '/splash';\n        }\n\n        options.version = '';\n        options.cap = obj.id + '_' + options.skin + '.jpg';\n\n        if (options.wrap > 1) {\n          pre = '<img class=\"' + options.classes + '\" src=\"';\n          post = '\" ' + options.attrs + ' />';\n        }\n\n        break;\n    }\n\n    if (options.gray) {\n      options.cap = 'gray_' + options.cap;\n    }\n\n    if (options.size !== 'normal') {\n      options.cap = options.size + '_' + options.cap;\n    } // The full construct:\n    // cdn version / img / (path?) group / cap\n\n\n    return pre + dd.m.cdn + options.version + 'img/' + options.path + options.group + '/' + options.cap + post;\n  };\n  /**\r\n   * Selects elements based on a class name, starting from an optional point in the DOM\r\n   * @param {String} class The class name to hunt for\r\n   * @param {HTMLElement} context The optional element to search from\r\n   * @return {HTMLElement[]} The selected elements.\r\n   */\n\n\n  fn.getElementsByClassName = function () {\n    var body = document.getElementsByTagName('body')[0];\n\n    if (document.getElementsByClassName) {\n      return function (className, context) {\n        context = context || body;\n        return context.getElementsByClassName(className);\n      };\n    } else {\n      return function (className, context) {\n        context = context || body;\n        var elems = context.getElementsByTagName('*'),\n            i,\n            j,\n            el,\n            r = [];\n\n        for (i = 0, j = elems.length; i < j; ++i) {\n          el = elems[i];\n\n          if (fn.hasClass(el, className)) {\n            r.push(el);\n          }\n        }\n\n        return r;\n      };\n    }\n  }(); // This is the caching area for fn.$\n\n\n  dd.fn$data = {};\n  /**\r\n   * A mappable selector function. The default is a very very simple selector service.\r\n   * @param {String} selector The selector string.\r\n   * @param {HTMLElement} context The root element to start the selection from.\r\n   * @return {HTMLElement[]} The selected elements.\r\n   */\n\n  dd.fn$serve = function (selector, context) {\n    var context = context || document,\n        h;\n\n    switch (selector.charAt(0)) {\n      case '#':\n        h = context.getElementById(selector.substring(1));\n        if (h === null) return [];\n        return [h];\n\n      case '.':\n        return fn.getElementsByClassName(selector.substring(1), context);\n\n      default:\n        return context.getElementsByTagName(selector);\n    }\n  };\n  /**\r\n   * @method\r\n   * Executes the given selector returning the result. Also gives the option of caching the\r\n   * result.\r\n   * @param {String} selector The selector string.\r\n   * @param {boolean} preselect Whether or not to cache the results.\r\n   * @return {HTMLElement[]} The selected elements.\r\n   */\n\n\n  fn.$ = function (selector, preselect) {\n    var target;\n\n    if (preselect) {\n      target = dd.fn$data[selector];\n    }\n\n    if (typeof target === 'undefined') {\n      target = dd.fn$serve(selector);\n\n      if (preselect) {\n        dd.fn$data[selector] = target;\n      }\n    }\n\n    return target;\n  }; // Error facing\n\n\n  fn.er = function (error, loc, message) {\n    var e = 'ERROR: ' + message + ' at [ddragon.' + loc + ']';\n\n    if (typeof console !== 'undefined' && typeof console.log !== 'undefined') {\n      console.log(e);\n    }\n\n    setTimeout(function () {\n      throw error;\n    }, 1);\n    return '<p><b>' + e + '</b></p>';\n  };\n  /**\r\n   * @method\r\n   * This is based on Dean Edward's event bind system but has been mutilated heavily. The actual\r\n   * event passed around by it is a partially normalized wrapper.\r\n   * @param {HTMLElement} element The element to attach an event to.\r\n   * @param {String} type The event type to listen for.\r\n   * @param {Function} callback The function to call when the event fires.\r\n   * @return {Function} The generated handler.\r\n   */\n\n\n  fn.addEvent = function (element, type, callback) {\n    if (typeof element === 'string') {\n      element = fn.$(element)[0];\n    } // create a hash table of event types for the element, as well event type data\n\n\n    if (!element.events) element.events = {}; // The real handler\n\n    function handler(event) {\n      var data = {\n        target: fixEvent.windowTarget ? event.srcElement : event.target,\n        event: event,\n        type: type,\n        button: false,\n        buttonRestrict: -1\n      };\n\n      if (type === 'mousedown' || type === 'mouseup') {\n        data.button = fixEvent.buttonData[event.button];\n      }\n\n      callback.call(this, data);\n    }\n\n    ; // create a hash table of event handlers for each element/event pair. This also gives us an array for easy obliteration\n\n    element.events[type] = element.events[type] || {\n      handles: []\n    }; // Store the handler for easy obliteration\n\n    element.events[type].handles.push(handler);\n\n    if (element.addEventListener) {\n      element.addEventListener(type, handler, false);\n    } else {\n      // assign each event handler a unique ID\n      if (!handler.$$guid) handler.$$guid = fn.addEvent.guid++; // store the event handler in the hash table\n\n      element.events[type][handler.$$guid] = handler; // assign a global event handler to do all the work\n\n      element[\"on\" + type] = handleEvent;\n    } // Return the handler so we can obliterate it later if we want\n\n\n    return handler;\n  }; // a counter used to create unique IDs\n\n\n  fn.addEvent.guid = 1;\n  /**\r\n   * @method\r\n   * Removes a listener from the specified element.\r\n   * @param {HTMLElement} element The element to remove the listener from.\r\n   * @param {String} type The event type the handler is listening for.\r\n   * @param {Function} handler The handler created by {@link #addEvent}\r\n   */\n\n  fn.removeEvent = function (element, type, handler) {\n    // Single removal\n    if (handler) {\n      if (element.removeEventListener) {\n        element.removeEventListener(type, handler, false);\n      } else {\n        // delete the event handler from the hash table\n        if (element.events && element.events[type]) {\n          delete element.events[type][handler.$$guid];\n        }\n      }\n    } // Mass removal\n    else if (element.events && element.events[type]) {\n        var handler;\n\n        while (handler = element.events[type].handles.pop()) {\n          fn.removeEvent(element, type, handler);\n        }\n      }\n  };\n\n  function handleEvent(event) {\n    var returnValue = true,\n        handlers,\n        i; // grab the event object (IE uses a global event object)\n\n    event = event || fixEvent(((this.ownerDocument || this.document || this).parentWindow || window).event); // get a reference to the hash table of event handlers\n\n    handlers = this.events[event.type]; // execute each event handler\n\n    for (i in handlers) {\n      if (handlers.hasOwnProperty(i) && typeof handlers[i] === 'function') {\n        this.$$handleEvent = handlers[i];\n\n        if (this.$$handleEvent(event) === false) {\n          returnValue = false;\n        }\n      }\n    }\n\n    return returnValue;\n  }\n\n  ;\n\n  function fixEvent(event) {\n    // add W3C standard event methods\n    event.preventDefault = fixEvent.preventDefault;\n    event.stopPropagation = fixEvent.stopPropagation;\n    fixEvent.windowTarget = true;\n    return event;\n  }\n\n  ; // window detection target type\n\n  fixEvent.windowTarget = false;\n\n  fixEvent.preventDefault = function () {\n    this.returnValue = false;\n  };\n\n  fixEvent.stopPropagation = function () {\n    this.cancelBubble = true;\n  }; // Figure out which button was pressed\n  // Detect for a modern browser\n\n\n  if (window.addEventListener) {\n    fixEvent.buttonData = [0, 0, 2, 0, 1];\n  } else {\n    fixEvent.buttonData = [-1, 0, 1, 2];\n  }\n  /**\r\n   * @method\r\n   * Watch a digged property of target element while that element is focused. Fires a callback\r\n   * on change.\r\n   * @param {HTMLElement} elem The element to watch.\r\n   * @param {String} dig The dig path for the property that needs to be watched. See: {@link #objectDig}.\r\n   * @param {Function} callback The function to call when the element changes.\r\n   */\n\n\n  fn.watch = function (elem, dig, callback) {\n    fn.addEvent(elem, 'focus', function (data) {\n      function c() {\n        var v = fn.objectDig(c.target, c.dig);\n\n        if (v !== c.store) {\n          callback(c.target, v, c.store);\n          c.store = v;\n        }\n\n        c.timer = setTimeout(c, 32);\n      }\n\n      ;\n\n      function k() {\n        clearTimeout(c.timer);\n        fn.removeEvent(data.target, 'blur', k);\n      }\n\n      ;\n      c.target = data.target;\n      c.dig = dig;\n      c.timer = setTimeout(c, 32);\n      c.store = false;\n      fn.addEvent(data.target, 'blur', k);\n    });\n  };\n  /**\r\n   * @class Riot.DDragon.fn.fire\r\n   * @singleton\r\n   * Fire group event system. This system allows us to setup and merge two different coding\r\n   * systems together, one system planning and another executing, without the issues.\r\n   */\n\n\n  fn.fire = {\n    data: {},\n\n    /**\r\n     * @method\r\n     * Plans for an event execution.\r\n     * @param {String} group The event group to expect.\r\n     * @param {Object} planData A data objec that needs to be passed to the callback when the event fires.\r\n     * @param {Function} callback The callback to execute when the event fires. Has parameters planData, execData, then fireId\r\n     * @return {Number} A fireId that can be used to scrap the event\r\n     */\n    plan: function (group, planData, callback) {\n      if (typeof fn.fire.data[group] !== 'object') {\n        fn.fire.data[group] = [];\n      }\n\n      return fn.fire.data[group].push({\n        'planData': planData,\n        'callback': callback\n      }) - 1;\n    },\n\n    /**\r\n     * @method\r\n     * Removes the specified plan.\r\n     * @param {String} group The event group to remove from.\r\n     * @param {Number} id The id of the plan to remove.\r\n     */\n    scrap: function (group, id) {\n      if (typeof fn.fire.data[group] === 'object') {\n        fn.fire.data[group].splice(id, 1);\n      }\n    },\n\n    /**\r\n     * @method\r\n     * Executes a set of plans.\r\n     * @param {String} group The event group to execute.\r\n     * @param {Object} execData The data that needs to be passed to each handler.\r\n     */\n    exec: function (group, execData) {\n      if (typeof fn.fire.data[group] === 'object') {\n        var i;\n\n        for (i = 0; i < fn.fire.data[group].length; i++) {\n          fn.fire.data[group][i].callback(fn.fire.data[group][i].planData, execData, i);\n        }\n      }\n    }\n  };\n})(); // This executes only once loader is ready to execute it.\n// This is the start of the primary ddragon application.\n\n\nRiot.DDragon.fn.init = function (selectorEngine) {\n  var w = window,\n      rg = Riot,\n      dd = Riot.DDragon,\n      fn = dd.fn; // Remap the selectorEngine if one was passed\n\n  if (arguments.length > 0) dd.fn$serve = selectorEngine;\n  /* END OF FILE - core.js */\n  // The models object stores the individual models that are created\n  // This allows all models to be accessed in a semi-global manner\n  // The standard format is simply dd.models[data type], however a call to dd.remodel may change this\n\n  dd.models = {}; // Model parsers are run based on reported data type\n  // Each model parser takes in the individual data object it's parsing\n  // This object is a reference, and can be manipulated directly here\n  // The overall context for the modelParser (this) refers to the whole model\n\n  dd.modelParsers = {\n    'champion': [function (obj) {\n      if (typeof obj.loadedPartial === 'undefined') {\n        // Base attack speed should be calculated on the fly\n        obj.stats.attackspeed = fn.calcAspd(1, obj.stats.attackspeedoffset, obj.stats.attackspeedperlevel); // Level 1 evaluations for fast reference\n\n        var l1s = ['armor', 'attackdamage', 'hp', 'hpregen', 'mp', 'mpregen', 'spellblock'],\n            l1,\n            base,\n            per;\n\n        while (l1 = l1s.pop()) {\n          base = obj.stats[l1] * 1000;\n          per = obj.stats[l1 + 'perlevel'] * 1000;\n          obj.stats['l1' + l1] = (base + per) / 1000;\n        }\n\n        obj.loadedPartial = true;\n      }\n\n      if (obj.loadedFull) {\n        // Spells should have versions on them\n        var count = obj.spells.length;\n\n        while (count--) {\n          obj.spells[count].version = obj.version;\n        }\n      }\n    }]\n  }; // General model parsers that affect an entire model\n  // Currently only used for the weird profileicon behaviour in the platform\n\n  dd.addModelParser('profileicon', function () {\n    this.remapFunc = function (id) {\n      var numID = parseInt(id, 10);\n\n      if (numID > dd.m.profileiconmax && numID < 500) {\n        return '0';\n      }\n\n      return id;\n    };\n  });\n  /**\r\n   * @class Riot.DDragon.model\r\n   * A wrapper class used to encompass the retrieval and manipulation of a type of data.\r\n   * @param {String} dataSource Describes the overall model name and stored source location When this\r\n   * has no specified data, dataSource will also specify data type.\r\n   * @param {String} [dataVersion] specifies a specific version type to use 'single' may be used here\r\n   * to specify a simple / individual break.\r\n   * @param {Object[]} [data] A full data block, allowing specific data to be injected in to the\r\n   * model.\r\n   */\n\n  dd.model = function (dataSource, dataVersion, data) {\n    // Remapper\n    var that = this; // If this model has finished initializing\n\n    this.init = false; // An object reference to make sure we don't repeat AJAX calls\n    // This can either contain 'all' or each id, with a status of true or false\n\n    this.loading = {\n      all: false\n    }; //java -jar compiler.jar --js $(FULL_CURRENT_PATH) --compilation_level ADVANCED_OPTIMIZATIONS --js_output_file $(CURRENT_DIRECTORY)\\$(NAME_PART)-compiled.js\n    // If this model is a special override case\n\n    this.override = false; // This is a detector for if the keys are loaded (since they might be loaded in async)\n\n    this.keysLoaded = false; // A name for this model. Important for keeping model recall functioning.\n\n    this.name = dataSource; // We assume that we can't translate models by default (though usually language loading syncs up to where you always can)\n    // Note: This is just auxilary translations, such as tags\n\n    this.translated = false; // The methodology to loading the data.\n    // By default, we load it all.\n\n    this.format = 'all'; // Pull out 'Full' types\n\n    if (dataSource.substr(-4, 4) === 'Full') {\n      this.type = dataSource.substr(0, dataSource.length - 4);\n    } else {\n      // Initial Type Info\n      this.type = dataSource;\n    } // We can use either manifest controlled versions or we can use specified versions of data\n\n\n    if (typeof dataVersion === 'string') {\n      this.version = dataVersion;\n    } else {\n      this.version = dd.m.n[this.type];\n    } // Used to overwrite the remap functionality\n\n\n    this.remapFunc = function (id) {\n      return this.remapKeys[id];\n    }; // These two keys are used to help control localStorage\n    // dl stores returned localstorage info, preparse\n    // lsKey is the localStorage key to read and write from\n    // lsKey also contains information about specific versions if this is a special version override call\n    // This can be a different storage method as well. No data storage method is used for models by default as model data can get pretty big\n\n\n    var dl;\n    this.lsKey = 'rg_data_' + dd.m.l + '_' + dataSource + (this.override ? '_' + this.version : ''); // Data source location for faster ajax processing\n\n    this.source = dd.m.cdn + this.version + '/data/' + dd.m.l + dataSource; // If Data was specified, it will attempt to load that\n    // loadAll will parseJSON\n\n    if (typeof data === 'string') {\n      this.loadAll(data);\n    } else {\n      // This is where we would hook in storage methods\n      // @TODO: Storage hook\n      // If the data didn't initiate by this point, then we start loading from the CDN\n      if (!this.init) {\n        // Make sure we're not repeating ajax calls\n        if (!this.loading.all) {\n          this.loading.all = true;\n          fn.getJSON(this.source + '.json', function (d) {\n            that.loadAll(d);\n\n            if (that.init) {\n              that.makeKeys(that.data);\n              fn.fire.exec('model', {\n                'name': that.name\n              });\n            }\n\n            that.loading.all = false;\n          });\n        }\n      }\n    }\n  };\n  /**\r\n   * @method rename\r\n   * Renames the model.\r\n   * @param {String} name The new name of the model.\r\n   * @return {Riot.DDragon.model} The renamed model.\r\n   */\n\n\n  dd.model.prototype.rename = function (name) {\n    this.name = name;\n    return this;\n  };\n  /**\r\n   * @method makeKeys\r\n   * Converts a data object into an array of data keys.\r\n   * @param {Object} keySource The data source containing the desired keys.\r\n   * @return {String[]} The resulting keys.\r\n   */\n\n\n  dd.model.prototype.makeKeys = function (keySource) {\n    this.keys = [];\n    this.remapKeys = {};\n\n    for (var key in keySource) {\n      if (keySource.hasOwnProperty(key)) {\n        if (keySource[key].key) {\n          this.remapKeys[keySource[key].key] = key;\n        }\n\n        this.keys.push(key);\n      }\n    }\n\n    this.keysLoaded = true;\n  };\n  /**\r\n   * @method loadAll\r\n   * Loads all data provided.\r\n   * @param {String/Object} data Either a data object, or a parse-able JSON string.\r\n   */\n\n\n  dd.model.prototype.loadAll = function (data) {\n    if (typeof data === 'string') {\n      data = JSON.parse(data);\n    }\n\n    if (data.version === this.version) {\n      this.data = data.data;\n      this.keys = data.keys;\n      this.init = true;\n\n      if (typeof data.basic !== 'undefined') {\n        this.basic = data.basic;\n      } else {\n        this.basic = false;\n      }\n\n      if (typeof data.tree !== 'undefined') {\n        this.tree = data.tree;\n      } else {\n        this.tree = {};\n      }\n\n      if (typeof data.format !== 'undefined') {\n        this.format = data.format;\n      } else {\n        this.format = 'all';\n      }\n\n      this.runFullParsers();\n    }\n  };\n  /**\r\n   * @method runFullParsers\r\n   * Runs all model parsers associated with this model.\r\n   */\n\n\n  dd.model.prototype.runFullParsers = function () {\n    if (dd.mps[this.type]) {\n      var that = this;\n      fn.each(dd.mps[this.type], function (mp) {\n        mp.call(that);\n      });\n    }\n  };\n  /**\r\n   * @method addModelParser\r\n   * @member Riot.DDragon\r\n   * Adds a model parser and runs it on the given model type.\r\n   * @param {String} type The model type this parser is associated with.\r\n   * @param {Function} mp The data parsing function.\r\n   */\n\n\n  dd.addModelParser = function (type, mp) {\n    dd.amp(type, mp);\n\n    for (model in dd.models) {\n      if (dd.models.hasOwnProperty(model)) {\n        if (model.type === type) {\n          mp.call(model);\n        }\n      }\n    }\n  };\n  /**\r\n   * @method loadSingle\r\n   * Loads a single piece of data into the model. This is normally called from {@link #getFull}.\r\n   * @param {Object} data The data to load.\r\n   */\n\n\n  dd.model.prototype.loadSingle = function (data) {\n    if (this.format === 'standAloneComplex') {\n      if (typeof data === 'string') {\n        data = JSON.parse(data);\n      }\n\n      fn.rebase(this.data, data.data);\n    }\n  };\n  /**\r\n   * @method parseData\r\n   * Adds post-processing variables to the given object. Data added includes basic data, searchHash,\r\n   * searchString, and whatever the associated modelParsers add.\r\n   * @param {String} id The id of the data that needs to be parsed.\r\n   */\n\n\n  dd.model.prototype.parseData = function (id) {\n    var obj = this.data[id];\n\n    if (!obj.parsed || !this.translate) {\n      if (!obj.parsed) {\n        // Add the basics to this object\n        if (typeof this.basic === 'object') {\n          obj = fn.rebase(obj, this.basic);\n        } // Run all the modelparsers\n\n\n        if (typeof dd.modelParsers[this.type] !== 'undefined') {\n          var i, j;\n\n          for (i = 0, j = dd.modelParsers[this.type].length; i < j; ++i) {\n            dd.modelParsers[this.type][i].call(this, obj);\n          }\n        } // For standAloneComplex data, we don't set the parse unless the individual data is loaded\n        // This is incase models parsers wish to use full data information\n\n\n        if (this.format === 'standAloneComplex') {\n          if (!obj.loadedFull) {\n            obj.loadedFull = false;\n          } else {\n            obj.parsed = true;\n          }\n        } else {\n          obj.parsed = true;\n        } // Add id field\n\n\n        obj.id = id;\n      } // See if the language model is ready\n\n\n      this.translate = dd.useModel('language').init; // Building out a hash and string system to do simultaneous full text + fuzzy search\n      // On the most common property groups (name and tags)\n\n      if (typeof obj.name === 'string') {\n        obj.searchName = fn.tFilter(obj.name);\n        obj.searchHash = {};\n        obj.searchRaw = '';\n        obj.searchString = '';\n        var s, i, j; // Splitting the Object's name in to search areas\n\n        s = obj.searchName.split(' ');\n\n        for (i = 0, j = s.length; i < j; ++i) {\n          obj.searchHash[s[i]] = true;\n          obj.searchRaw += ';' + s[i];\n          obj.searchString += ';' + s[i];\n        } // Adding basic colloquialisms\n\n\n        if (obj.colloq) {\n          obj.searchString += obj.colloq;\n        } // Splitting the Object's tags in to search areas\n\n\n        if (obj.tags) {\n          for (i = 0, j = obj.tags.length; i < j; ++i) {\n            obj.searchHash[obj.tags[i]] = true;\n            obj.searchRaw += ';' + obj.tags[i];\n            var colloqTag = 'colloq_' + obj.tags[i];\n            var translatedColloqTag = fn.t(colloqTag);\n\n            if (translatedColloqTag === colloqTag) {\n              translatedColloqTag = '';\n            }\n\n            obj.searchString += ';' + fn.tFilter(fn.t(obj.tags[i])) + translatedColloqTag;\n          }\n        }\n      }\n    }\n  };\n  /**\r\n   * @method parseAllData\r\n   * Attempts to parse all currently managed data in a single pass.\r\n   */\n\n\n  dd.model.prototype.parseAllData = function () {\n    if (!this.parsed && this.init) {\n      var i, j;\n\n      for (i = 0, j = this.keys.length; i < j; ++i) {\n        this.get(this.keys[i]);\n      }\n\n      this.parsed = true;\n    }\n  };\n  /**\r\n   * @method get\r\n   * Retrieves a single peice of data from the model.\r\n   * @param {String} id The id of the desired data.\r\n   * @param {Boolean} [remap=false] If we should use the alternate ID system associated with this model\r\n   * @param {Function} [callback=null] A function to call once the model has finished loading,\r\n   * or immediately if it already has. The callback's \"this\" is the model and the first param is the\r\n   * desired data from get\r\n   * @return {Object} The desired data or a failure object the can be retried (see retryModel);\r\n   */\n\n\n  dd.model.prototype.get = function (id, remap, callback) {\n    remap = remap || false;\n    var that = this;\n\n    if (remap) {\n      id = this.remapFunc.call(this, id);\n    }\n\n    if (this.init) {\n      var data = this.data[id];\n\n      if (typeof data === 'object') {\n        this.parseData(id);\n\n        if (typeof callback !== 'undefined') {\n          callback.call(this, data);\n        }\n\n        return data;\n      } else if (typeof data === 'string') {\n        if (typeof callback !== 'undefined') {\n          callback.call(this, data);\n        }\n\n        return data;\n      }\n    } else if (typeof callback !== 'undefined') {\n      fn.fire.plan('model', {\n        name: type\n      }, function (planData, execData, fireId) {\n        if (execData.name === planData.name) {\n          fn.fire.scrap('model', fireId);\n          callback.call(that, that.get(id, remap));\n        }\n      });\n    }\n\n    return {\n      _action: 'get',\n      _name: this.name,\n      id: id\n    };\n  };\n  /**\r\n   * @method getFull\r\n   * Initializes a single piece of data based on id. If the data is not already in the mode then it\r\n   * will be requested from the server.\r\n   * @param {String} id The id of the desired data.\r\n   * @param {Boolean} [remap=false] If we should use the alternate ID system associated with this model\r\n   * @param {Function} [callback=null] A function to call once the model has finished loading,\r\n   * or immediately if it already has. The callback's \"this\" is the model and the first param is the\r\n   * desired data from get\r\n   * @return {Object} The desired data, or an ajax status object.\r\n   */\n\n\n  dd.model.prototype.getFull = function (id, remap, callback) {\n    remap = remap || false;\n    var that = this;\n\n    if (remap) {\n      id = this.remapFunc.call(this, id);\n    }\n\n    if (this.init) {\n      var data = this.get(id); // If we're getting noncomplex data, or if the complex data is already loaded, we can safely return the full data object\n\n      if (this.format !== 'standAloneComplex' || data.loadedFull) {\n        if (typeof callback !== 'undefined') {\n          callback.call(this, data);\n        }\n\n        return data;\n      } // Don't reproduce ajax calls\n\n\n      if (!this.loading[id]) {\n        this.loading[id] = true;\n        fn.getJSON(dd.m.cdn + data.version + '/data/' + dd.m.l + this.type + '/' + id + '.json', function (data) {\n          that.loadSingle(data);\n          that.get(id, remap).loadedFull = true;\n          that.loading[id] = false;\n          fn.fire.exec('model', {\n            'name': that.name,\n            'sub': id\n          });\n\n          if (typeof callback !== 'undefined') {\n            callback.call(that, that.get(id, remap));\n          }\n        });\n      }\n    } else if (typeof callback !== 'undefined') {\n      fn.fire.plan('model', {\n        name: type,\n        sub: id\n      }, function (planData, execData, fireId) {\n        if (execData.name === planData.name && execData.id === planData.id) {\n          fn.fire.scrap('model', fireId);\n          callback.call(that, that.get(id, remap));\n        }\n      });\n    }\n\n    return {\n      _action: 'getFull',\n      _name: this.name,\n      id: id\n    };\n  };\n  /**\r\n   * @method getImg\r\n   * Returns an image path for a single data object.\r\n   * @param {String} id The id of the desired data.\r\n   * @param {Object} options The options object for creating the image. See {@link Riot.DDragon.fn#getImg}.\r\n   *\r\n   * In addition to the standard options available to getImg, this version fills in the version parameter\r\n   * automatically and it allows the wrap parameter to go up to 3.\r\n   *\r\n   * In case of wrap: 3, this adds data-rg-name=\"\" and data-rg-id=\"\" attributes automatically.\r\n   * This will cause the result to have the default tooltips and modals.\r\n   * @param {Boolean} [remap] If we should use the alternate ID system associated with this model\r\n   * for more details.\r\n   */\n\n\n  dd.model.prototype.getImg = function (id, options, remap) {\n    remap = remap || false;\n\n    if (remap) {\n      id = this.remapFunc.call(this, id);\n    }\n\n    if (this.init) {\n      // Options and default options\n      var basic = {\n        version: this.version\n      };\n\n      if (typeof options !== 'object') {\n        var options = basic;\n      } else {\n        // If wrap is 3 or greater, we assume the standard rg data attrs should be present\n        if (options.wrap) {\n          if (options.wrap > 2) {\n            if (typeof options.attrs === 'undefined') {\n              options.attrs = '';\n            }\n\n            options.attrs += ' data-rg-name=\"' + this.name + '\" data-rg-id=\"' + id + '\"';\n          }\n        }\n\n        options = fn.rebase(options, basic);\n      }\n\n      return fn.getImg(this.get(id), options);\n    }\n\n    return '';\n  };\n  /**\r\n   * @method all\r\n   * Retrieves an array of all item id's.\r\n   * @return {String[]} The ids of all currently managed data.\r\n   */\n\n\n  dd.model.prototype.all = function () {\n    return this.keys.slice(0);\n  };\n  /**\r\n   * @method collect\r\n   * @member Riot.DDragon\r\n   * Controls the collection system and shouldn't be used outside of it.\r\n   */\n\n\n  dd.collect = function (parent) {\n    this.parent = parent;\n    this.sData = {};\n    this.fData = [];\n\n    if (parent.init) {\n      this.keys = parent.keys.slice(0);\n    }\n  };\n  /**\r\n   * @method filterInit\r\n   * Initializes a filter.\r\n   * @param {Object} filter The desired filter.\r\n   */\n\n\n  dd.collect.prototype.filterInit = function (filter) {\n    this.f = true;\n    this.fData = filter;\n    this.fKeys = {};\n    this.test = false;\n  };\n  /**\r\n   * @method sortInit\r\n   * Initializes the sort.\r\n   * @param {Object} sort The sort data.\r\n   */\n\n\n  dd.collect.prototype.sortInit = function (sort) {\n    this.s = true;\n    this.sData = sort;\n  };\n  /**\r\n   * @method filter\r\n   * Checks to see if the item at the specified position needs to be removed. If the data at the\r\n   * specified position has not been parsed, it will be parsed.\r\n   * @param {Number} pos The position of the item being filtered.\r\n   * @return {Boolean} Whether the item needs to be removed or not.\r\n   */\n\n\n  dd.collect.prototype.filter = function (pos) {\n    if (!this.f) return false;\n    if (typeof this.fKeys[this.keys[pos]] !== 'undefined') return false;\n    this.fKeys[this.keys[pos]] = 1; // Filter exec takes a bool value\n    // On true, it filters out the current position (truthfully failing a filter)\n    // On false, it says \"test is true\"\n\n    function filterExec(stat) {\n      if (stat) this.keys.splice(pos, 1);\n      this.test = true;\n      return stat;\n    }\n\n    ;\n    var obj = this.parent.data[this.keys[pos]];\n    var fi,\n        fi_,\n        fj_,\n        fm,\n        ftemp,\n        fholder,\n        f,\n        fr = false,\n        typeOfFData;\n\n    for (fi = 0; fi < this.fData.length; ++fi) {\n      typeOfFData = typeof this.fData[fi]; // We map it in to an object if it hasn't yet been done\n\n      if (typeOfFData === 'boolean') {\n        // Any true filters we just skip. They've succeeded. Yay.\n        if (this.fData[fi] === true) continue; // Otherwise, we have a bad filter. We fail the filter.\n\n        return filterExec.call(this, true);\n      } // We need to map strings in to test objects\n      // Unlike core's test system, models get to deal with a special type of searching using \"searchKey:\"\n      // This is a much more language aware and dynamic search than standard\n      else if (typeOfFData === 'string') {\n          // searchKey is special\n          if (fm = /^searchKey:(.*)$/.exec(this.fData[fi])) {\n            // This hunts out all possible word spacers for:\n            // Indo-European languages, Korean, Chinese (all), Japanese, and Arabic\n            // And replaces them with a single space (for us to later split)\n            // Truncating end of line and beginning of line is important for sensible searches\n            fm = fn.tFilter(fm[1]).split(' ');\n            ftemp = fm.length - 1;\n\n            for (fi_ = 0, fj_ = fm.length; fi_ < fj_; ++fi_) {\n              // fi is the overall filter loop. We replace the current filter loop with one of the split searchKey filters.\n              // Beyond that, we add them at the end of the filters\n              // Also, all a searchkey is is a parsed and divided series of searchString includes\n              this.fData[ftemp === fi_ ? fi : this.fData.length] = fn.makeTest('searchString*=' + fm[fi_]);\n            } // If we break the searchstring, rehash the loop to check for duped filters\n\n\n            --fi;\n            continue;\n          } //  In cases not search string, the core test system will handle our needs\n          else {\n              this.fData[fi] = fn.makeTest(this.fData[fi]);\n            }\n        } // Run the filter test\n\n\n      fr |= !fn.runTest(obj, this.fData[fi]); // Kill early if a filter checks\n\n      if (fr) return filterExec.call(this, true);\n    } // Return the filtering results\n\n\n    return filterExec.call(this, fr);\n  };\n  /**\r\n   * @method sortDefault\r\n   * The default sort algorithm.\r\n   */\n\n\n  dd.collect.prototype.sortDefault = function (a, b) {\n    return a > b;\n  };\n  /**\r\n   * @method sort\r\n   * The sort worker function. This uses the positions of keya and keyb, checks by the initialized\r\n   * sort key and then swap the positions if it is required.\r\n   * @param {String} keya The key for the first data item.\r\n   * @param {String} keyb The key for the second data tiem.\r\n   * @return {Boolean} Whether the items were switched or not.\r\n   */\n\n\n  dd.collect.prototype.sort = function (keya, keyb) {\n    var sa = fn.objectDig(this.parent.data[keya], this.sData.key),\n        sb = fn.objectDig(this.parent.data[keyb], this.sData.key),\n        holder,\n        r = this.sData.callback(sa, sb);\n\n    if (r) {\n      holder = keya;\n      keya = keyb;\n      keyb = holder;\n    }\n\n    return r;\n  };\n  /**\r\n   * @method merge\r\n   * The central sort algorithm. preforms a bottom up merge sort. Unlike convential bottom up merge\r\n   * sorts, this one uses a position flip to direct which arrays this bounces data between. Which\r\n   * means constant array mapping isn't required.\r\n   */\n\n\n  dd.collect.prototype.merge = function (sA, sB, Left, Right, End) {\n    var iL = Left,\n        iR = Right,\n        j,\n        iRSwitch;\n\n    for (j = Left; j < End; ++j) {\n      // Sort Algorithm Here\n      if (typeof sA[iR] === 'undefined') {\n        iRSwitch = true;\n      } else {\n        iRSwitch = !this.sort(sA[iL], sA[iR]);\n      }\n\n      if (iL < Right && (iR >= End || iRSwitch)) {\n        sB[j] = sA[iL++];\n      } else {\n        sB[j] = sA[iR++];\n      }\n    }\n  };\n  /**\r\n   * @method collect\r\n   * The core collect function, allows for both filtering and sorting.\r\n   * @param {Object/String/String[]} filter The filter strings used to filter the data. If this is the\r\n   * only parameter, it will be a sort object.\r\n   * \r\n   * There are multiple methods a filter rule can be written. The most common pattern is the following:\r\n   * object property keyoperatorcomparison value\r\n   * \r\n   * For example:\r\n   * gold.total>1000\r\n   * Would produce a rule where 'gold.total' is the object property key, '>' is the operator, and '1000' is the comparison value.\r\n   * \r\n   * A filter rule removes objects that do not satisfy the given condition. In this case, this is saying that \"If an object has a total gold cost greater than 1000, keep it. Otherwise, remove it.\"\r\n   * \r\n   * The main piece that directs how this type of filter rule behaves is the operator. The possible operators are:\r\n   * \r\n   * <table>\r\n   * <tr><th>Operator</th><th>Function</th></tr>\r\n   * <tr><td>=</td><td>Tests if the two pieces are equal.</td></tr>\r\n   * <tr><td>></td><td>Tests if the object property is greater than the comparison value</td></tr>\r\n   * <tr><td>&lt;</td><td>Tests if the object property is lesser than the comparison value</td></tr>\r\n   * <tr><td>>=</td><td>Tests if the object property is greater than or equal to the comparison value</td></tr>\r\n   * <tr><td>&lt;=</td><td>Tests if the object property is lesser than or equal to the comparison value</td></tr>\r\n   * <tr><td>+,-,*,/,%</td><td>Mathematical operators. Removes the object if the result is 0</td></tr>\r\n   * <tr><td>*=</td><td>(String only, case insensitive) Tests if the comparison value is contained within the object property</td></tr>\r\n   * <tr><td>^=</td><td>(String only, case insensitive) Tests if the comparison value is at the beginning of the object property</td></tr>\r\n   * <tr><td>$=</td><td>(String only, case insensitive) Tests if the comparison value is at the end of the object property</td></tr>\r\n   * <tr><td>-></td><td>(Array only) Tests if the comparison value is one of the array elements within the object property</td></tr>\r\n   * </table>\r\n   * \r\n   * As an example, a possible list of filters may include:\r\n   * [\"name*=razor\",\"into->3126\"]\r\n   * This will find any item with a name that contains \"razor\" and builds into item id 3126.\r\n   * \r\n   * Then there is the \"look for\" pattern. This is simply:\r\n   * object property key\r\n   * \r\n   * With this pattern, if the object property exists and it does not contain a value of false, it will return true.\r\n   * \r\n   * An example of this would be:\r\n   * \"maps.CrystalScar\"\r\n   * Would detect if an item is enabled on CrystalScar.\r\n   * \r\n   * Finally, a \"searchKey\" pattern:\r\n   * searchKey:operator value\r\n   * \r\n   * This pattern divides the comparison value in to multiple strings, and then checks if the object's tags or name includes each of these strings, in any combination. this allows for searches such as:\r\n   * \"searchKey:ca,mage,iop\"\r\n   * Which would find cassiopeia correctly from the champions listing.\r\n   * \r\n   * searchKey is case insensitive, and accepts many different types of separations between words.\r\n   * Separations include: space, tabs, newlines, commas, interpuncts, japanese commas, arabic reverse commas, and periods.\r\n   *\r\n   *\r\n   * String patterns may contain multiple searches that are to be \"or\"ed. In this case, seperate each test with a vertical bar \"|\".\r\n   * For example:\r\n   * \"maps.CrystalScar|maps.TwistedTreeline\"\r\n   * would inform you if an item is on either Crystal Scar OR Twisted Treeline.\r\n   *\r\n   * @param {Object} [sort] The sort object.\r\n   * The sort object has two possible properties that it handles all sorts with, the key and callback properties.\r\n   * \r\n   * key defines what object property value to sort by. This uses the same method that filter uses to find data, such that a key value of 'gold.total' would map to object.gold.total.\r\n   * \r\n   * callback is optional. If present, it is an a|b compare function, where a return value of true keeps the current order and a return value of false reorders the sort.\r\n   * If this is not present, it uses the default callback function:\r\n   * \r\n   * \tsortDefault = function(a,b)\r\n   * \t{\r\n   * \t    return a>b;\r\n   * \t};\r\n   */\n\n\n  dd.model.prototype.collect = function (filter, sort) {\n    var c; // Prepare the collection\n\n    if (typeof this.collection === 'undefined') {\n      this.collection = new dd.collect(this);\n    }\n\n    c = this.collection;\n    c.s = false;\n    c.f = false; // Filter might actually be sort (if it's an object that isn't an array)\n\n    if (typeof filter === 'object' && !(filter instanceof Array)) {\n      c.sortInit(filter);\n    } // Otherwise, we do our tests here for what information we actually have to work with\n    else {\n        if (typeof filter === 'string') {\n          filter = [filter];\n        }\n\n        if (typeof filter !== 'undefined') {\n          if (filter[0] !== '') c.filterInit(filter);\n\n          if (typeof sort === 'object') {\n            c.sortInit(sort);\n          }\n        }\n      } // Init switch\n\n\n    if (this.init) {\n      var r = [],\n          i = 0,\n          tryagain;\n      this.parseAllData(); // Filter\n\n      if (c.f) {\n        while (i < c.keys.length) {\n          if (!c.filter(i)) {\n            ++i;\n          }\n        }\n      } // Sort\n\n\n      c.sN = c.keys.length;\n\n      if (c.s && c.sN > 1) {\n        if (!c.sData.callback) {\n          c.sData.callback = c.sortDefault;\n        }\n\n        var sK = [c.keys.slice(0), []],\n            sA = 0,\n            sB = 1,\n            sW,\n            sI;\n\n        for (sW = 1; sW < c.sN; sW *= 2) {\n          for (sI = 0; sI < c.sN; sI += 2 * sW) {\n            c.merge(sK[sA], sK[sB], sI, Math.min(sI + sW, c.sN), Math.min(sI + 2 * sW, c.sN));\n          }\n\n          sA ^= 1;\n          sB ^= 1;\n        }\n\n        c.keys = sK[sA].slice(0);\n      } // Return\n\n\n      return c.keys;\n    } // Fail\n\n\n    this.deleteCollect();\n    return {\n      _action: 'collect',\n      _name: this.name,\n      s: c.s,\n      f: c.f,\n      sData: c.sData,\n      fData: c.fData\n    };\n  };\n  /**\r\n   * @method deleteCollect\r\n   * Deletes the current collection. When collect is called, it will regenerate itself.\r\n   */\n\n\n  dd.model.prototype.deleteCollect = function () {\n    delete this.collection;\n  };\n  /**\r\n   * @method datamap\r\n   * Maps an array of ids to an array of objects. Generally this shouldn't be used except as part of a\r\n   * model working behaviour (see {@link #remodel}) because placing this behaviour within the view or\r\n   * controller is the difference between n time and 2n time.\r\n   * @method {Object[]} dataArray The data array to map.\r\n   */\n\n\n  dd.model.prototype.datamap = function (dataArray) {\n    var i,\n        ndata = {};\n\n    for (i = 0; i < dataArray.length; ++i) {\n      ndata[this.data[dataArray[i]].id] = this.data;\n    }\n\n    return ndata;\n  };\n  /**\r\n   * @method remodel\r\n   * Creates a new model out of the current model. This will either use the keys specified or the\r\n   * current collection state. The model simply provides the name for use with useModel. It's\r\n   * recommended to destroy remodel's after use, otherwise they can risk memory leaks.\r\n   * @param {String} newModel The name of the new model.\r\n   * @param {String[]} newKeys The list of keys that will be added to the model.\r\n   * @return {Riot.DDragon.model} The new model, or false if it could not be created.\r\n   */\n\n\n  dd.model.prototype.remodel = function (newModel, newKeys) {\n    if (typeof newKeys === 'undefined') {\n      newKeys = this.collect();\n    }\n\n    if (this.init) {\n      return dd.models[newModel] = new dd.model(this.type, this.version, JSON.stringify({\n        'data': this.datamap(newKeys),\n        'keys': newKeys,\n        'basic': this.basic\n      })).rename(newModel);\n    } else {\n      return false;\n    }\n  };\n  /**\r\n   * @method rmModel\r\n   * @member Riot.DDragon\r\n   * Removes the specified model type. This is important for remodeling, as remodels can risk memory\r\n   * leaks.\r\n   * @param {String} name The name of the model that needs to be removed.\r\n   */\n\n\n  dd.rmModel = function (name) {\n    delete dd.models[name];\n  };\n  /**\r\n   * @method useModel\r\n   * @member Riot.DDragon\r\n   * Pulls a model based on the given type. If the type is an object, and the desired model does not\r\n   * already exist, the model will be created.\r\n   * @param {String/Object} type The desired model type.\r\n   * @param {String} [version=null] The version of the model desired.\r\n   * @param {Function} [callback=null] A function to call once the model has finished loading,\r\n   * or immediately if it already has. The callback's \"this\" is the model.\r\n   * @return {Riot.DDragon.model} The desired model.\r\n   */\n\n\n  dd.useModel = function (type, version, callback) {\n    var t = type,\n        model;\n\n    if (typeof version === 'string') {\n      t += '_' + version;\n\n      if (typeof dd.models[t] !== 'object') {\n        model = dd.models[t] = new dd.model(type, version).rename(t);\n      } else {\n        model = dd.models[t];\n      }\n    } else {\n      if (typeof dd.models[t] !== 'object') {\n        model = dd.models[t] = new dd.model(type).rename(t);\n      } else {\n        model = dd.models[t];\n      }\n    }\n\n    if (model.init && typeof callback !== 'undefined') {\n      callback.call(model);\n    } else if (typeof callback !== 'undefined') {\n      fn.fire.plan('model', {\n        name: type\n      }, function (planData, execData, fireId) {\n        if (execData.name === planData.name) {\n          fn.fire.scrap('model', fireId);\n          callback.call(model);\n        }\n      });\n    }\n\n    return model;\n  };\n  /**\r\n   * @method retryModel\r\n   * @member Riot.DDragon\r\n   * Attempts to use a failed return object and reexecute it, returning the new result.\r\n   * @param {Object} action A failed model action.\r\n   * @return {Object} The new action object.\r\n   */\n\n\n  dd.retryModel = function (action) {\n    if (typeof action === 'object') {\n      if (typeof action._name === 'string') {\n        var model = dd.useModel(action._name);\n\n        switch (action._action) {\n          case 'collect':\n            if (action.s && action.f) return model.collect(action.fData, action.sData);\n            if (action.f) return model.collect(action.fData);\n            if (action.s) return model.collect(action.sData);\n            return model.collect();\n            break;\n\n          case 'get':\n            return model.get(action.id);\n            break;\n\n          case 'getFull':\n            return model.getFull(action.id);\n            break;\n        }\n      }\n    }\n\n    return false;\n  };\n  /**\r\n   * @method modelAux\r\n   * @member Riot.DDragon\r\n   * Performs a series of special actions against the target element based on model information extracted from it\r\n   * as well as the data-rg-aux attribute of that element. Each action must be space seperated.\r\n   * The actions, as well as the order they act in, are as follows:\r\n   * remap_keys: Replace the data-rg-id attribute with an id remap of that key (important for champions)\r\n   * empty: Empty the div\r\n   * wrap={Number}: Set the wrap property of the images generated by img\r\n   * img={String}: Append an image piece in to the element. String defines the image type\r\n   * size={String}: The size of the sprite image (for img=sprite only). Default is 'normal'. 'small' and 'tiny' are also available.\r\n   * query={String}: Query's the data via fn.objectDig and appends it to the element\r\n   * no_inline: The div does not get an inline-block property set.\r\n   * strip_data: This strips the data-rg tags used for modelAux from the element\r\n   * @param {HTMLElement} The element to fill\r\n   */\n\n\n  dd.modelAux = function (el) {\n    var info = fn.rgInfo(el, 1);\n\n    function infoAux(key, action) {\n      var val;\n\n      if (fn.hasWord(info.aux, key)) {\n        action();\n        info.aux = fn.removeWord(info.aux, key);\n        el.setAttribute('data-rg-aux', info.aux);\n      }\n    }\n\n    function valueAux(key, action) {\n      var val;\n\n      if (val = fn.hasValue(info.aux, key)) {\n        action(val);\n        info.aux = fn.removeValue(info.aux, key);\n        el.setAttribute('data-rg-aux', info.aux);\n      }\n    }\n\n    if (info && info.aux) {\n      dd.addApp([info.name], function () {\n        info.inline = true;\n        info.wrap = 2;\n        info.size = 'normal';\n        infoAux('remap_keys', function () {\n          var model = dd.useModel(info.name);\n          info.id = model.remapFunc.call(model, info.id);\n          el.setAttribute('data-rg-id', info.id);\n        });\n        infoAux('empty', function () {\n          el.innerHTML = '';\n        });\n        valueAux('wrap', function (value) {\n          info.wrap = parseInt(value, 10);\n        });\n        valueAux('size', function (value) {\n          info.size = value;\n        });\n        valueAux('img', function (value) {\n          el.innerHTML += dd.useModel(info.name).getImg(info.id, {\n            src: value,\n            wrap: info.wrap,\n            size: info.size\n          });\n        });\n        valueAux('query', function (value) {\n          var obj = dd.useModel(info.name).get(info.id);\n\n          if (!obj.hasOwnProperty(\"_action\")) {\n            el.innerHTML += fn.objectDig(dd.useModel(info.name).get(info.id), value);\n          }\n        });\n        infoAux('no_inline', function () {\n          info.inline = false;\n        }); // This MUST be last, or it will get clobbered\n\n        infoAux('strip_data', function () {\n          el.setAttribute('data-rg-name', '');\n          el.setAttribute('data-rg-id', '');\n          el.setAttribute('data-rg-aux', '');\n        });\n\n        if (info.inline) {\n          el.style.display = 'inline-block';\n        }\n      });\n    }\n  };\n  /**\r\n   * @method dynamicScan\r\n   * @member Riot.DDragon\r\n   * Scans the DOM starting at the target element. The scan strips data-rg- classes out and resets them as\r\n   * attributes, as well as performs a modelAux on each element.\r\n   * Commas (,) are used in place of spaces for complex data values.\r\n   * @param {HTMLElement} The element to start the scan at.\r\n   */\n\n\n  dd.dynamicScan = function () {\n    var dataReg = /(data-rg-[a-zA-Z]+)=([a-zA-Z0-9_\\.,]+)/;\n\n    function dynamicScan(el) {\n      var m, i, j, child;\n\n      for (i = 0, j = el.childNodes.length; i < j; ++i) {\n        child = el.childNodes[i];\n\n        while (m = dataReg.exec(child.className)) {\n          child.setAttribute(m[1], m[2].replace(/,/g, ' '));\n          child.className = child.className.replace(dataReg, '');\n        }\n\n        dd.modelAux(child);\n        dynamicScan(child);\n      }\n    }\n\n    return dynamicScan;\n  }();\n  /**\r\n   * @method t\r\n   * @member Riot.DDragon.fn\r\n   * Translates a string based on the given key.\r\n   * @param {String} key The key to the string that needs to be translated.\r\n   */\n\n\n  fn.t = function (key) {\n    var tr = dd.useModel('language').get(key);\n\n    if (typeof tr === 'string') {\n      return tr;\n    }\n\n    return key;\n  };\n  /**\r\n   * @method tFilter\r\n   * @member Riot.DDragon.fn\r\n   * Sanitizes a string for multi language purposes\r\n   * @param {String} text The text to sanitize\r\n   */\n\n\n  fn.tFilter = function (text) {\n    var f,\n        s,\n        i,\n        l = dd.useModel('language').tree;\n\n    if (l) {\n      // Apply searchKeyIgnore rules\n      s = l.searchKeyIgnore;\n\n      if (s !== '') {\n        f = new RegExp('[' + s + ']', 'g');\n        text = text.replace(f, '');\n      } // Apply searchKeyRemap rules\n\n\n      s = l.searchKeyRemap;\n      i = s.length;\n\n      while (i--) {\n        f = new RegExp('[' + s[i].v + ']', 'g');\n        text = text.replace(f, s[i].k);\n      }\n\n      text = text.toLowerCase().replace(/(\\s+|\\t+|(\\n\\r)+|\\n+|,+|·+|\\u3001+|\\u3002+|\\u060C+)/g, ' ').replace(/\\.|'/g, '').replace(/(^\\s+|\\s+$)/g, '');\n    }\n\n    return text;\n  }; // We'll want to start grabbing the current language early\n\n\n  dd.useModel('language'); // The primary css file the default displays use\n\n  fn.getCSS(dd.m.cdn + dd.m.css + '/css/view.css'); // The default display fail\n\n  dd.displayFail = function () {\n    return '<img src=\"' + dd.m.cdn + 'img/global/load01.gif\" />';\n  };\n  /**\r\n   * @class Riot.DDragon.display\r\n   * @singleton\r\n   * An object that stores all displays, built in and app created.\r\n   */\n\n\n  dd.display = {};\n  /**\r\n   * @method addDisplay\r\n   * @member Riot.DDragon\r\n   * Adds a display definition.\r\n   * @param {Object} config The display contig.\r\n   * @param {String} config.type The display type.\r\n   * @param {Function} config.success\r\n   * The function to execute when data is returned successfully. This function needs to return an html\r\n   * string to be placed in the view. In most cases this function will recieve a data object as its\r\n   * only parameter.\r\n   * @param {Function} config.fail\r\n   * This function is used when the model fails to retrieve data. This should generally return\r\n   * placeholder html.\r\n   * @param {Function} config.onFill\r\n   * This function is called when the display is finished rendering. The scope of this function is\r\n   * the controller, not the view.\r\n   */\n\n  dd.addDisplay = function (display) {\n    dd.display[display.type] = display;\n  };\n  /**\r\n   * @method displayList\r\n   * @member Riot.DDragon\r\n   * Creates a list of display executions.\r\n   * @param {String} subname The display part used to render a peice of the list.\r\n   * @param {Object[]} data A list of data to pass to each of the pieces.\r\n   * @return {String} The generated html.\r\n   */\n\n\n  dd.displayList = function (subName, data) {\n    var r = '',\n        j = data.length,\n        i = 0,\n        subDisplay = dd.display[subName].success;\n\n    for (; i < j; ++i) {\n      r += subDisplay.call(this, this.model.get(data[i]));\n    }\n\n    return r;\n  };\n  /*\r\n   * DISPLAY STRUCTURE *\r\n   ****\r\n   \r\n  \t{\r\n  \t\t// This type string simply gives a name for the display\r\n  \t\ttype: '',\r\n  \t\t\r\n  \t\tsuccess: function(data)\r\n  \t\t{\r\n  \t\t\t// Returns an html string describing how to display data\r\n  \t\t\t// data tends to be either an object or array\r\n  \t\t\t\r\n  \t\t\t// In most cases, when taking in an array, the return might look something like:\r\n  \t\t\t//   return dd.displayList.call(this,'itempiece',data);\r\n  \t\t\t// This is taking advtange of displayList to list out a different display (a subdisplay) multiple times\r\n  \t\t\t\r\n  \t\t\t// \"this\" keyword during the success function will refer to the view\r\n  \t\t\t// \"this.model\" can easily be used to get the model we're pulling from\r\n  \t\t},\r\n  \t\t\r\n  \t\tfail: function()\r\n  \t\t{\r\n  \t\t\t// This is optional and will default to dd.displayFail (which can, in of itself, be overwritten)\r\n  \t\t\t// The fail function should return placeholder html when the model responds with a fail action\r\n  \t\t},\r\n  \t\r\n  \t\tonFill: function()\r\n  \t\t{\r\n  \t\t\t// This is a callback for when this display finishes filling out.\r\n  \t\t\t// This is called only only from the uppermost display, it is not inherited through any parent displays\r\n  \t\t\t// The \"this\" keyword during an onFill event is the controller using the populated data, not the view\r\n  \t\t},\r\n  \t\t\r\n  \t\tonWipe: function()\r\n  \t\t{\r\n  \t\t\t// This is a callback for when the display gets deconstructed, usually by a controller\r\n  \t\t}\r\n  \t}\r\n   \r\n   ****\r\n   */\n  // ITEMS\n\n  /**\r\n   * @property item_tree\r\n   * @member Riot.DDragon.display\r\n   * Draws an item builds from tree.\r\n   *\r\n   * **Draw Data Type:** item object\r\n   *\r\n   * **Displays:** Item build from tree, using the data as the top of the tree.\r\n   */\n\n\n  dd.addDisplay({\n    type: 'item_tree',\n    success: function (data) {\n      // item_tree_worker uses the select data in order to determine if it should select the first item in the tree\n      this.workingData.select = true;\n      this.workingData.depth = data.depth;\n      return '<div class=\"rg-item-tree\"><div class=\"treebox\">' + this.applyDisplay('item_tree_worker', data) + '</div></div>';\n    }\n  });\n  dd.addDisplay({\n    type: 'item_tree_worker',\n    success: function (data) {\n      var j = data.from.length,\n          r,\n          i,\n          select = false,\n          self = dd.display.item_tree_worker.success,\n          width,\n          spread;\n\n      if (this.workingData.select) {\n        select = this.workingData.select;\n        this.workingData.select = false;\n      } // The top of the tree\n\n\n      r = this.model.getImg(data.id, {\n        size: this.workingData.depth > 3 ? 'small' : 'normal',\n        wrap: 3,\n        classes: this.runClassTest(data) + (select ? 'selected ' : '') + 'treeimg'\n      }); // Begin tree building if there are children\n\n      if (j !== 0) {\n        width = 100 / j, spread = j === 1 ? 'single' : 'multi'; // Wrap the parent in the head of the tree. Then build the horizontal bar\n\n        r = '<div class=\"treehead ' + spread + '\">' + r;\n\n        if (spread === 'multi') {\n          r += '<div class=\"branch multi\"></div><div class=\"branch limb\" style=\"width: ' + (100 - width) + '%;\"></div>';\n        }\n\n        r += '</div>'; // </treehead>\n        // Each child potentially has its own tree\n\n        for (i = 0; i < j; i++) {\n          // Callback\n          r += '<div class=\"treebox\" style=\"width: ' + width + '%;\"><div class=\"branch ' + spread + '\"></div>' + self.call(this, this.model.get(data.from[i])) + '</div>';\n        }\n      }\n\n      return r;\n    }\n  });\n  /**\r\n   * @property item_tooltip\r\n   * @member Riot.DDragon.display\r\n   * Draws an item tooltip.\r\n   *\r\n   * **Draw Data Type:** item object\r\n   *\r\n   * **Displays:** The contents of an item tooltip.\r\n   */\n\n  dd.addDisplay({\n    type: 'item_tooltip',\n    // Expects: Individual Item Object\n    success: function (data) {\n      return this.model.getImg(data.id) + '<div class=\"info\">' + '<div class=\"name\">' + data.name + '</div>' + '<div class=\"description\">' + data.description + '</div>' + '<div class=\"cost\">' + fn.t('Cost_') + ' <span class=\"gold\">' + (data.specialRecipe !== 0 ? fn.t('SpecialRecipeLarge') : data.gold.total + ' (' + data.gold.base + ')') + '</span></div>' + '</div>';\n    }\n  });\n  /**\r\n   * @property item_modal\r\n   * @member Riot.DDragon.display\r\n   * Draws an item modal.\r\n   *\r\n   * **Draw Data Type:** item object\r\n   *\r\n   * **Displays:** A modal content piecing together an item's build into, build from (using {@link Riot.DDragon.display#item_tree}),\r\n   * and a description box. This display hooks events up to be traversable.\r\n   */\n\n  dd.addDisplay({\n    type: 'item_modal',\n    // Expects: Individual Item Object\n    success: function (data) {\n      return '' + '<div class=\"item-into\">' + this.applyDisplay('item_modal_build', data) + '</div>' + this.applyDisplay('item_tree', data) + '<div class=\"item-desc\">' + this.applyDisplay('item_modal_description', data) + '</div>';\n    },\n    onFill: function () {\n      var that = this;\n      fn.addEvent(this.box, 'mousedown', function (data) {\n        var d = fn.rgInfo(data.target, 3);\n\n        if (d) {\n          var item = dd.useModel(d.name).get(d.id);\n\n          if (fn.hasClass(data.target, 'treeimg')) {\n            fn.removeClass(fn.$('.selected', this.box)[0], 'selected');\n            fn.addClass(data.target, 'selected');\n            fn.$('.item-desc', this.box)[0].innerHTML = that.view.applyDisplay('item_modal_description', item);\n            fn.$('.item-into', this.box)[0].innerHTML = that.view.applyDisplay('item_modal_build', item);\n          } else if (fn.hasClass(data.target, 'intoimg')) {\n            that.redraw('getFull', d.id);\n          }\n        }\n      });\n    },\n    onWipe: function () {\n      fn.removeEvent(this.box, 'mousedown');\n    }\n  });\n  dd.addDisplay({\n    type: 'item_modal_description',\n    success: function (data) {\n      return '' + '<div class=\"title\">' + this.model.getImg(data.id, {\n        src: 'full'\n      }) + '<div class=\"name\">' + data.name + '</div>' + '<div class=\"cost\">' + fn.t('Cost_') + ' <span class=\"gold\">' + (data.specialRecipe !== 0 ? fn.t('SpecialRecipeLarge') : data.gold.total + ' (' + data.gold.base + ')') + '</span></div>' + '</div>' + '<div class=\"description\">' + data.description + '</div>';\n    }\n  });\n  dd.addDisplay({\n    type: 'item_modal_build',\n    success: function (data) {\n      var i,\n          j,\n          r = '';\n\n      for (i = 0, j = data.into.length; i < j; ++i) {\n        // Wrap 3 includes the data-rg information for reactive hooking\n        r += this.model.getImg(data.into[i], {\n          wrap: 3,\n          classes: 'intoimg'\n        });\n      }\n\n      return r;\n    }\n  });\n  /**\r\n   * @property rune_tooltip\r\n   * @member Riot.DDragon.display\r\n   * Draws a rune tooltip.\r\n   *\r\n   * **Draw Data Type:** rune object\r\n   *\r\n   * **Displays:** The contents of a rune tooltip.\r\n   */\n\n  dd.addDisplay({\n    type: 'rune_tooltip',\n    // Expects: Individual Rune Object\n    success: function (data) {\n      return this.model.getImg(data.id) + '<div class=\"info\">' + '<div class=\"name\">' + data.name + '</div>' + '<div class=\"description\">' + data.description + '</div>' + '</div>';\n    }\n  });\n  /**\r\n   * @property mastery_trunk\r\n   * @member Riot.DDragon.display\r\n   * Draws a single mastery column.\r\n   *\r\n   * **Draw Data Type:** mastery trunk object, contained in model.tree\r\n   *\r\n   * **Displays:** A measured out, full mastery column. Normally, this display is best called\r\n   * by a different display.\r\n   *\r\n   * For example: var Offense = Riot.DDragon.display.mastery_trunk.success(this.model.tree.Offense);\r\n   */\n\n  dd.addDisplay({\n    type: 'mastery_trunk',\n    success: function (trunk) {\n      var top = trunk.length,\n          left,\n          r = '',\n          data;\n      r += '<div class=\"rg-mastery-trunk\">';\n\n      while (top--) {\n        left = trunk[top].length;\n\n        while (left--) {\n          if (trunk[top][left] !== null) {\n            data = this.model.get(trunk[top][left].masteryId);\n            r += '<div class=\"mastery left' + left + ' top' + top + '\" data-rg-name=\"' + this.model.name + '\" data-rg-id=\"' + data.id + '\">' + this.model.getImg(data.id) + '</div>';\n          }\n        }\n      }\n\n      return r + '</div>';\n    }\n  });\n  /**\r\n   * @property champion_tooltip\r\n   * @member Riot.DDragon.display\r\n   * Draws a champion tooltip.\r\n   *\r\n   * **Draw Data Type:** champion object\r\n   *\r\n   * **Displays:** The contents of a champion tooltip.\r\n   */\n\n  dd.addDisplay({\n    type: 'champion_tooltip',\n    success: function (data) {\n      return this.model.getImg(data.id) + '<div class=\"info\">' + '<div class=\"name\">' + data.name + '</div>' + '<div class=\"description\">' + data.blurb + '</div>' + '</div>';\n    }\n  });\n  /**\r\n   * @property summoner_tooltip\r\n   * @member Riot.DDragon.display\r\n   * Draws a summoner tooltip.\r\n   *\r\n   * **Draw Data Type:** summoner object\r\n   *\r\n   * **Displays:** The contents of a summoner tooltip.\r\n   */\n\n  dd.addDisplay({\n    type: 'summoner_tooltip',\n    success: function (data) {\n      return this.model.getImg(data.id) + '<div class=\"info\">' + '<div class=\"name\">' + data.name + '</div>' + '<div class=\"description\">' + data.description + '</div>' + '</div>';\n    }\n  });\n  /**\r\n   * @class Riot.DDragon.view\r\n   * A class used to render the specified display type. This allows for a display to execute methods\r\n   * prior to doing various tasks, such as onWipe and onReactive. This class should not be created\r\n   * directly, instead use the {@link Riot.DDragon#useView}.\r\n   */\n\n  dd.views = {};\n\n  dd.view = function (display) {\n    this.init = false;\n    this.display = dd.display[display];\n    this.content = '';\n    this.model = false; // Working data is used and reset whenever a display is loaded.\n    // It's not used internally, it simply provides a reliably resetting data holder for displays\n\n    this.workingData = {}; // onFill is an event called by the controller that's specific to each display\n\n    if (dd.display[display].onFill) {\n      this.onFill = function () {\n        var that = this; // onFill commonly relies on rendered content to manipulate\n        // setTimeout forces a frame draw, allowing us to manipulate the real rendered content\n\n        setTimeout(function () {\n          that.view.display.onFill.call(that);\n        }, 0);\n      };\n    } else {\n      this.onFill = function () {};\n    } // The teardown side of onFill\n\n\n    this.onWipe = dd.display[display].onWipe || function () {}; // views can respond to controller reactive as well\n\n\n    this.onReactive = dd.display[display].onReactive || function () {}; // These holds data tester information\n    // This can be used (see addClassTest below) to optionally add classes based on information in the data\n\n\n    this.classTestsHash = {};\n    this.classTests = [];\n  };\n  /**\r\n   * @method loadModel\r\n   * Sets the model type this view uses.\r\n   * @param {Riot.DDragon.model} model The model type that this view uses.\r\n   */\n\n\n  dd.view.prototype.loadModel = function (model) {\n    this.model = model;\n  };\n  /** \r\n   * @method applyDisplay\r\n   * This executes the specified display but sets the scope to this view. This method will also catch\r\n   * errors that are thrown by the fired during the execution of the display.\r\n   * @param {String} display The display type to execute.\r\n   * @param {Object} data The data that will be passed to the display.\r\n   * @return {String} The result of calling the display's success method.\r\n   */\n\n\n  dd.view.prototype.applyDisplay = function (display, data) {\n    var r;\n\n    try {\n      r = dd.display[display].success.call(this, data);\n    } catch (e) {\n      if (typeof dd.display[display] === 'undefined') {\n        r = fn.er(e, 'view.applyDisplay', 'Nonexistent display (' + display + ')');\n      } else {\n        r = fn.er(e, 'view.applyDisplay', 'Invalid data used for display (' + display + ')');\n      }\n    }\n\n    return r;\n  };\n  /**\r\n   * @method load\r\n   * Loads the managed display with the specified data and executes it.\r\n   * @param {Object} data The data to pass to the display.\r\n   */\n\n\n  dd.view.prototype.load = function (data) {\n    this.data = data;\n\n    if (typeof data === 'object' && typeof data._action === 'string') {\n      if (typeof this.display.fail === 'object') {\n        this.content = this.display.fail.call(this);\n      } else {\n        this.content = dd.displayFail();\n      }\n\n      this.init = false;\n    } else {\n      // Reset working data\n      this.workingData = {}; // Run the display\n\n      this.content = this.applyDisplay(this.display.type, data);\n      this.init = true;\n    }\n  };\n  /**\r\n   * @method reload\r\n   * Attempts to retrieve data after a failure.\r\n   */\n\n\n  dd.view.prototype.reload = function () {\n    if (!this.init || typeof data === 'object' && typeof data._action === 'string') {\n      this.load(dd.retryModel(this.data));\n    }\n  };\n  /**\r\r\n   * @method addClassTest\r\n   * Adds a class test that will be executed when the view renders. If the test passes, then the\r\n   * specified classes will be added to the view's container.\r\n   * @param {String} test A test that will be passed to the {@link Riot.DDragon.fn#makeTest} method.\r\n   * @param {String[]} classes The classes that will be added when the test passes.\r\n   */\n\n\n  dd.view.prototype.addClassTest = function (test, classes) {\n    // Make the test and add the potential classes\n    var testObj = fn.makeTest(test);\n    testObj.classes = classes; // If we already have the key we're comparing to in, we replace that test\n\n    if (typeof this.classTestsHash[testObj.key] !== 'undefined') {\n      this.classTests[this.classTestsHash[testObj.key]] = testObj;\n    } else {\n      // the testshash just has an array position of the classTests\n      // We do this due to the speed of looping through arrays\n      this.classTestsHash[testObj.key] = this.classTests.push(testObj) - 1;\n    }\n  };\n  /**\r\n   * @method runClassTest\r\n   * Executes all classTests on the specified data.\r\n   * @param {Object} data The data to execute the tests against.\r\n   * @return {String} The classes that need to be added to the view.\r\n   */\n\n\n  dd.view.prototype.runClassTest = function (data) {\n    // We can run down since loop order doesn't matter when running the class tests\n    var i = this.classTests.length,\n        classes = '';\n\n    while (i--) {\n      // If it matches the test, we add the classes\n      if (fn.runTest(data, this.classTests[i])) {\n        classes += this.classTests[i].classes + ' ';\n      }\n    }\n\n    return classes;\n  };\n  /**\r\n   * @method useView\r\n   * Creates a new view using a specific display id. Wrapper function.\r\n   * @member Riot.DDragon\r\n   * @param {String} display The id of the display type this view will execute.\r\n   * @return {Riot.DDragon.view} The created view.\r\n   */\n\n\n  dd.useView = function (display) {\n    return new dd.view(display);\n  };\n\n  dd.box = {\n    modal: {\n      overrides: ['target'],\n\n      /*\r\n       * The type field is a unique identifier for this type field, used as the reference in the rgbox field\r\n       */\n      type: 'modal',\n\n      /*\r\n       * dataTarget defines what type of location the target needs to refer to\r\n       * It can be one of target, rel, box, or commonbox\r\n       *  target: This fills the data in to a target element, defined by the target field\r\n       *  rel: This fills the data in to a target element, defined by rel field in the target field\r\n       *  box: This creates a new box within the target field, then fills the data in to that\r\n       *  commonbox: This uses a common box based on this object's type, only allowing a single box. Otherwise works as a box does\r\n       */\n      dataTarget: 'commonbox',\n\n      /*\r\n       * target is used as either the fill target, fill reference target, or parent of the box used by the dataTarget\r\n       * This is a jQuery selector string\r\n       * a selector string of 'this' will cause it to use jQuery $(this), referring to the DOM element where this box type was called from\r\n       */\n      target: 'body',\n\n      /*\r\n       * If this should empty the target before append\r\n       * This is ignored on commonbox and box\r\n       * With rel, this refers to emptying the rel target, not the initial target\r\n       */\n      empty: false,\n\n      /*\r\n       * preselect allows the target selector, as well as the rel selector, to be saved as a whole selector\r\n       * This will increase performance, but won't allow the script to detect changes to the particular element\r\n       * If the target is 'body', this is suggested to be turned on always\r\n       */\n      preselect: true,\n\n      /*\r\n       * wrapsChildren is a binary switch that defines if the children of the target element should be extracted and wrapped in to\r\n       * a z-index breakdown, then places the data 'above' everything else.\r\n       * This is most commonly used for modals\r\n       */\n      wrapsChildren: true,\n\n      /*\r\n       * position is used only with box and commonbox dataTargets\r\n       * It's used to define against what the box is positioned. This can either be: none, target, or mouse\r\n       *  none: This drops the box in to the target with no positioning declared,\r\n       *    If none is used, 'from', 'to', 'offsetX', and 'offsetY' are not used.\r\n       *  target: This positions it relative to the target element.\r\n       *  mouse: This positions it based on mouse movement.\r\n       *  viewport: This positions it based on the viewport (visible page).\r\n       */\n      position: 'viewport',\n\n      /*\r\n       * drawFrom defines the start position to start drawing the box from, relative to the position\r\n       * This is a combo string consisting of a vertical and horizontal positioning, using standard css words.\r\n       * For example, 'top left' or 'bottom right' are valid.\r\n       * 'center' is also used, which tries to center the box relative to the target\r\n       * 'viewport' is used to draw from a direction that has the further coordinates from the sides of the viewport\r\n       *   so that if an element is in the top left quadrant of the viewport, it draws the box from the bottom right of the target\r\n       *\r\n       * In the case of position: mouse, drawFrom is not used. Instead, the drawFrom is assumed to just be the mouse.\r\n       */\n      drawFrom: 'center',\n\n      /*\r\n       * drawTo defines which direction the box draws in relation to the drawFrom\r\n       * this uses the same wordings that drawFrom uses, then draws in that direction\r\n       */\n      drawTo: 'center',\n\n      /*\r\n       * offsetX and offsetY are used to offset the resulting position\r\n       */\n      offsetX: 0,\n      offsetY: 0,\n\n      /*\r\n       * classes attaches a number of a classes on to the initial box element\r\n       */\n      classes: '',\n\n      /*\r\n       * Events are completely optional.\r\n       * There are two types of events for controllers: box events that you define here, and controller events that you define on controller creation\r\n       * They are all the same four: \"onCreate\", \"onDestroy\", \"onShow\", and \"onHide\". The box event always occurs before the controller event.\r\n       * Generally, it's best to place events in the controller stage, as at this stage is very box dependent\r\n       * Modals are a special case as they should deconstruct in the same way for all modals, when you click the background (wDown)\r\n       */\n      onCreate: function () {\n        var modal = this;\n        fn.addEvent(this.wDown, 'mousedown', function () {\n          modal.destroy();\n        });\n      },\n      onDestroy: function () {\n        if (this.wDown) {\n          fn.removeEvent(this.wDown, 'mousedown');\n        }\n      }\n    },\n    tooltip: {\n      type: 'tooltip',\n      dataTarget: 'commonbox',\n      target: 'body',\n      empty: false,\n      preselect: true,\n      wrapsChildren: false,\n      position: 'mouse',\n      drawTo: 'center',\n      offsetX: 30,\n      offsetY: 30,\n      classes: ''\n    },\n    container: {\n      overrides: ['target'],\n      type: 'container',\n      dataTarget: 'target',\n      target: 'body',\n      empty: false,\n      preselect: true,\n      wrapsChildren: false,\n      position: 'none',\n      classes: ''\n    }\n  }; // This really only exists as syntactic sugar\n\n  dd.addBox = function (box) {\n    dd.box[box.type] = box;\n  };\n  /**\r\n   * @class Riot.DDragon.controller\r\n   * Used to house event event executions and view renders while passing the proper data to said\r\n   * views. To add a controller please refer to {@link Riot.DDragon#buildController}.\r\n   */\n\n\n  dd.controllers = {\n    cur: 0\n  };\n\n  dd.controller = function (boxType) {\n    var overrides = [],\n        i; // Load the box data. Split based on if there were overrides specified\n\n    if (boxType.indexOf('_') !== -1) {\n      overrides = boxType.split('_'); // The box type is the first argument\n\n      this.loadBox(overrides.shift()); // Everything else is an override\n\n      for (i = 0; i < overrides.length; i++) {\n        this.boxData[this.boxData.overrides[i]] = overrides[i];\n      }\n    } else {\n      this.loadBox(boxType);\n    } // Default view just has empty content\n\n\n    this.view = false;\n    this.model = false; // Default display properties\n\n    this.visible = false;\n    this.repos = false;\n    this.refix = dd.fixed === 'absolute';\n    this.ranView = false; // There is no starting box DOM object\n\n    this.box = false; // Additional classes to add to the box\n\n    this.classes = ''; // Controllers, since they must interact with each other, has direct control over the controllers group\n    // id keeps this tracing sane\n\n    this.id = 'cont' + ++dd.controllers.cur;\n    dd.controllers[this.id] = this; // Some storage area for various box types\n\n    this.wrapper = [];\n    this.wDown = false;\n    this.wChildren = [];\n    this.current = '';\n    this.store = {}; // Events\n\n    this.onCreate = function () {};\n\n    this.onDestroy = function () {};\n\n    this.onShow = function () {};\n\n    this.onHide = function () {};\n\n    this.onReactive = function () {};\n  };\n  /**\r\n   * @method loadBox\r\n   * Initializes the box events of this controller.\r\n   * @param {String} type The box type to use as the base for this controller.\r\n   */\n\n\n  dd.controller.prototype.loadBox = function (type) {\n    this.boxData = fn.rebase({}, dd.box[type], {\n      onCreate: function () {},\n      onDestroy: function () {},\n      onShow: function () {},\n      onHide: function () {},\n      onReactive: function () {}\n    });\n    this.initSingleWrap = false;\n\n    if (window.rg_force_reducereflow && this.boxData.wrapsChildren && this.boxData.dataTarget === 'commonbox') {\n      this.singleWrap = true;\n    } else {\n      this.singleWrap = false;\n    }\n  };\n  /**\r\n   * @method create\r\n   * Creates the box element that will be controlled.\r\n   */\n\n\n  dd.controller.prototype.create = function () {\n    // Shorthand\n    var bd = this.boxData,\n        bSelect = '',\n        i,\n        j;\n\n    if (typeof bd.target === 'string') {\n      this.target = fn.$(bd.target, bd.preselect)[0];\n    } else {\n      this.target = bd.target;\n    } // Destroy the box if it exists, so we don't have wandering lost elements\n\n\n    if (this.box !== false) {\n      this.destroy();\n    } // Make the box\n\n\n    this.box = fn.mkDiv({\n      classes: 'ninja rg-box-' + bd.type + this.classes,\n      data: [{\n        k: 'control',\n        v: this.id\n      }]\n    }); // There are multiple methods that may happen depending on what type the dataTarget is\n\n    switch (bd.dataTarget) {\n      // rel shifts the target to be the one defined by the first target's rel attribute\n      case 'rel':\n        this.target = fn.$(this.target.getAttribute('rel'), bd.preselect)[0];\n      // If it's just target (or rel morphing in to target), there's only one choice path:\n      // Whether or not to empty out the target\n\n      case 'target':\n        if (bd.empty) this.target.innerHTML = '';\n        break;\n      // Common boxes are single box restrictions for specific box types\n\n      case 'commonbox':\n        bSelect = 'rg-commonbox-' + bd.type; // If this ID already exists, we kill it\n\n        if ((holder = fn.$('#' + bSelect, true)).length) {\n          dd.destroyBox(holder[0]);\n        } // We set the container to be the new commonbox\n\n\n        this.box.id = bSelect;\n\n      case 'box':\n        if (bd.position === 'target') {\n          this.box.style.position = 'absolute';\n          this.repos = true;\n        }\n\n        switch (bd.position) {\n          case 'mouse':\n            bd.drawFrom = 'mouse';\n\n          case 'viewport':\n            this.repos = true;\n            this.box.style.position = dd.fixed;\n            this.refix &= true;\n\n          case 'target':\n            this.target.style.position = 'relative';\n            break;\n        }\n\n        if (this.repos) {\n          // Divides the positioning in to something more easy to programatically read\n          // drawFrom\n          switch (bd.drawFrom) {\n            case 'mouse':\n            case 'center':\n            case 'page':\n              this.repos = [bd.drawFrom, bd.drawFrom];\n              break;\n\n            default:\n              this.repos = bd.drawFrom.split(' ');\n              break;\n          } // drawTo\n\n\n          switch (bd.drawTo) {\n            case 'center':\n            case 'page':\n              this.repos.push(bd.drawTo, bd.drawTo);\n              break;\n\n            default:\n              this.repos = this.repos.concat(bd.drawTo.split(' '));\n              break;\n          }\n        } // If the box wraps its children, then we need to do some div moving magic\n\n\n        if (bd.wrapsChildren) {\n          this.box.className += ' wrap-ceil';\n\n          if (this.singleWrap && this.initSingleWrap) {\n            fn.removeClass(this.wDown, 'ninja');\n          } else {\n            // We need a non-living list of the target's children\n            // This is because they will change\n            this.wChildren = fn.deadChildren(this.target); // Build the wrappers\n\n            this.groupWrapper = fn.mkDiv({\n              classes: 'wrap-floor',\n              append: this.target\n            });\n            this.wDown = fn.mkDiv({\n              classes: 'wrap-wall',\n              append: this.target,\n              style: 'position:' + dd.fixed + ';'\n            });\n\n            if (this.singleWrap) {\n              this.initSingleWrap = true;\n            } else {\n              this.wrapper = [this.groupWrapper, this.wDown, this.box];\n            } // Move all the dead children in to the first wrapper\n\n\n            for (i = 0, j = this.wChildren.length; i < j; i++) {\n              this.groupWrapper.appendChild(this.wChildren[i]);\n            }\n          }\n        }\n\n        break;\n    }\n\n    this.target.appendChild(this.box); // The actual repositioning must occur after the element is already present\n\n    this.move(); // event triggers\n\n    this.boxData.onCreate.call(this);\n    this.onCreate.call(this);\n  };\n  /**\r\n   * @method addClass\r\n   * Adds a css class to the managed box element.\r\n   * @param {String} class_ The css class to add.\r\n   */\n\n\n  dd.controller.prototype.addClass = function (class_) {\n    // Only add classes that aren't there\n    if (!fn.hasWord(this.classes, class_)) {\n      this.classes += ' ' + class_;\n\n      if (this.box !== false) {\n        fn.addClass(this.box, class_);\n      }\n    }\n  };\n  /**\r\n   * @method removeClass\r\n   * Removes a css class from the managed box element.\r\n   * @param {String} class_ The css class to remove.\r\n   */\n\n\n  dd.controller.prototype.removeClass = function (class_) {\n    this.classes = fn.removeWord(this.classes, class_);\n\n    if (this.box !== false) {\n      fn.removeClass(this.box, class_);\n    }\n  };\n  /**\r\n   * @method destroy\r\n   * Destroys the controller including the managed box element. This will execute the box's onDestroy\r\n   * method.\r\n   */\n\n\n  dd.controller.prototype.destroy = function () {\n    if (this.singleWrap && this.initSingleWrap) {\n      fn.addClass(this.wDown, 'ninja');\n      this.target.removeChild(this.box);\n    } else {\n      var i, j;\n\n      if (this.boxData.wrapsChildren) {\n        for (i = 0, j = this.wChildren.length; i < j; ++i) {\n          this.target.appendChild(this.wChildren[i]);\n        }\n\n        for (i = 0, j = this.wrapper.length; i < j; ++i) {\n          this.target.removeChild(this.wrapper[i]);\n        }\n\n        this.wDown = false;\n      } else {\n        fn.rmDiv(this.box);\n      }\n    }\n\n    this.box = false;\n    this.visible = false;\n\n    if (this.view) {\n      this.view.onWipe.call(this);\n      this.ranView = false;\n    }\n\n    this.boxData.onDestroy.call(this);\n    this.onDestroy.call(this);\n  };\n  /**\r\n   * @method newMV\r\n   * Updates both the current model and the current view being used.\r\n   * @param {String} model The new model type that will be used.\r\n   * @param {String} [view]\r\n   * The new view type that will be used. If this is not supplied, it will attempt to determine which\r\n   * view is desired based on the {modelName}_{controllerBoxType}.\r\n   */\n\n\n  dd.controller.prototype.newMV = function (model, view) {\n    // If no view was specified, \n    if (arguments.length < 2) {\n      var view = model + '_' + this.boxData.type;\n    }\n\n    this.removeClass('rg-display-[A-Za-z_0-9.]+');\n    this.model = dd.useModel(model);\n    this.view = dd.useView(view);\n    this.view.controller = this;\n    this.addClass('rg-display-' + this.view.display.type);\n    this.view.loadModel(this.model);\n  };\n  /**\r\n   * @method fillInView\r\n   * Sets the innerHTML of the box with the specified view. Generally this is not needed.\r\n   * @param {Riot.DDragon.view} view The view that needs to be rendered.\r\n   */\n\n\n  dd.controller.prototype.fillInView = function (view) {\n    if (this.ranView) {\n      view.onWipe.call(this);\n    } else {\n      this.ranView = true;\n    }\n\n    this.box.innerHTML = view.content;\n  };\n  /**\r\n   * @method runView\r\n   * Runs the view and places the data in the box's html. Any fire plans in place will be called at\r\n   * this time. This can only run after the controller has been created.\r\n   */\n\n\n  dd.controller.prototype.runView = function () {\n    if (this.box !== false && this.view) {\n      this.fillInView(this.view);\n\n      if (this.view.init === false) {\n        fn.fire.plan('model', {\n          'view': this.view,\n          'controller': this\n        }, function (p, e, fireId) {\n          if (typeof p.view.data !== 'undefined' && p.view.data._name === e.name) {\n            p.view.reload();\n            p.controller.fillInView(p.view);\n            p.controller.view.onFill.call(p.controller);\n            fn.fire.scrap(fireId);\n          }\n        });\n      } else {\n        this.view.onFill.call(this);\n      }\n    }\n  };\n  /**\r\n   * @method redraw\r\n   * Redraws the controller using the specified model call.\r\n   * @param {String} modelCall The method to call. These parameters are mapped as such:\r\n   * \r\n   * - get => get(arg[1])\r\n   * - get => get(arg[1], arg[2])\r\n   * - getFull => getFull(arg[1])\r\n   * - getFull => getFull(arg[1], arg[2])\r\n   * - collect => collect()\r\n   * - collect => collect(arg[1])\r\n   * - collect => collect(arg[1], arg[2])\r\n   *\r\n   * @param {Object...} args Any other arguments that need to be passed to the model's call.\r\n   */\n\n\n  dd.controller.prototype.redraw = function (modelCall) {\n    switch (modelCall + arguments.length) {\n      case 'get2':\n        this.view.load(this.model.get(arguments[1]));\n        break;\n\n      case 'get3':\n        this.view.load(this.model.get(arguments[1], arguments[2]));\n        break;\n\n      case 'getFull2':\n        this.view.load(this.model.getFull(arguments[1]));\n        break;\n\n      case 'getFull3':\n        this.view.load(this.model.getFull(arguments[1], arguments[2]));\n        break;\n\n      case 'collect1':\n        this.view.load(this.model.collect());\n        break;\n\n      case 'collect2':\n        this.view.load(this.model.collect(arguments[1]));\n        break;\n\n      case 'collect3':\n        this.view.load(this.model.collect(arguments[1], arguments[2]));\n        break;\n    }\n\n    ;\n    this.runView();\n  };\n  /**\r\n   * @method moveXY\r\n   * Repositions the box to the specified location.\r\n   * @param {Number} x The left position of the box.\r\n   * @param {Number} y The top position of the box.\r\n   */\n\n\n  dd.controller.prototype.moveXY = function (x, y) {\n    if (this.refix) {\n      x += document.documentElement.scrollLeft;\n      y += document.documentElement.scrollTop;\n    }\n\n    this.box.style.left = x + 'px';\n    this.box.style.top = y + 'px';\n  };\n  /**\r\n   * @method move\r\n   * Moves the box based on the given settings and the supplied event. This allows for the box to be\r\n   * positioned in line with the mouse cursor easily.\r\n   * @param {Object} event The event object supplied by a handler. \r\n   */\n\n\n  dd.controller.prototype.move = function (event) {\n    if (typeof event === 'undefined') {\n      event = {\n        clientY: 0,\n        clientX: 0\n      };\n    } // Dynamic Repositioning\n\n\n    if (this.repos) {\n      var top, left, vs; // There are different ways to position based on what we measure against\n\n      switch (this.boxData.position) {\n        case 'target':\n          vs = [this.target.offsetHeight, this.target.offsetWidth];\n          break;\n\n        case 'mouse':\n        case 'viewport':\n          vs = [window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight, window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth];\n          break;\n      } // The actual repositioning\n      // repos[0] is positioning from, top or bottom\n\n\n      switch (this.repos[0]) {\n        case 'center':\n          top = vs[0] / 2;\n          break;\n\n        case 'page':\n          top = vs[0];\n          break;\n\n        case 'mouse':\n          top = event.clientY;\n\n          if (top < vs[0] / 2) {\n            this.repos[2] = 'bottom';\n          } else {\n            this.repos[2] = 'top';\n          }\n\n          break;\n      } // repos[1] is positioning from, left or right\n\n\n      switch (this.repos[1]) {\n        case 'center':\n          left = vs[1] / 2;\n          break;\n\n        case 'page':\n          left = vs[1];\n          break;\n\n        case 'mouse':\n          left = event.clientX;\n\n          if (left < vs[1] / 2) {\n            this.repos[3] = 'right';\n          } else {\n            this.repos[3] = 'left';\n          }\n\n          break;\n      } // repos[2] is positioning to, top or bottom\n\n\n      switch (this.repos[2]) {\n        case 'center':\n          top -= this.box.offsetHeight / 2;\n          break;\n\n        case 'top':\n          top -= this.box.offsetHeight + this.boxData.offsetY;\n          break;\n\n        case 'bottom':\n          top += this.boxData.offsetY;\n          break;\n      } // repos[3] is positioning to, left or right\n\n\n      switch (this.repos[3]) {\n        case 'center':\n          left -= this.box.offsetWidth / 2; //msh(top + ' -- ' + left + ' & ' + this.box.offsetHeight + ' -- ' + this.box.offsetWidth);\n\n          break;\n\n        case 'left':\n          left -= this.box.offsetWidth + this.boxData.offsetX;\n          break;\n\n        case 'right':\n          left += this.boxData.offsetX;\n          break;\n      }\n\n      this.moveXY(left, top);\n    }\n  };\n  /**\r\n   * @method show\r\n   * Shows the box.\r\n   */\n\n\n  dd.controller.prototype.show = function () {\n    if (!this.visible) {\n      fn.removeClass(this.box, 'ninja');\n      this.visible = true;\n      this.boxData.onShow.call(this);\n      this.onShow.call(this);\n    }\n  };\n  /** \r\n   * @method hide\r\n   * Hides the box.\r\n   */\n\n\n  dd.controller.prototype.hide = function () {\n    if (this.visible) {\n      fn.addClass(this.box, 'ninja');\n      this.visible = false;\n      this.boxData.onHide.call(this);\n      this.onHide.call(this);\n    }\n  }; // Uses fn.addEvent, but 'this' is the controller, and target is box\n\n  /**\r\n   * @method addEvent\r\n   * Adds an event to the box, however the scope of the callback will be the controller.\r\n   * @param {String} event The event to listen for.\r\n   * @param {Function} callback The function to execute when the event fires.\r\n   */\n\n\n  dd.controller.prototype.addEvent = function (event, callback) {\n    var self = this;\n    fn.addEvent(this.target || fn.$(this.boxData.target)[0], event, function (e) {\n      callback.call(self, e);\n    });\n  };\n  /**\r\n   * @method reactive\r\n   * This is the most commmon method for controllers to react to event information it controls digging\r\n   * for data, button handling, similar event propogation restriction and success/fail events. It\r\n   * expects a data object returned by fn.addEvent callbacks. This data object can be manipulated\r\n   * before hand in order to change how reactive reacts\r\n   * @param {Object} data The data object passed from an {@link Riot.DDragon.fn#addEvent} callback.\r\n   */\n\n\n  dd.controller.prototype.reactive = function (data) {\n    // First: Extending out the event data\n    var basic = {\n      action: 'get',\n      reactDepth: 5,\n      stopSimilar: false,\n      allowShow: true,\n      allowMove: true,\n      allowHide: true,\n      allowModelChange: true,\n      allowBoxCreate: true,\n      onReactive: function () {},\n      success: function () {},\n      fail: function () {},\n      execute: true\n    },\n        potential;\n    data = fn.rebase(data, basic); // Button Settings kill early\n\n    if (data.buttonRestrict !== -1 && data.button !== data.buttonRestrict) return; // Get more data and kill process if there was no event to react to\n\n    data.info = fn.rgInfo(data.target, data.reactDepth);\n\n    if (data.info === false) {\n      if (data.allowHide) {\n        this.hide();\n      }\n\n      data.fail.call(this, data);\n      return;\n    } // We give the controller and view a chance to respond to the data, then the onReactive setting here\n    // Reactive events can return false to kill this process\n\n\n    if (this.onReactive(data) === false || this.view && this.view.onReactive.call(this, data) === false || data.onReactive.call(this, data) === false) {\n      data.execute = false;\n    } // Kill false executes by this point\n\n\n    if (data.execute === false) {\n      data.fail.call(this, data);\n      return;\n    } // Potential model change\n\n\n    data.info.wrongModel = data.info.name !== this.model.name;\n    data.info.modelChange = data.info.wrongModel && data.allowModelChange;\n\n    if (data.info.modelChange) {\n      this.newMV(data.info.name);\n    } else if (data.info.wrongModel) {\n      return;\n    } // Potential box creation\n\n\n    if (data.allowBoxCreate && this.box === false) {\n      this.create(); // Force a redraw\n\n      this.current = '';\n    } // Check for an id change (or model change)\n    // Run action if there was a change\n\n\n    data.info.idChange = data.info.id !== this.current || data.info.modelChange;\n\n    if (data.info.idChange) {\n      if (data.action === 'collect') {\n        this.redraw('collect');\n      } else {\n        this.redraw(data.action, data.info.id);\n      }\n\n      this.current = data.info.id;\n    } // stop similar events\n\n\n    if (data.stopSimilar) {\n      var subEvent = function (_data) {\n        _data.event.stopPropagation();\n      };\n\n      fn.addEvent(this.box, data.type, subEvent);\n\n      this.onDestroy = function () {\n        fn.removeEvent(this.box, data.type, subEvent);\n      };\n    } // show and move\n\n\n    if (data.allowShow) {\n      var moveTest = this.visible;\n      this.show();\n\n      if (data.allowMove || !moveTest) {\n        this.move(data.event);\n      }\n    }\n\n    data.success.call(this, data);\n  };\n  /*\r\n   * Mixes addEvent with reactive\r\n   */\n\n  /**\r\n   * @method addReactiveEvent\r\n   * Combines the functionality of reactive and addEvent. This also allows for a global default to be\r\n   * applied to the eventData prior to the call to reactive.\r\n   * @param {String} event The event to listen for.\r\n   * @param {Object} extendData The data to be applied to the eventData prior to execution.\r\n   */\n\n\n  dd.controller.prototype.addReactiveEvent = function (event, extendData) {\n    this.addEvent(event, function (eventData) {\n      this.reactive(fn.rebase(eventData, extendData || {}));\n    });\n  };\n  /**\r\n   * @method\r\n   * @member Riot.DDragon\r\n   * Destroys the controller associated with the specified box element.\r\n   * @param {HTMLElement} elem The element that is being managed.\r\n   */\n\n\n  dd.destroyBox = function (elem) {\n    var contId = elem.getAttribute('data-control');\n\n    if (contId !== null || contId !== '') {\n      dd.controllers[contId].destroy();\n    } else {\n      fn.rmDiv(elem);\n    }\n  };\n  /**\r\n   * @method\r\n   * @member Riot.DDragon\r\n   * Creates a new controller with the specified box.\r\n   * @param {String} box The box this controller manages.\r\n   */\n\n\n  dd.useController = function (box) {\n    return new dd.controller(box);\n  };\n  /**\r\n   * @method\r\n   * @member Riot.DDragon\r\n   * Combines a modle, view, and controller into a single object.\r\n   * @param {Boolean} create\r\n   * Whether to create the box element or not. If this is not required, it can be dropped from the\r\n   * argument list.\r\n   * @param {String} model The name of the model to use in the view.\r\n   * @param {String} view The name of the view to use.\r\n   * @param {String} box The box the controller will manage.\r\n   * @return {Riot.DDragon.controller} The created controller.\r\n   */\n\n\n  dd.buildController = function () {\n    // Optional create parameter. If there are 4 parameters\n    var i = arguments.length,\n        create = true;\n    if (i === 4) create = arguments[0];\n    var c = dd.useController(arguments[i - 1]);\n    c.newMV(arguments[i - 3], arguments[i - 2]);\n    if (create) c.create();\n    return c;\n  };\n\n  dd.players = {};\n  /**\r\n   * @class Riot.DDragon.player\r\n   * A data container class representing total player character data, intended to be a bucket data holder\r\n   * @param {Object} [options] Default data to store on to the player object at creation\r\n   */\n\n  dd.player = function (options) {\n    options = options || {};\n    fn.rebase(this, options, {\n      name: '',\n      summonerlevel: 30,\n      champion: false,\n      level: 1,\n      summoner: [],\n      item: [],\n      rune: {\n        red: [],\n        yellow: [],\n        blue: [],\n        black: []\n      },\n      mastery: {},\n      masteryString: '',\n      stacks: {}\n    });\n    var masteryC = 3 * 6 * 4;\n\n    while (masteryC--) {\n      this.masteryString += '0';\n    }\n\n    this.stats = this.basicStats();\n  };\n\n  dd.player.prototype.basicStats = function () {\n    return {\n      armor: 0,\n      basearmor: 0,\n      bonusarmor: 0,\n      spellblock: 0,\n      basespellblock: 0,\n      bonusspellblock: 0,\n      attackdamage: 0,\n      spelldamage: 0,\n      dodge: 0,\n      flatarmorpenetration: 0,\n      flatmagicpenetration: 0,\n      percentarmorpenetration: 0,\n      percentmagicpenetration: 0,\n      cooldown: 0,\n      cooldownsummoner: 0,\n      attackrange: 0,\n      attackspeed: 0,\n      crit: 0,\n      critdamage: 2,\n      hp: 0,\n      hpregen: 0,\n      mp: 0,\n      mpregen: 0,\n      movespeed: 300,\n      goldper10: 0,\n      timedead: 0\n    };\n  };\n\n  dd.player.prototype.setMastery = function (id, points) {\n    this.mastery[id] = points;\n    this.updateMasteryStringFor(id);\n    return true;\n  };\n\n  dd.player.prototype.addMastery = function (id) {\n    var masteryModel = dd.useModel('mastery');\n\n    if (!masteryModel.init) {\n      return false;\n    }\n\n    var mastery = masteryModel.get(id),\n        count = this.getMastery(id);\n\n    if (count >= mastery.ranks) {\n      return false;\n    }\n\n    this.mastery[id] += 1;\n    this.updateMasteryStringFor(id);\n    return true;\n  };\n\n  dd.player.prototype.setMasteryByString = function (masteryString) {\n    var tree = 3 + 1,\n        col = 6 + 1,\n        row = 4 + 1,\n        pos,\n        points,\n        id;\n\n    while (--tree) {\n      while (--col) {\n        while (--row) {\n          pos = tree * 24 + col * 4 + row;\n          points = parseInt(masteryString.charAt(pos), 10);\n\n          if (points) {\n            id = tree + '' + col + '' + row;\n            this.mastery[id] = points;\n          }\n        }\n      }\n    }\n\n    this.masteryString = masteryString;\n  };\n\n  dd.player.prototype.updateMasteryStringFor = function (id) {\n    var tree = parseInt(id.charAt(0), 10) - 2,\n        col = parseInt(id.charAt(1), 10) - 1,\n        row = parseInt(id.charAt(2), 10) - 1,\n        pos = tree * 24 + col * 4 + row;\n    this.masteryString = this.masteryString.slice(0, pos) + this.mastery[id] + this.masteryString.slice(pos + 1);\n  };\n\n  dd.player.prototype.getMastery = function (id) {\n    if (typeof this.mastery[id] === 'undefined') {\n      this.mastery[id] = 0;\n    }\n\n    return this.mastery[id];\n  };\n\n  dd.player.prototype.setRune = function (id) {\n    var runeModel = dd.useModel('rune');\n\n    if (!runeModel.init) {\n      return false;\n    }\n\n    var rune = runeModel.get(id),\n        type = rune.rune.type,\n        count = this.rune[type].length;\n\n    if (type === 'black' && count >= 3 || count >= 9) {\n      return false;\n    }\n\n    this.rune[type].push(rune.id);\n    return true;\n  };\n\n  dd.player.prototype.setChampion = function (id) {\n    this.champion = id;\n    return true;\n  };\n\n  dd.defaultPlayer = new dd.player();\n  /**\r\n  * @method\r\n  * @member Riot.DDragon.fn\r\n  * Uses a series of stats to figure out a champion's current attack speed\r\n  * @param {Number} level The current champion level\r\n  * @param {Number} offset The current champion's attack speed offset (in stats)\r\n  * @param {Number} aspdper The current champion's attack speed per level\r\n  * @param {Number} aspd (Optional) Attack speed bonus from other sources\r\n  */\n\n  fn.calcAspd = function (level, offset, aspdper, aspd) {\n    aspd = aspd || 0;\n    var i = 1 / (1.6 * (1 + offset)) * (1 + aspd + aspdper * (level - 1) / 100);\n    return Math.round(i * 1000) / 1000;\n  };\n\n  dd._spellDataLink = function (calc, spell, spellLevel, player) {\n    this.calc = calc;\n    this.spell = spell;\n    this.spellLevel = spellLevel;\n    this.player = player;\n    this.data = fn.rebase({}, spell.datavalues);\n    this.generateLinks();\n  };\n\n  dd._spellDataLink.prototype.generateLinks = function () {\n    var i, j, v; // vars\n\n    for (i = 0, j = this.spell.vars.length; i < j; ++i) {\n      v = this.spell.vars[i];\n      this.data[v.key] = this.generateLink(v);\n    } // effects\n\n\n    for (i = 1, j = this.spell.effect.length; i < j; ++i) {\n      this.data['e' + i] = this.calc === 0 ? this.spell.effectBurn[i] : this.spell.effect[i][this.spellLevel - 1];\n    }\n  };\n  /*\r\n   * Basic Link Types:\r\n   *   bonusattackdamage, attackdamage, bonushealth, health, abilitypower,\r\n   *   bonusarmor, armor, bonusspellblock, spellblock, bonusmovespeed, movespeed,\r\n   *   bonusmana, mana\r\n   *\r\n   * All basic links can be preceded by @dynamic. in order to clear out the ( ) around\r\n   * them in calc levels less than 2 (calc by player == calc 2)\r\n   *\r\n   * Special Link Types:\r\n   *   @text = should always be equivalent to default\r\n   *   @cooldownchampion = uses spell cooldown reduction (player.cooldown)\r\n   *   @cooldownsummoner = uses summoner spell cooldown reduction (player.cooldownsummoner)\r\n   *   @stacks = Multiplicative based on spell stacks\r\n   *   @player.* = Gets a direct stat from the player object (usually level)\r\n   *   @special.* = Must have specialized code written just for it\r\n   */\n\n\n  dd._spellDataLink.prototype.generateLink = function (v) {\n    // No Calculations, using primarily burned in values\n    if (this.calc === 0) {\n      switch (v.link) {\n        case '@player.level':\n          return v.coeff[0] + ' - ' + v.coeff[v.coeff.length - 1];\n\n        case '@cooldownsummoner':\n        case '@cooldownchampion':\n          return this.spell.cooldownBurn;\n\n        case '@stacks':\n          if (typeof v.coeff === 'object') {\n            return v.coeff.join('/') + ' ' + fn.t('perStack');\n          }\n\n          return v.coeff + ' ' + fn.t('perStack');\n\n        default:\n          if (v.link.indexOf('@dynamic.') === 0) {\n            return ''; // (+{{ ... }}) / ({{ }})\n          }\n\n          if (typeof v.coeff === 'object') {\n            return v.coeff.join('/');\n          }\n\n          return v.coeff;\n      }\n    } // Calculations are via the individual spell itself. No player calculations.\n    else if (this.calc === 1) {\n        switch (v.link) {\n          case '@player.level':\n            return v.coeff[0] + ' - ' + v.coeff[v.coeff.length - 1];\n\n          case '@stacks':\n            if (typeof v.coeff === 'object') {\n              return v.coeff[this.spellLevel - 1] + ' ' + fn.t('perStack');\n            }\n\n            return v.coeff + ' ' + fn.t('perStack');\n\n          case '@cooldownsummoner':\n          case '@cooldownchampion':\n            return this.spell.cooldown[this.spellLevel - 1];\n\n          default:\n            if (typeof v.coeff === 'object') {\n              return v.coeff[this.spellLevel - 1];\n            }\n\n            return v.coeff;\n        }\n      } // Calculations use all player stats, multiplying out coefficients and similar.\n      else if (this.calc === 2) {\n          switch (v.link) {\n            default:\n              break;\n          }\n        }\n\n    return '';\n  };\n\n  dd._spellDataLink.prototype.getLeveltip = function () {//return fn.format(this.spell.leveltip[].replace(/{%/g,'{{').replace(/%}/g,'}}'), data);\n  };\n\n  dd._spellDataLink.prototype.getTooltip = function () {\n    return fn.format(this.spell.tooltip, this.data);\n  };\n  /**\r\n   * @method\r\n   * @member Riot.DDragon.fn\r\n   * Creates tooltip text out of a spell object and all the data that goes in to it\r\n   * This is an expensive process, use it sparingly.\r\n   * @param {Number} calc A determination of we're going to pull data and show the data.\r\n   * Possible values:\r\n   *   0: No calculations are performed and the preburned values are used.\r\n   *   1: spellLevel is used to determine how spells are shown\r\n   *   2: Same as 1, except coefficients are also calculated in to player data.\r\n   * @param {Object} spell The spell object we're trying to get tooltip data off of\r\n   * @param {Number} [spellLevel=1] The spell level we're referencing\r\n   * @param {Riot.DDragon.player} [player=defaultPlayer] A player object to fill data in with\r\n   */\n\n\n  dd.spellDataLink = function (calc, spell, spellLevel, player) {\n    spellLevel = spellLevel || 1;\n    player = player || dd.defaultPlayer;\n    return new dd._spellDataLink(calc, spell, spellLevel, player);\n  };\n\n  if (typeof w.rg_force_endapp !== 'undefined') {\n    w.rg_force_endapp();\n  } else {\n    // The Default End Application\n    dd.dynamicScan(fn.$('body')[0]);\n    dd.endApp = {\n      tooltip: dd.buildController('item', 'item_tooltip', 'tooltip'),\n      itemmodal: dd.buildController(false, 'item', 'item_modal', 'modal')\n    }; // Tooltips (All)\n\n    dd.endApp.tooltip.addReactiveEvent('mousemove'); // item modal\n\n    dd.endApp.itemmodal.addReactiveEvent('click', {\n      buttonRestrict: 0,\n      stopSimilar: true,\n      allowModelChange: false,\n      action: 'getFull',\n      success: function () {\n        dd.endApp.tooltip.hide();\n      }\n    });\n  }\n\n  (function () {\n    // Takes app data (as produced by addApp), checks for requirements\n    // Executes based on presence of requirements. Otherwise delay executes\n    function appCycle(app) {\n      var m;\n\n      reqstrip: for (m = 0; m < app.ms.length; ++m) {\n        // Strip out all requirements that are already loaded\n        while (dd.useModel(app.ms[m]).init) {\n          app.ms.splice(m, 1);\n\n          if (typeof app.ms[m] === 'undefined') {\n            break reqstrip;\n          }\n        } // Respond to applications that will soon load\n\n\n        fn.fire.plan('model', {\n          index: m,\n          app: app\n        }, function (planData, execData, fireId) {\n          if (planData.app.ms[planData.index] === execData.name) {\n            planData.app.ms.splice(planData.index, 1);\n\n            if (planData.app.ms.length === 0) {\n              planData.app.app();\n              fn.fire.scrap(fireId);\n            }\n          }\n        });\n      }\n\n      if (app.ms.length === 0) {\n        app.app();\n      }\n    }\n\n    ;\n    /**\r\n    * @method\r\n    * @member Riot.DDragon\r\n    * Adds an application definition to DataDragon.\r\n    * @param {Array} ms The required models that need to be loaded before the app can be run.\r\n    * @param {Function} app The function to execute once the models have been loaded.\r\n    */\n\n    dd.addApp = function (ms, app) {\n      appCycle({\n        'app': app,\n        'ms': ms\n      });\n    }; // Execute all the apps added before\n\n\n    var i, j;\n\n    for (i = 0, j = dd.app.length; i < j; ++i) {\n      appCycle(dd.app[i]);\n    }\n  })();\n};\n/* END OF DDRAGON */","map":{"version":3,"sources":["/Users/abidin/Desktop/pagina/src/components/dragontail-10.7.1/10.7.1/js/dragonmagic.raw.js"],"names":["Riot","DDragon","fn","dataTypes","rg","dd","isArray","item","Object","prototype","toString","call","getJSON","file","c","xhr","ready","load","data","JSON","parse","m","exec","window","jsonp","getCSS","s","document","createElement","rel","type","href","$","appendChild","rebase","i","j","arguments","length","under","prop","hasOwnProperty","objectDig","obj","path","indexOf","split","sMath","a","op","b","mkDiv","options","r","classes","className","style","cssText","append","setAttribute","k","v","rmDiv","div","parentNode","removeChild","hasWord","text","word","RegExp","test","removeWord","replace","hasValue","reg","removeValue","hasClass","elem","class_","addClass","removeClass","radioClass","children","childNodes","deadChildren","hasChildNodes","dead","push","twigVarReg","format","template","join","twigMatch","each","arr","func","rgData","attr","getAttribute","rgInfo","depth","e","name","id","aux","makeTest","testString","testMatch","testObject","det","evOp","evVs","parseFloat","or","substring","runTest","testReturn","result","inv","dataPiece","key","getImgSize","val","size","parseInt","getImg","image","img","basic","src","version","group","cap","wrap","attrs","skin","gray","pre","post","sprite","h","w","x","y","full","cdn","getElementsByClassName","body","getElementsByTagName","context","elems","el","fn$data","fn$serve","selector","charAt","getElementById","preselect","target","er","error","loc","message","console","log","setTimeout","addEvent","element","callback","events","handler","event","fixEvent","windowTarget","srcElement","button","buttonRestrict","buttonData","handles","addEventListener","$$guid","guid","handleEvent","removeEvent","removeEventListener","pop","returnValue","handlers","ownerDocument","parentWindow","$$handleEvent","preventDefault","stopPropagation","cancelBubble","watch","dig","store","timer","clearTimeout","fire","plan","planData","scrap","splice","execData","init","selectorEngine","models","modelParsers","loadedPartial","stats","attackspeed","calcAspd","attackspeedoffset","attackspeedperlevel","l1s","l1","base","per","loadedFull","count","spells","addModelParser","remapFunc","numID","profileiconmax","model","dataSource","dataVersion","that","loading","all","override","keysLoaded","translated","substr","n","remapKeys","dl","lsKey","l","source","loadAll","d","makeKeys","rename","keySource","keys","tree","runFullParsers","mps","mp","amp","loadSingle","parseData","parsed","translate","useModel","searchName","tFilter","searchHash","searchRaw","searchString","colloq","tags","colloqTag","translatedColloqTag","t","parseAllData","get","remap","fireId","_action","_name","getFull","sub","slice","collect","parent","sData","fData","filterInit","filter","f","fKeys","sortInit","sort","pos","filterExec","stat","fi","fi_","fj_","fm","ftemp","fholder","fr","typeOfFData","sortDefault","keya","keyb","sa","sb","holder","merge","sA","sB","Left","Right","End","iL","iR","iRSwitch","collection","Array","tryagain","sN","sK","sW","sI","Math","min","deleteCollect","datamap","dataArray","ndata","remodel","newModel","newKeys","stringify","rmModel","retryModel","action","modelAux","info","infoAux","valueAux","addApp","inline","innerHTML","value","display","dynamicScan","dataReg","child","tr","searchKeyIgnore","searchKeyRemap","toLowerCase","css","displayFail","addDisplay","displayList","subName","subDisplay","success","workingData","select","applyDisplay","from","self","item_tree_worker","width","spread","runClassTest","description","specialRecipe","gold","total","onFill","box","view","redraw","onWipe","into","trunk","top","left","masteryId","blurb","views","content","onReactive","classTestsHash","classTests","loadModel","fail","reload","addClassTest","testObj","useView","modal","overrides","dataTarget","empty","wrapsChildren","position","drawFrom","drawTo","offsetX","offsetY","onCreate","wDown","destroy","onDestroy","tooltip","container","addBox","controllers","cur","controller","boxType","loadBox","shift","boxData","visible","repos","refix","fixed","ranView","wrapper","wChildren","current","onShow","onHide","initSingleWrap","rg_force_reducereflow","singleWrap","create","bd","bSelect","destroyBox","concat","groupWrapper","move","newMV","fillInView","runView","p","modelCall","moveXY","documentElement","scrollLeft","scrollTop","clientY","clientX","vs","offsetHeight","offsetWidth","innerHeight","clientHeight","innerWidth","clientWidth","show","hide","reactive","reactDepth","stopSimilar","allowShow","allowMove","allowHide","allowModelChange","allowBoxCreate","execute","potential","wrongModel","modelChange","idChange","subEvent","_data","moveTest","addReactiveEvent","extendData","eventData","contId","useController","buildController","players","player","summonerlevel","champion","level","summoner","rune","red","yellow","blue","black","mastery","masteryString","stacks","masteryC","basicStats","armor","basearmor","bonusarmor","spellblock","basespellblock","bonusspellblock","attackdamage","spelldamage","dodge","flatarmorpenetration","flatmagicpenetration","percentarmorpenetration","percentmagicpenetration","cooldown","cooldownsummoner","attackrange","crit","critdamage","hp","hpregen","mpregen","movespeed","goldper10","timedead","setMastery","points","updateMasteryStringFor","addMastery","masteryModel","getMastery","ranks","setMasteryByString","col","row","setRune","runeModel","setChampion","defaultPlayer","offset","aspdper","aspd","round","_spellDataLink","calc","spell","spellLevel","datavalues","generateLinks","vars","generateLink","effect","effectBurn","link","coeff","cooldownBurn","getLeveltip","getTooltip","spellDataLink","rg_force_endapp","endApp","itemmodal","appCycle","app","reqstrip","ms","index"],"mappings":"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","sourcesContent":["/* START OF FILE - core.js */\r\n/**\r\n * @class Riot\r\n * @singleton\r\n * The global riot games namespace.\r\n */\r\n/**\r\n * @class Riot.DDragon\r\n * @singleton\r\n * The global Data Dragon class.\r\n */\r\n/**\r\n * @class Riot.DDragon.fn\r\n * @singleton\r\n * An object used to store all static utility function.\r\n */\r\nRiot.DDragon.fn = {};\r\n\r\nRiot.DDragon.dataTypes = ['item','champion','mastery','rune','summoner','language'];\r\n\r\n(function()\r\n{\r\n\tvar rg = Riot,\r\n\t\tdd = rg.DDragon,\r\n\t\tfn = dd.fn;\r\n\t\r\n\tfn.isArray = function (item)\r\n\t{\r\n\t\treturn Object.prototype.toString.call(item) === '[object Array]';\r\n\t};\r\n\t/**\r\n\t * @method\r\n\t * This requires the ajax functions within loader.js. This simplifies and attaches the functions\r\n\t * together but targets the data to json packets only.\r\n\t * @param {String} file The file to load.\r\n\t * @param {Function} callback The callback function to execute when the data is returned.\r\n\t */\r\n\tfn.getJSON = function (file,c)\r\n\t{\r\n\t\tif(dd.xhr.ready)\r\n\t\t{\r\n\t\t\tdd.xhr.load(file, function(data)\r\n\t\t\t{\r\n\t\t\t\tc(JSON.parse(data));\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar m = /([A-Za-z0-9]+)\\.json/.exec(file);\r\n\t\t\t\r\n\t\t\twindow['rg_data_callback_'+m[1]] = function(data)\r\n\t\t\t{\r\n\t\t\t\tc(data);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tdd.jsonp(file+'p');\r\n\t\t}\r\n\t};\r\n\t\r\n\t/** \r\n\t * @method\r\n\t * Attaches a new stylesheet to the page.\r\n\t * @param {String} file The url to the desired stylesheet.\r\n\t */\r\n\tfn.getCSS = function (file)\r\n\t{\r\n\t\tvar s = document.createElement('link');\r\n\t\t\r\n\t\ts.rel = 'stylesheet';\r\n\t\ts.type = 'text/css';\r\n\t\ts.href = file;\r\n\t\t\r\n\t\tfn.$('head',true)[0].appendChild(s);\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * This merges each argument after data 'under' the data object effectively treating each\r\n\t * additional object passed as a default to the one before it.\r\n\t * \tfunction myFunc (config) {\r\n\t * \t\tconfig = rg.dd.fn.rebase(config, {\r\n\t * \t\t\tconditions: true,\r\n\t * \t\t\tactions: true\r\n\t * \t\t});\r\n\t * \t\r\n\t * \t\tif (config.conditions) {\r\n\t * \t\t\tconsole.log('Conditions Run!');\r\n\t * \t\t}\r\n\t * \t\r\n\t * \t\tif (config.actions) {\r\n\t * \t\t\tconsole.log('Actions Run!');\r\n\t * \t\t}\r\n\t * \t}\r\n\t * \t\r\n\t * \tmyFunc({\r\n\t * \t\tconditions: false\r\n\t * \t});\r\n\t * \t\r\n\t * \t//logs 'Actions Run!'\r\n\t * @param {Object} data The base object being merged into.\r\n\t * @param {Object...} under The objects used to default the base data object.\r\n\t * @return {Object} The merged object.\r\n\t */\r\n\tfn.rebase = function (data)\r\n\t{\r\n\t\tvar i = 0,\r\n\t\t\tj = arguments.length,\r\n\t\t\tunder,prop,type;\r\n\t\t\r\n\t\twhile (++i < j)\r\n\t\t{\r\n\t\t\tunder = arguments[i];\r\n\t\t\t\r\n\t\t\tfor (prop in under)\r\n\t\t\t{\r\n\t\t\t\tif (under.hasOwnProperty(prop))\r\n\t\t\t\t{\r\n\t\t\t\t\ttype = typeof(under[prop]);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// We add base to that prop, since it's missing\r\n\t\t\t\t\tif(typeof(data[prop]) === 'undefined')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif(type === 'object')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tfn.rebase(data[prop] = (fn.isArray(under[prop])?[]:{}),under[prop]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tdata[prop] = under[prop];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// We only extend it further when dealing with objects / Arrays\r\n\t\t\t\t\t\tif(type === 'object' && !(typeof(data[prop]) === 'function'))\r\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tfn.rebase(data[prop],under[prop])\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn data;\r\n\t};\r\n\r\n\t/**\r\n\t * @method\r\n\t * This takes a base object and crawls up its heirarchy using path. Path is period delimited as\r\n\t * a normal object path.\r\n\t * \tvar myObj = {\r\n\t * \t\tstuff: {\r\n\t * \t\t\tbox: {\r\n\t * \t\t\t\tcolor: 'red'\r\n\t * \t\t\t},\r\n\t * \t\t\tsocks: true\r\n\t * \t\t},\r\n\t * \t\tmoves: false\r\n\t * \t};\r\n\t * \t\r\n\t * \trg.dd.fn.objectDig(myObj, 'stuff.box.color'); //returns 'red'\r\n\t * \trg.dd.fn.objectDig(myObj, 'stuff.box.contents'); //returns false\r\n\t * @param {Object} obj The object to traverse.\r\n\t * @param {String} path The path to the desired value.\r\n\t * @return {Object}\r\n\t * The value of the item the path points to. Returns null if the path cannot be followed.\r\n\t */\r\n\tfn.objectDig = function(obj,path)\r\n\t{\r\n\t\tvar i, j;\r\n\t\t\r\n\t\tif (typeof(obj) === 'undefined')\r\n\t\t{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\r\n\t\tif (typeof(path) === 'undefined')\r\n\t\t{\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\r\n\t\tif (path.indexOf('.') !== -1) {\r\n\t\t\tpath = path.split('.');\r\n\t\t\t\r\n\t\t\tfor(i = 0, j = path.length; i < j; i++)\r\n\t\t\t{\r\n\t\t\t\tif(typeof(obj[path[i]]) === 'undefined')\r\n\t\t\t\t{\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tobj = obj[path[i]];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn obj;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn obj[path];\r\n\t\t}\r\n\t};\r\n\t\r\n\t/** \r\n\t * @method\r\n\t * Executes the specified opperation on a and b and returns the result.\r\n\t * \trg.dd.fn.sMath(1, '+', 2); //returns 3\r\n\t * \trg.dd.fn.sMath(2, '/', 2); //returns 1\r\n\t * \trg.dd.fn.sMath('hello world!', '->', 'world'); //returns true\r\n\t * @param {Number/String} a The first parameter.\r\n\t * @param {String} op The operation to perform. The available operations are:\r\n\t * =. ==, ===, !=, !==, >, >=, <, <=, +, -, /, *, %, and ->. Most of these are self\r\n\t * explanatory, however the \"->\" operation checks to see if the first parameter contains the second parameter.\r\n\t * @param {Number/String} b The second parameter.\r\n\t */\r\n\t// This is significantly faster than causing the javascript interpreter to do the work\r\n\tfn.sMath = function (a, op, b)\r\n\t{\r\n\t\tswitch(op)\r\n\t\t{\r\n\t\t\tcase '=':\r\n\t\t\tcase '==':\r\n\t\t\tcase '===':\r\n\t\t\t\treturn (a == b);\r\n\t\t\tcase '!=':\r\n\t\t\tcase '!==':\r\n\t\t\t\treturn (a != b);\r\n\t\t\tcase '>':\r\n\t\t\t\treturn (a > b);\r\n\t\t\tcase '<':\r\n\t\t\t\treturn (a < b);\r\n\t\t\tcase '>=':\r\n\t\t\t\treturn (a >= b);\r\n\t\t\tcase '<=':\r\n\t\t\t\treturn (a <= b);\r\n\t\t\tcase '+':\r\n\t\t\t\treturn (a + b);\r\n\t\t\tcase '-':\r\n\t\t\t\treturn (a - b);\r\n\t\t\tcase '/':\r\n\t\t\t\treturn (a / b);\r\n\t\t\tcase '*':\r\n\t\t\t\treturn (a * b);\r\n\t\t\tcase '%':\r\n\t\t\t\treturn (a % b);\r\n\t\t\tcase '->':\r\n\t\t\t\treturn (a.indexOf(b) !== -1);\r\n\t\t\tdefault:\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Creates a div element.\r\n\t * @param {Object} [options] The options object.\r\n\t * @param {String} [options.classes] The classes to apply to the div.\r\n\t * @param {String} [options.style] The styles to apply to the div.\r\n\t * @param {HTMLElement} [options.append] The parent element the div should be appended to.\r\n\t * @param {Object} [options.data] A set of key value pairs used to define data attributes.\r\n\t * @return {HTMLElement} The created div.\r\n\t */\r\n\tfn.mkDiv = function (options)\r\n\t{\r\n\t\tvar r = document.createElement('div'),\r\n\t\t\ti,j;\r\n\t\t\r\n\t\tif (typeof(options) === 'object')\r\n\t\t{\r\n\t\t\tif (typeof(options.classes) === 'string')\r\n\t\t\t{\r\n\t\t\t\tr.className = options.classes;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (typeof(options.style) === 'string')\r\n\t\t\t{\r\n\t\t\t\tr.style.cssText = options.style;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (typeof(options.append) !== 'undefined')\r\n\t\t\t{\r\n\t\t\t\toptions.append.appendChild(r);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (typeof(options.data) === 'object')\r\n\t\t\t{\r\n\t\t\t\tfor (i = 0, j = options.data.length; i < j; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tr.setAttribute('data-'+options.data[i].k,options.data[i].v);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn r;\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Removes the specified element. Internally this is only used on created divs.\r\n\t * @param {HTMLElement} div The element to remove.\r\n\t */\r\n\tfn.rmDiv = function (div)\r\n\t{\r\n\t\tdiv.parentNode.removeChild(div);\r\n\t};\r\n\t\r\n\t/** \r\n\t * @method\r\n\t * Checks to see if the specified text contains the given word.\r\n\t * @param {String} text The text to search.\r\n\t * @param {String} word The word to search for.\r\n\t * @return {Boolean} Whether the word was found or not.\r\n\t */\r\n\tfn.hasWord = function (text, word)\r\n\t{\r\n\t\treturn (new RegExp(\"(?:^|\\\\s)\"+word+\"(?!\\\\S)\",'g')).test(text);\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Removes the given word from the specified text.\r\n\t * @param {String} text The text to search.\r\n\t * @param {String} word The word to remove.\r\n\t * @return {String} The resulting text.\r\n\t */\r\n\tfn.removeWord = function(text,word)\r\n\t{\r\n\t\treturn text.replace(new RegExp(\"(?:^|\\\\s)\"+word+\"(?!\\\\S)\",'g'),'');\r\n\t};\r\n\t\r\n\t/** \r\n\t * @method\r\n\t * Checks to see if the specified text contains the given word preceding an equals and a value.\r\n\t * @param {String} text The text to search.\r\n\t * @param {String} word The word to search for.\r\n\t * @return {Object/Boolean} Returns either false or the resulting value\r\n\t */\r\n\tfn.hasValue = function (text, word)\r\n\t{\r\n\t\tvar reg = new RegExp(\"(?:^|\\\\s)\"+word+\"=([^\\\\s\\\\t\\\\n]*)(?!\\\\S)\"), m;\r\n\t\tif(m = reg.exec(text))\r\n\t\t{\r\n\t\t\treturn m[1];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Removes the given word=value from the specified text.\r\n\t * @param {String} text The text to search.\r\n\t * @param {String} word The word to remove.\r\n\t * @return {String} The resulting text.\r\n\t */\r\n\tfn.removeValue = function(text,word)\r\n\t{\r\n\t\treturn text.replace(new RegExp(\"(?:^|\\\\s)\"+word+\"=([^\\\\s\\\\t\\\\n]*)(?!\\\\S)\",'g'),'');\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Detects if the specified element has the given class.\r\n\t * @param {HTMLElement} elem The element to check.\r\n\t * @param {String} className The class to search for.\r\n\t * @return {Boolean} Whether the class was found or not.\r\n\t */\r\n\tfn.hasClass = function(elem,class_)\r\n\t{\r\n\t\treturn fn.hasWord(elem.className,class_);\r\n\t};\r\n\t\r\n\t/** \r\n\t * @method\r\n\t * Adds the given class to the specified element.\r\n\t * @param {HTMLElement} elem The element to add to.\r\n\t * @param {String} className The class to add.\r\n\t */\r\n\tfn.addClass = function(elem,class_)\r\n\t{\r\n\t\telem.className += ' '+class_;\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Removes the specified class from the element.\r\n\t * @param {HTMLElement} elem The element to remove the class from.\r\n\t * @param {String} className The class to remove.\r\n\t */\r\n\tfn.removeClass = function(elem, className)\r\n\t{\r\n\t\telem.className = fn.removeWord(elem.className,className);\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Removes a class from all siblings and adds it to the element\r\n\t * @param {HTMLElement} elem The element to add the class to.\r\n\t * @param {String} className The class to add to the element.\r\n\t */\r\n\tfn.radioClass = function(elem, className)\r\n\t{\r\n\t\tvar children = elem.parentNode.childNodes,\r\n\t\t\ti = children.length;\r\n\t\t\r\n\t\twhile(i--)\r\n\t\t{\r\n\t\t\tif(children[i].className)\r\n\t\t\t{\r\n\t\t\t\tfn.removeClass(children[i], className);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfn.addClass(elem, className);\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Retrieves a duplicate of the given element's childNodes. This verson will not auto update\r\n\t * when the element's childNodes change.\r\n\t * @param {HTMLElement} elem The element to pull childNodes from.\r\n\t * @return {HTMLElement[]} A non living duplicate of the element's childNodes.\r\n\t */\r\n\tfn.deadChildren = function (elem)\r\n\t{\r\n\t\tif (elem.hasChildNodes())\r\n\t\t{\r\n\t\t\tvar children = elem.childNodes,\r\n\t\t\t\tdead = [],\r\n\t\t\t\ti, length;\r\n\t\t\t\r\n\t\t\tfor (i = 0, length = children.length; i < length; i = i + 1)\r\n\t\t\t{\r\n\t\t\t\tdead.push(children[i]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn dead;\r\n\t\t}\r\n\t\t\r\n\t\treturn [];\r\n\t};\r\n\t\r\n\t// Internals used for templating\r\n\tvar twigVarReg = /{{ (.+?) }}/;\r\n\t\r\n\t/** \r\n\t * @method\r\n\t * Does a simple token replacement on the given template.\r\n\t * @param {String/String[]} template The template that will be the subject of the replacement.\r\n\t * @param {Object} data The key / value pairs to be substituded.\r\n\t * @return {String} The resulting string.\r\n\t */\r\n\tfn.format = function (template, data)\r\n\t{\r\n\t\tif (fn.isArray(template))\r\n\t\t{\r\n\t\t\ttemplate = template.join('');\r\n\t\t}\r\n\t\t\r\n\t\tvar twigMatch;\r\n\t\t\r\n\t\twhile(twigMatch = twigVarReg.exec(template))\r\n\t\t{\r\n\t\t\ttemplate = template.replace(twigVarReg, fn.objectDig(data, twigMatch[1]));\r\n\t\t}\r\n\t\t\r\n\t\treturn template;\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Itterates over the given array, executing the supplied function on each. If the function\r\n\t * ever returns false, the itteration will stop.\r\n\t * @param {Array} arr The array to be itterated over.\r\n\t * @param {Function} func The function to be executed.\r\n\t */\r\n\tfn.each = function (arr, func)\r\n\t{\r\n\t\tif (!fn.isArray(arr))\r\n\t\t{\r\n\t\t\tfunc(arr, 0);\r\n\t\t\t\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tfor (var i = 0, length = arr.length; i < length; i = i + 1)\r\n\t\t{\r\n\t\t\tif (func(arr[i], i) === false)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Retrieves data from an element. This doesn't have the permission controls that\r\n\t * {@link #rgInfo} has so be careful when using it.\r\n\t * @param {HTMLElement} elem The element to pull data off of.\r\n\t * @param {String} attr The name of the attribute to pull data from.\r\n\t * @return {String} The data pulled. If the data is not found, false will be returned.\r\n\t */\r\n\tfn.rgData = function (elem, attr)\r\n\t{\r\n\t\tvar r = elem.getAttribute('data-rg-'+attr);\r\n\t\t\r\n\t\treturn (r === null || r === ''? false : r);\r\n\t};\r\n\t\r\n\t// Retrieves a data object, representing the most common rg data types\r\n\t/**\r\n\t * @method\r\n\t * Retrieves the data attribute from an element tree. This will bubble up the DOM until either the depth is\r\n\t * reached, or the data is found.\r\n\t * @param {HTMLElement} elem The element to pull data off of.\r\n\t * @param {Number} depth The maxiumum bubble depth.\r\n\t * @return {Object} data The data pulled. If the data is not found, false will be returned.\r\n\t * @return {String} data.name The rgData for name.\r\n\t * @return {String} data.id The rgData for id.\r\n\t * @return {String} data.aux The rgData for aux.\r\n\t */\r\n\tfn.rgInfo = function (elem, depth)\r\n\t{\r\n\t\tvar r;\r\n\t\t\r\n\t\twhile (depth)\r\n\t\t{\r\n\t\t\t// This catches element permission problems\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\tr = elem.getAttribute('data');\r\n\t\t\t}\r\n\t\t\tcatch (e)\r\n\t\t\t{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tr = {\r\n\t\t\t\tname: fn.rgData(elem,'name'),\r\n\t\t\t\tid: fn.rgData(elem,'id'),\r\n\t\t\t\taux: fn.rgData(elem,'aux')\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tr = (r.name === false && r.id === false && r.aux === false? false : r);\r\n\t\t\t\r\n\t\t\tif (r !== false)\r\n\t\t\t{\r\n\t\t\t\treturn r;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (--depth)\r\n\t\t\t{\r\n\t\t\t\telem = elem.parentNode;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn r;\r\n\t};\r\n\t\r\n\t/** \r\n\t * @method\r\n\t * Creates a test object to be used with {@link #runTest}. This will convert comparison strings\r\n\t * into something that runTest can rapidly check.\r\n\t * @param {String} testString The string that needs to be converted into a test.\r\n\t * testString is normally structured as \"(type)(path)(operator)(compareValue)(|...)\"\r\n\t * (type) is either \"!\" or empty. If it's \"!\", then the return is inversed.\r\n\t * (path) is an objectDig path. {@link #objectDig}\r\n\t * (operator) is either a regex operator (*=, ^=, or $=) or a sMath operator {@link #sMath}\r\n\t * (compareValue) is the value to compare or use for the operation\r\n\t * (|...) multiple tests can be \"or\"ed over a single bar. Each additional test uses the same\r\n\t * format as before. runTest will run them all and return true if any return true.\r\n\t * @return {Object} The resulting test object, or false if the object could not be created.\r\n\t */\r\n\tfn.makeTest = function(testString)\r\n\t{\r\n\t\tvar testMatch, testObject;\r\n\t\t// Blank strings autosucceed\r\n\t\tif(testString == '')\r\n\t\t{\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tif(testMatch = /^(\\!?)([a-zA-Z][a-zA-Z0-9\\.]*)(\\->|\\*=|\\^=|\\$=|===|==|=|<=|<|>=|>|\\+|\\-|\\*|\\/|%)?([^\\|]*)?(\\|.+)?$/.exec(testString))\r\n\t\t{\r\n\t\t\t// Create the basic test object and determine if there's an inversion on it\r\n\t\t\ttestObject = {'key':testMatch[2],'inv':(testMatch[1]==='!')};\r\n\t\t\t\r\n\t\t\t// If there's no op to compare with, we only check for the existence of the given key\r\n\t\t\tif(typeof(testMatch[3]) === 'undefined')\r\n\t\t\t{\r\n\t\t\t\ttestObject.det = 1;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n                if(typeof(testMatch[4]) === 'undefined')\r\n                {\r\n                    testMatch[4] = '';\r\n                }\r\n\t\t\t\t// The regexs can fail at creation. We need to catch this and fail gracefully\r\n\t\t\t\ttry\r\n\t\t\t\t{\r\n\t\t\t\t\t// Switch among the various possibilities for the operator\r\n\t\t\t\t\tswitch(testMatch[3])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// Regular Expression Digs\r\n\t\t\t\t\t\tcase '*=':\r\n\t\t\t\t\t\t\ttestObject.det = 2;\r\n\t\t\t\t\t\t\ttestObject.reg = new RegExp(testMatch[4],'i');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase '^=':\r\n\t\t\t\t\t\t\ttestObject.det = 2;\r\n\t\t\t\t\t\t\ttestObject.reg = new RegExp('^'+testMatch[4],'i');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase '$=':\r\n\t\t\t\t\t\t\ttestObject.det = 2;\r\n\t\t\t\t\t\t\ttestObject.reg = new RegExp(testMatch[4]+'$','i');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t// We don't let this fall to default in order to avoid .test errors against arrays\r\n\t\t\t\t\t\tcase '->':\r\n\t\t\t\t\t\t\ttestObject.det = 3;\r\n\t\t\t\t\t\t\ttestObject.evOp = '->';\r\n\t\t\t\t\t\t\ttestObject.evVs = testMatch[4];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t// Basic math digs\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\ttestObject.det = 3;\r\n\t\t\t\t\t\t\ttestObject.evOp = testMatch[3];\r\n\t\t\t\t\t\t\t// If there is something other than basic numbers, we don't parse it in to a number\r\n\t\t\t\t\t\t\t// This is just in case there might be a case of \"string=string\"\r\n\t\t\t\t\t\t\tif (/[^0-9\\.]/.test(testMatch[4]) || testMatch[4] === '')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttestObject.evVs = testMatch[4];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttestObject.evVs = parseFloat(testMatch[4]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcatch(e)\r\n\t\t\t\t{\r\n\t\t\t\t\ttestObject = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Or Series\r\n\t\t\tif(testMatch[5])\r\n\t\t\t{\r\n\t\t\t\ttestObject.or = fn.makeTest(testMatch[5].substring(1));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Return\r\n\t\t\treturn testObject;\r\n\t\t}\r\n\t\t\r\n\t\t// Long lists of test strings also always succeed.\r\n\t\t// In expected cases, this shouldn't happen often (which is why it rests after the major brunt of the test making)\r\n\t\tif (/^\\s+$/.test(testString))\r\n\t\t{\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\treturn false;\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Executes a test provided by {@link Riot.DDragon.fn#makeTest} on the given data.\r\n\t * @param {Object} data The data to be tested.\r\n\t * @param {Object} test The test object to be executed.\r\n\t * @return {Boolean} Whether the test was successful or not.\r\n\t */\r\n\tfn.runTest = function (data,test)\r\n\t{\r\n\t\tfunction testReturn(result)\r\n\t\t{\r\n\t\t\tif (test.inv)\r\n\t\t\t{\r\n\t\t\t\tresult = !result;\r\n\t\t\t}\r\n\r\n\t\t\t// Test if there's an or. If there is, and the result is still false, we keep going til we get a true\r\n\t\t\tif(test.or && result === false)\r\n\t\t\t{\r\n\t\t\t\treturn result || fn.runTest(data, test.or);\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\r\n\t\t// Sometimes tests can just be definitively true or false\r\n\t\tif(typeof(test) === 'boolean')\r\n\t\t{\r\n\t\t\treturn test;\r\n\t\t}\r\n\t\t\r\n\t\tvar dataPiece = fn.objectDig(data,test.key);\r\n\t\t\r\n\t\t// If there was bad data digging, we end here\r\n\t\tif(dataPiece === null) return testReturn(false);\r\n\t\t\r\n\t\t// There are 3 different types of tests\r\n\t\t// 2 and 3 are subject to user input error, so we need to fail gracefully in those cases\r\n\t\ttry\r\n\t\t{\r\n\t\t\tswitch(test.det)\r\n\t\t\t{\r\n\t\t\t\t// This detects if the key value simply exists\r\n\t\t\t\t// Since that test is actually required before this point, we need to do nothing.\r\n\t\t\t\tcase 1: return testReturn(true);\r\n\t\t\t\t\r\n\t\t\t\t// This tests a regular expression\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\treturn testReturn(test.reg.test(dataPiece));\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t\t// This math tests the code\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\treturn testReturn(fn.sMath(dataPiece,test.evOp,test.evVs));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(e)\r\n\t\t{\r\n\t\t\treturn testReturn(false);\r\n\t\t}\r\n\t\t\r\n\t\t// If it somehow gets here, something really bad happend. Test failed\r\n\t\treturn testReturn(false);\r\n\t};\r\n\t\r\n\t// Minor worker function for getImg and sizing\r\n\tfunction getImgSize(val, size)\r\n\t{\r\n\t\tswitch(size)\r\n\t\t{\r\n\t\t\tdefault:\r\n\t\t\tcase 'normal': return val;\r\n\t\t\tcase 'small': return parseInt(val * 0.75);\r\n\t\t\tcase 'tiny': return parseInt(val * 0.5);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Builds an image from the passed object. The object requires a dragontail formatted image\r\n\t * property.\r\n\t * @param {Object} obj The data object to build the image off of.\r\n\t * @param {Object} options The configuration object for the image.\r\n\t * @param {String} [options.src='sprite']\r\n\t * The source of the image desired. Can be sprite, full, loading, or splash.\r\n\t * @param {String} [options.version=''] The version of the data to pull the image from.\r\n\t * @param {String} [options.group=''] The group to pull the image from.\r\n\t * @param {String} [options.cap=''] The image file name.\r\n\t * @param {Number} [options.wrap=2]\r\n\t * The wrap level for the image. 2 places a ful html wrapper around it (<div> or <img). 1 is for\r\n\t * sprites only and just places the rest of the sprite styling with it.\r\n\t * @param {String} [options.classes=''] Any additional classes to add to the wrapper.\r\n\t * @param {String} [options.attrs=''] Any additional attributes to add to the wrapper.\r\n\t * @param {Number} [options.skin=0] Default skin number to use for loading and splash images (limited use).\r\n\t * @param {Boolean} [options.gray=false] Whether or not to use a grayscale version of the image (limited use).\r\n\t * @param {String} [options.size=normal] Which sprite size we should use. Options are normal, small (36x36) and tiny (24x24)\r\n\t * @return {String} The generated image html.\r\n\t */\r\n\tfn.getImg = function(obj,options)\r\n\t{\r\n\t\tif(!obj.image)\r\n\t\t{\r\n\t\t\treturn '<span data-rg-error=\"getImg('+obj.id+')\"></span>';\r\n\t\t}\r\n\t\tvar img = obj.image,\r\n\t\t// Defaults\r\n\t\t\tbasic = {\r\n\t\t\t\tsrc: 'sprite',\r\n\t\t\t\tpath: '',\r\n\t\t\t\tversion: '',\r\n\t\t\t\tgroup: '',\r\n\t\t\t\tcap: '',\r\n\t\t\t\t// Wrap is a \"level\" of ways to wrap the result\r\n\t\t\t\t// 2 places a full html wrapper around it (<div> or <img>)\r\n\t\t\t\t// 1 is for sprites only and just places the rest of the sprite styling with it.\r\n\t\t\t\twrap: 2,\r\n\t\t\t\t\r\n\t\t\t\t// Classes to add to the wrap\r\n\t\t\t\tclasses: '',\r\n\t\t\t\t\r\n\t\t\t\t// Attributes to add to the wrap\r\n\t\t\t\tattrs: '',\r\n\t\t\t\t\r\n\t\t\t\t// Skin number (for loading and splash)\r\n\t\t\t\tskin: 0,\r\n\t\t\t\t\r\n\t\t\t\t// Can opt to use grayscale versions\r\n\t\t\t\tgray: false,\r\n\t\t\t\t\r\n\t\t\t\t// Sprite sizes\r\n\t\t\t\tsize: 'normal'\r\n\t\t\t},\r\n\t\t\t// Pre and Post are used to construct wrappers\r\n\t\t\tpre = '',post = '';\r\n\t\t\r\n\t\tif(typeof(options) !== 'object')\r\n\t\t{\r\n\t\t\tvar options = basic;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\toptions = fn.rebase(options,basic);\r\n\t\t}\r\n\t\t// Individual objects may have their own versioning\r\n\t\tif(typeof(obj.version) === 'string')\r\n\t\t{\r\n\t\t\toptions.version = obj.version+'/';\r\n\t\t}\r\n\t\telse if(options.version !== '')\r\n\t\t{\r\n\t\t\toptions.version += '/';\r\n\t\t}\r\n\t\t\r\n\t\t// The different pathing constructs based on src\r\n\t\tswitch(options.src)\r\n\t\t{\r\n\t\t\tcase 'sprite':\r\n\t\t\t\toptions.group = 'sprite';\r\n\t\t\t\toptions.cap = img.sprite;\r\n\t\t\t\tif(options.wrap > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tpre = 'height:'+getImgSize(img.h, options.size)+'px; width:'+getImgSize(img.w, options.size)+'px; background: url(\\'';\r\n\t\t\t\t\tpost = '\\') -'+getImgSize(img.x, options.size)+'px -'+getImgSize(img.y, options.size)+'px no-repeat;';\r\n\t\t\t\t\tif(options.wrap > 1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tpre = '<div class=\"img '+options.classes+'\" style=\"'+pre;\r\n\t\t\t\t\t\tpost = post+'\" '+options.attrs+'></div>';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'full':\r\n\t\t\t\toptions.group = img.group;\r\n\t\t\t\toptions.cap = img.full;\r\n\t\t\t\tif(options.wrap > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tpre = '<img class=\"'+options.classes+'\" src=\"';\r\n\t\t\t\t\tpost = '\" '+options.attrs+' />';\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'loading':\r\n\t\t\t\toptions.group = img.group + '/loading';\r\n\t\t\tcase 'splash':\r\n\t\t\t\tif(options.group === '')\r\n\t\t\t\t{\r\n\t\t\t\t\toptions.group = img.group + '/splash';\r\n\t\t\t\t}\r\n\t\t\t\toptions.version = '';\r\n\t\t\t\toptions.cap = obj.id + '_' + options.skin + '.jpg';\r\n\t\t\t\t\r\n\t\t\t\tif(options.wrap > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tpre = '<img class=\"'+options.classes+'\" src=\"';\r\n\t\t\t\t\tpost = '\" '+options.attrs+' />';\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif(options.gray)\r\n\t\t{\r\n\t\t\toptions.cap = 'gray_' + options.cap;\r\n\t\t}\r\n\t\tif(options.size !== 'normal')\r\n\t\t{\r\n\t\t\toptions.cap = options.size + '_' + options.cap;\r\n\t\t}\r\n\t\t// The full construct:\r\n\t\t// cdn version / img / (path?) group / cap\r\n\t\t\r\n\t\treturn pre+dd.m.cdn+options.version+'img/'+options.path+options.group+'/'+options.cap+post;\r\n\t};\r\n\t\r\n\t/**\r\n\t * Selects elements based on a class name, starting from an optional point in the DOM\r\n\t * @param {String} class The class name to hunt for\r\n\t * @param {HTMLElement} context The optional element to search from\r\n\t * @return {HTMLElement[]} The selected elements.\r\n\t */\r\n\tfn.getElementsByClassName = (function()\r\n\t{\r\n\t\tvar body = document.getElementsByTagName('body')[0];\r\n\t\tif(document.getElementsByClassName)\r\n\t\t{\r\n\t\t\treturn function(className, context)\r\n\t\t\t{\r\n\t\t\t\tcontext = context || body;\r\n\t\t\t\treturn context.getElementsByClassName(className);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn function(className, context)\r\n\t\t\t{\r\n\t\t\t\tcontext = context || body;\r\n\t\t\t\t\r\n\t\t\t\tvar elems = context.getElementsByTagName('*'),\r\n\t\t\t\t\ti, j, el, r = [];\r\n\t\t\t\t\r\n\t\t\t\tfor(i=0, j = elems.length; i<j; ++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tel = elems[i];\r\n\t\t\t\t\tif(fn.hasClass(el, className))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tr.push(el);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn r;\r\n\t\t\t};\r\n\t\t}\r\n\t})();\r\n\t\r\n\t\r\n\t// This is the caching area for fn.$\r\n\tdd.fn$data = {};\r\n\t\r\n\t/**\r\n\t * A mappable selector function. The default is a very very simple selector service.\r\n\t * @param {String} selector The selector string.\r\n\t * @param {HTMLElement} context The root element to start the selection from.\r\n\t * @return {HTMLElement[]} The selected elements.\r\n\t */\r\n\tdd.fn$serve = function(selector,context)\r\n\t{\r\n\t\tvar context = context || document,h;\r\n\t\tswitch(selector.charAt(0))\r\n\t\t{\r\n\t\t\tcase '#':\r\n\t\t\t\th = context.getElementById(selector.substring(1));\r\n\t\t\t\tif(h === null) return [];\r\n\t\t\t\treturn [h];\r\n\t\t\tcase '.':\r\n\t\t\t\treturn fn.getElementsByClassName(selector.substring(1), context);\r\n\t\t\tdefault:\r\n\t\t\t\treturn context.getElementsByTagName(selector);\r\n\t\t}\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Executes the given selector returning the result. Also gives the option of caching the\r\n\t * result.\r\n\t * @param {String} selector The selector string.\r\n\t * @param {boolean} preselect Whether or not to cache the results.\r\n\t * @return {HTMLElement[]} The selected elements.\r\n\t */\r\n\tfn.$ = function(selector, preselect)\r\n\t{\r\n\t\tvar target;\r\n\t\tif(preselect)\r\n\t\t{\r\n\t\t\ttarget = dd.fn$data[selector];\r\n\t\t}\r\n\t\tif(typeof(target) === 'undefined')\r\n\t\t{\r\n\t\t\ttarget = dd.fn$serve(selector);\r\n\t\t\tif(preselect)\r\n\t\t\t{\r\n\t\t\t\tdd.fn$data[selector] = target;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn target;\r\n\t};\r\n\t\r\n\t// Error facing\r\n\tfn.er = function(error,loc,message)\r\n\t{\r\n\t\tvar e = 'ERROR: '+message+' at [ddragon.'+loc+']';\r\n\t\tif(typeof(console) !== 'undefined' && typeof(console.log) !== 'undefined')\r\n\t\t{\r\n\t\t\tconsole.log(e);\r\n\t\t}\r\n        setTimeout((function()\r\n        {\r\n            throw error;\r\n        }), 1);\r\n\t\treturn '<p><b>'+e+'</b></p>';\r\n\t};\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * This is based on Dean Edward's event bind system but has been mutilated heavily. The actual\r\n\t * event passed around by it is a partially normalized wrapper.\r\n\t * @param {HTMLElement} element The element to attach an event to.\r\n\t * @param {String} type The event type to listen for.\r\n\t * @param {Function} callback The function to call when the event fires.\r\n\t * @return {Function} The generated handler.\r\n\t */\r\n\tfn.addEvent = function(element, type, callback)\r\n\t{\r\n\t\tif(typeof(element) === 'string')\r\n\t\t{\r\n\t\t\telement = fn.$(element)[0];\r\n\t\t}\r\n\t\t// create a hash table of event types for the element, as well event type data\r\n\t\tif(!element.events) element.events = {};\r\n\t\t\r\n\t\t// The real handler\r\n\t\tfunction handler(event)\r\n\t\t{\r\n\t\t\tvar data = {\r\n\t\t\t\ttarget:(fixEvent.windowTarget?event.srcElement:event.target),\r\n\t\t\t\tevent:event,\r\n\t\t\t\ttype:type,\r\n\t\t\t\tbutton:false,\r\n\t\t\t\tbuttonRestrict:-1\r\n\t\t\t};\r\n\t\t\tif(type === 'mousedown' || type === 'mouseup')\r\n\t\t\t{\r\n\t\t\t\tdata.button = fixEvent.buttonData[event.button];\r\n\t\t\t}\r\n\t\t\tcallback.call(this ,data);\r\n\t\t};\r\n\t\t// create a hash table of event handlers for each element/event pair. This also gives us an array for easy obliteration\r\n\t\telement.events[type] = element.events[type] || {\r\n\t\t\thandles:[]\r\n\t\t};\r\n\t\t\r\n\t\t// Store the handler for easy obliteration\r\n\t\telement.events[type].handles.push(handler);\r\n\t\t\r\n\t\tif(element.addEventListener)\r\n\t\t{\r\n\t\t\telement.addEventListener(type, handler, false);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// assign each event handler a unique ID\r\n\t\t\tif(!handler.$$guid) handler.$$guid = fn.addEvent.guid++;\r\n\t\t\t// store the event handler in the hash table\r\n\t\t\telement.events[type][handler.$$guid] = handler;\r\n\t\t\t// assign a global event handler to do all the work\r\n\t\t\telement[\"on\" + type] = handleEvent;\r\n\t\t}\r\n\t\t\r\n\t\t// Return the handler so we can obliterate it later if we want\r\n\t\treturn handler;\r\n\t};\r\n\t// a counter used to create unique IDs\r\n\tfn.addEvent.guid = 1;\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Removes a listener from the specified element.\r\n\t * @param {HTMLElement} element The element to remove the listener from.\r\n\t * @param {String} type The event type the handler is listening for.\r\n\t * @param {Function} handler The handler created by {@link #addEvent}\r\n\t */\r\n\tfn.removeEvent = function(element, type, handler)\r\n\t{\r\n\t\t// Single removal\r\n\t\tif(handler)\r\n\t\t{\r\n\t\t\tif(element.removeEventListener)\r\n\t\t\t{\r\n\t\t\t\telement.removeEventListener(type, handler, false);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// delete the event handler from the hash table\r\n\t\t\t\tif(element.events && element.events[type])\r\n\t\t\t\t{\r\n\t\t\t\t\tdelete element.events[type][handler.$$guid];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Mass removal\r\n\t\telse if(element.events && element.events[type])\r\n\t\t{\r\n\t\t\tvar handler;\r\n\t\t\twhile(handler = element.events[type].handles.pop())\r\n\t\t\t{\r\n\t\t\t\tfn.removeEvent(element, type, handler);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n\tfunction handleEvent(event)\r\n\t{\r\n\t\tvar returnValue = true,\r\n\t\t\thandlers, i;\r\n\t\t// grab the event object (IE uses a global event object)\r\n\t\tevent = event || fixEvent(((this.ownerDocument || this.document || this).parentWindow || window).event);\r\n\t\t// get a reference to the hash table of event handlers\r\n\t\thandlers = this.events[event.type];\r\n\t\t// execute each event handler\r\n\t\tfor(i in handlers)\r\n\t\t{\r\n\t\t\tif(handlers.hasOwnProperty(i) && typeof handlers[i] === 'function')\r\n\t\t\t{\r\n\t\t\t\tthis.$$handleEvent = handlers[i];\r\n\t\t\t\tif (this.$$handleEvent(event) === false)\r\n\t\t\t\t{\r\n\t\t\t\t\treturnValue = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn returnValue;\r\n\t};\r\n\t\r\n\tfunction fixEvent(event)\r\n\t{\r\n\t\t// add W3C standard event methods\r\n\t\tevent.preventDefault = fixEvent.preventDefault;\r\n\t\tevent.stopPropagation = fixEvent.stopPropagation;\r\n\t\tfixEvent.windowTarget = true;\r\n\t\treturn event;\r\n\t};\r\n\t// window detection target type\r\n\tfixEvent.windowTarget = false;\r\n\t\r\n\tfixEvent.preventDefault = function()\r\n\t{\r\n\t\tthis.returnValue = false;\r\n\t};\r\n\t\r\n\tfixEvent.stopPropagation = function()\r\n\t{\r\n\t\tthis.cancelBubble = true;\r\n\t};\r\n\t\r\n\t// Figure out which button was pressed\r\n\t// Detect for a modern browser\r\n\tif(window.addEventListener)\r\n\t{\r\n\t\tfixEvent.buttonData = [0,0,2,0,1];\r\n\t}\r\n\telse\r\n\t{\r\n\t\tfixEvent.buttonData = [-1,0,1,2];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @method\r\n\t * Watch a digged property of target element while that element is focused. Fires a callback\r\n\t * on change.\r\n\t * @param {HTMLElement} elem The element to watch.\r\n\t * @param {String} dig The dig path for the property that needs to be watched. See: {@link #objectDig}.\r\n\t * @param {Function} callback The function to call when the element changes.\r\n\t */\r\n\tfn.watch = function(elem, dig, callback)\r\n\t{\r\n\t\tfn.addEvent(elem, 'focus', function(data)\r\n\t\t{\r\n\t\t\tfunction c()\r\n\t\t\t{\r\n\t\t\t\tvar v = fn.objectDig(c.target,c.dig);\r\n\t\t\t\tif(v !== c.store)\r\n\t\t\t\t{\r\n\t\t\t\t\tcallback(c.target,v,c.store);\r\n\t\t\t\t\tc.store = v;\r\n\t\t\t\t}\r\n\t\t\t\tc.timer = setTimeout(c,32);\r\n\t\t\t};\r\n\t\t\tfunction k()\r\n\t\t\t{\r\n\t\t\t\tclearTimeout(c.timer);\r\n\t\t\t\tfn.removeEvent(data.target, 'blur', k);\r\n\t\t\t};\r\n\t\t\tc.target = data.target;\r\n\t\t\tc.dig = dig;\r\n\t\t\tc.timer = setTimeout(c,32);\r\n\t\t\tc.store = false;\r\n\t\t\tfn.addEvent(data.target, 'blur', k);\r\n\t\t});\r\n\t};\r\n\t\r\n\t/**\r\n\t * @class Riot.DDragon.fn.fire\r\n\t * @singleton\r\n\t * Fire group event system. This system allows us to setup and merge two different coding\r\n\t * systems together, one system planning and another executing, without the issues.\r\n\t */\r\n\tfn.fire = {\r\n\t\tdata: {},\r\n\t\t/**\r\n\t\t * @method\r\n\t\t * Plans for an event execution.\r\n\t\t * @param {String} group The event group to expect.\r\n\t\t * @param {Object} planData A data objec that needs to be passed to the callback when the event fires.\r\n\t\t * @param {Function} callback The callback to execute when the event fires. Has parameters planData, execData, then fireId\r\n\t\t * @return {Number} A fireId that can be used to scrap the event\r\n\t\t */\r\n\t\tplan: function(group,planData,callback)\r\n\t\t{\r\n\t\t\tif(typeof(fn.fire.data[group]) !== 'object')\r\n\t\t\t{\r\n\t\t\t\tfn.fire.data[group] = [];\r\n\t\t\t}\r\n\t\t\treturn fn.fire.data[group].push({'planData': planData, 'callback': callback})-1;\r\n\t\t},\r\n\t\t/**\r\n\t\t * @method\r\n\t\t * Removes the specified plan.\r\n\t\t * @param {String} group The event group to remove from.\r\n\t\t * @param {Number} id The id of the plan to remove.\r\n\t\t */\r\n\t\tscrap: function(group,id)\r\n\t\t{\r\n\t\t\tif(typeof(fn.fire.data[group]) === 'object')\r\n\t\t\t{\r\n\t\t\t\tfn.fire.data[group].splice(id,1);\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * @method\r\n\t\t * Executes a set of plans.\r\n\t\t * @param {String} group The event group to execute.\r\n\t\t * @param {Object} execData The data that needs to be passed to each handler.\r\n\t\t */\r\n\t\texec: function(group,execData)\r\n\t\t{\r\n\t\t\tif(typeof(fn.fire.data[group]) === 'object')\r\n\t\t\t{\r\n\t\t\t\tvar i;\r\n\t\t\t\tfor(i=0;i<fn.fire.data[group].length;i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tfn.fire.data[group][i].callback(fn.fire.data[group][i].planData,execData,i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n})();\r\n\r\n\r\n// This executes only once loader is ready to execute it.\r\n// This is the start of the primary ddragon application.\r\nRiot.DDragon.fn.init = function(selectorEngine)\r\n{\r\n\tvar w = window, rg = Riot, dd = Riot.DDragon, fn = dd.fn;\r\n\t\r\n\t// Remap the selectorEngine if one was passed\r\n\tif(arguments.length > 0) dd.fn$serve = selectorEngine;\r\n/* END OF FILE - core.js */\r\n// The models object stores the individual models that are created\r\n// This allows all models to be accessed in a semi-global manner\r\n// The standard format is simply dd.models[data type], however a call to dd.remodel may change this\r\ndd.models = {};\r\n\r\n// Model parsers are run based on reported data type\r\n// Each model parser takes in the individual data object it's parsing\r\n// This object is a reference, and can be manipulated directly here\r\n// The overall context for the modelParser (this) refers to the whole model\r\ndd.modelParsers = {\r\n\t'champion': [function(obj)\r\n\t{\r\n\t\tif(typeof obj.loadedPartial === 'undefined')\r\n\t\t{\r\n\t\t\t// Base attack speed should be calculated on the fly\r\n\t\t\tobj.stats.attackspeed = fn.calcAspd(1, obj.stats.attackspeedoffset, obj.stats.attackspeedperlevel);\r\n\t\t\t\r\n\t\t\t// Level 1 evaluations for fast reference\r\n\t\t\tvar l1s = ['armor', 'attackdamage', 'hp', 'hpregen', 'mp', 'mpregen', 'spellblock'],\r\n\t\t\t\tl1, base, per;\r\n\t\t\t\r\n\t\t\twhile(l1 = l1s.pop())\r\n\t\t\t{\r\n\t\t\t\tbase = obj.stats[l1] * 1000;\r\n\t\t\t\tper = obj.stats[l1 + 'perlevel'] * 1000;\r\n\t\t\t\tobj.stats['l1' + l1] = (base + per) / 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tobj.loadedPartial = true;\r\n\t\t}\r\n\t\tif(obj.loadedFull)\r\n\t\t{\r\n\t\t\t\r\n\t\t\t// Spells should have versions on them\r\n\t\t\tvar count = obj.spells.length;\r\n\t\t\twhile(count--)\r\n\t\t\t{\r\n\t\t\t\tobj.spells[count].version = obj.version;\r\n\t\t\t}\r\n\t\t}\r\n\t}]\r\n};\r\n\r\n// General model parsers that affect an entire model\r\n// Currently only used for the weird profileicon behaviour in the platform\r\ndd.addModelParser('profileicon', function()\r\n{\r\n\tthis.remapFunc = function(id)\r\n\t{\r\n\t\tvar numID = parseInt(id, 10);\r\n\t\tif(numID > dd.m.profileiconmax && numID < 500)\r\n\t\t{\r\n\t\t\treturn '0';\r\n\t\t}\r\n\t\treturn id;\r\n\t};\r\n});\r\n\r\n/**\r\n * @class Riot.DDragon.model\r\n * A wrapper class used to encompass the retrieval and manipulation of a type of data.\r\n * @param {String} dataSource Describes the overall model name and stored source location When this\r\n * has no specified data, dataSource will also specify data type.\r\n * @param {String} [dataVersion] specifies a specific version type to use 'single' may be used here\r\n * to specify a simple / individual break.\r\n * @param {Object[]} [data] A full data block, allowing specific data to be injected in to the\r\n * model.\r\n */\r\ndd.model = function(dataSource,dataVersion,data)\r\n{\r\n\t// Remapper\r\n\tvar that = this;\r\n\t\r\n\t// If this model has finished initializing\r\n\tthis.init = false;\r\n\t\r\n\t// An object reference to make sure we don't repeat AJAX calls\r\n\t// This can either contain 'all' or each id, with a status of true or false\r\n\tthis.loading = {all:false};\r\n\t\r\n\t//java -jar compiler.jar --js $(FULL_CURRENT_PATH) --compilation_level ADVANCED_OPTIMIZATIONS --js_output_file $(CURRENT_DIRECTORY)\\$(NAME_PART)-compiled.js\r\n\t\r\n\t// If this model is a special override case\r\n\tthis.override = false;\r\n\t\r\n\t// This is a detector for if the keys are loaded (since they might be loaded in async)\r\n\tthis.keysLoaded = false;\r\n\t\r\n\t// A name for this model. Important for keeping model recall functioning.\r\n\tthis.name = dataSource;\r\n\t\r\n\t// We assume that we can't translate models by default (though usually language loading syncs up to where you always can)\r\n\t// Note: This is just auxilary translations, such as tags\r\n\tthis.translated = false;\r\n\t\r\n\t// The methodology to loading the data.\r\n\t// By default, we load it all.\r\n\tthis.format = 'all';\r\n    \r\n    // Pull out 'Full' types\r\n    if(dataSource.substr(-4,4) === 'Full')\r\n    {\r\n        this.type = dataSource.substr(0, dataSource.length-4);\r\n    }\r\n    else\r\n    {\r\n        // Initial Type Info\r\n        this.type = dataSource;\r\n    }\r\n\t\r\n\t// We can use either manifest controlled versions or we can use specified versions of data\r\n\tif(typeof(dataVersion) === 'string')\r\n\t{\r\n\t\tthis.version = dataVersion;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tthis.version = dd.m.n[this.type];\r\n\t}\r\n\t\r\n\t// Used to overwrite the remap functionality\r\n\tthis.remapFunc = function(id)\r\n\t{\r\n\t\treturn this.remapKeys[id];\r\n\t};\r\n\t\r\n\t// These two keys are used to help control localStorage\r\n\t// dl stores returned localstorage info, preparse\r\n\t// lsKey is the localStorage key to read and write from\r\n\t// lsKey also contains information about specific versions if this is a special version override call\r\n\t// This can be a different storage method as well. No data storage method is used for models by default as model data can get pretty big\r\n\tvar dl;\r\n\tthis.lsKey = 'rg_data_' + dd.m.l + '_' + dataSource + (this.override?'_'+this.version:'');\r\n\t\r\n\t\r\n\t// Data source location for faster ajax processing\r\n\tthis.source = dd.m.cdn+this.version+'/data/'+dd.m.l+dataSource;\r\n\t\r\n\t// If Data was specified, it will attempt to load that\r\n\t// loadAll will parseJSON\r\n\tif(typeof(data) === 'string')\r\n\t{\r\n\t\tthis.loadAll(data);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// This is where we would hook in storage methods\r\n\t\t// @TODO: Storage hook\r\n\t\t\r\n\t\t\r\n\t\t// If the data didn't initiate by this point, then we start loading from the CDN\r\n\t\tif(!this.init)\r\n\t\t{\r\n\t\t\t// Make sure we're not repeating ajax calls\r\n\t\t\tif(!this.loading.all)\r\n\t\t\t{\r\n\t\t\t\tthis.loading.all = true;\r\n\t\t\t\tfn.getJSON(this.source+'.json',function(d)\r\n\t\t\t\t{\r\n\t\t\t\t\tthat.loadAll(d);\r\n\t\t\t\t\tif(that.init)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthat.makeKeys(that.data);\r\n\t\t\t\t\t\tfn.fire.exec('model',{'name':that.name});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthat.loading.all = false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @method rename\r\n * Renames the model.\r\n * @param {String} name The new name of the model.\r\n * @return {Riot.DDragon.model} The renamed model.\r\n */\r\ndd.model.prototype.rename = function(name)\r\n{\r\n\tthis.name = name;\r\n\treturn this;\r\n};\r\n\r\n/**\r\n * @method makeKeys\r\n * Converts a data object into an array of data keys.\r\n * @param {Object} keySource The data source containing the desired keys.\r\n * @return {String[]} The resulting keys.\r\n */\r\ndd.model.prototype.makeKeys = function(keySource)\r\n{\r\n\tthis.keys = [];\r\n\tthis.remapKeys = {};\r\n\tfor(var key in keySource)\r\n\t{\r\n\t\tif(keySource.hasOwnProperty(key))\r\n\t\t{\r\n\t\t\tif(keySource[key].key)\r\n\t\t\t{\r\n\t\t\t\tthis.remapKeys[keySource[key].key] = key;\r\n\t\t\t}\r\n\t\t\tthis.keys.push(key);\r\n\t\t}\r\n\t}\r\n\tthis.keysLoaded = true;\r\n};\r\n\r\n/**\r\n * @method loadAll\r\n * Loads all data provided.\r\n * @param {String/Object} data Either a data object, or a parse-able JSON string.\r\n */\r\ndd.model.prototype.loadAll = function(data)\r\n{\r\n\tif(typeof(data) === 'string')\r\n\t{\r\n\t\tdata = JSON.parse(data);\r\n\t}\r\n\tif(data.version === this.version)\r\n\t{\r\n\t\tthis.data = data.data;\r\n\t\tthis.keys = data.keys;\r\n\t\tthis.init = true;\r\n\t\tif(typeof(data.basic) !== 'undefined')\r\n\t\t{\r\n\t\t\tthis.basic = data.basic;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.basic = false;\r\n\t\t}\r\n\t\tif(typeof(data.tree) !== 'undefined')\r\n\t\t{\r\n\t\t\tthis.tree = data.tree;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.tree = {};\r\n\t\t}\r\n\t\tif(typeof(data.format) !== 'undefined')\r\n\t\t{\r\n\t\t\tthis.format = data.format;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.format = 'all';\r\n\t\t}\r\n\t\tthis.runFullParsers();\r\n\t}\r\n};\r\n\r\n/**\r\n * @method runFullParsers\r\n * Runs all model parsers associated with this model.\r\n */\r\ndd.model.prototype.runFullParsers = function()\r\n{\r\n\tif(dd.mps[this.type])\r\n\t{\r\n\t\tvar that = this;\r\n\t\tfn.each(dd.mps[this.type],function(mp)\r\n\t\t{\r\n\t\t\tmp.call(that);\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * @method addModelParser\r\n * @member Riot.DDragon\r\n * Adds a model parser and runs it on the given model type.\r\n * @param {String} type The model type this parser is associated with.\r\n * @param {Function} mp The data parsing function.\r\n */\r\ndd.addModelParser = function(type, mp)\r\n{\r\n\tdd.amp(type,mp);\r\n\tfor(model in dd.models)\r\n\t{\r\n\t\tif(dd.models.hasOwnProperty(model))\r\n\t\t{\r\n\t\t\tif(model.type === type)\r\n\t\t\t{\r\n\t\t\t\tmp.call(model);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @method loadSingle\r\n * Loads a single piece of data into the model. This is normally called from {@link #getFull}.\r\n * @param {Object} data The data to load.\r\n */\r\ndd.model.prototype.loadSingle = function(data)\r\n{\r\n\tif(this.format === 'standAloneComplex')\r\n\t{\r\n\t\tif(typeof(data) === 'string')\r\n\t\t{\r\n\t\t\tdata = JSON.parse(data);\r\n\t\t}\r\n\t\tfn.rebase(this.data,data.data);\r\n\t}\r\n};\r\n\r\n/**\r\n * @method parseData\r\n * Adds post-processing variables to the given object. Data added includes basic data, searchHash,\r\n * searchString, and whatever the associated modelParsers add.\r\n * @param {String} id The id of the data that needs to be parsed.\r\n */\r\ndd.model.prototype.parseData = function(id)\r\n{\r\n\tvar obj = this.data[id];\r\n\tif(!obj.parsed || !this.translate)\r\n\t{\r\n\t\tif(!obj.parsed)\r\n\t\t{\r\n\t\t\t// Add the basics to this object\r\n\t\t\tif(typeof(this.basic) === 'object')\r\n\t\t\t{\r\n\t\t\t\tobj = fn.rebase(obj,this.basic);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Run all the modelparsers\r\n\t\t\tif(typeof(dd.modelParsers[this.type]) !== 'undefined')\r\n\t\t\t{\r\n\t\t\t\tvar i,j;\r\n\t\t\t\tfor(i=0,j=dd.modelParsers[this.type].length;i<j;++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tdd.modelParsers[this.type][i].call(this,obj);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// For standAloneComplex data, we don't set the parse unless the individual data is loaded\r\n\t\t\t// This is incase models parsers wish to use full data information\r\n\t\t\tif(this.format === 'standAloneComplex')\r\n\t\t\t{\r\n\t\t\t\tif(!obj.loadedFull)\r\n\t\t\t\t{\r\n\t\t\t\t\tobj.loadedFull = false;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tobj.parsed = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tobj.parsed = true;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Add id field\r\n\t\t\tobj.id = id;\r\n\t\t}\r\n\t\t\r\n\t\t// See if the language model is ready\r\n\t\tthis.translate = dd.useModel('language').init;\r\n\t\t\r\n\t\t// Building out a hash and string system to do simultaneous full text + fuzzy search\r\n\t\t// On the most common property groups (name and tags)\r\n\t\tif(typeof(obj.name) === 'string')\r\n\t\t{\r\n\t\t\tobj.searchName = fn.tFilter(obj.name);\r\n\t\t\tobj.searchHash = {};\r\n\t\t\tobj.searchRaw = '';\r\n\t\t\tobj.searchString = '';\r\n\t\t\tvar s,i,j;\r\n\t\t\t\r\n\t\t\t// Splitting the Object's name in to search areas\r\n\t\t\ts = obj.searchName.split(' ');\r\n\t\t\tfor(i=0,j=s.length;i<j;++i)\r\n\t\t\t{\r\n\t\t\t\tobj.searchHash[s[i]] = true;\r\n\t\t\t\tobj.searchRaw += ';'+s[i];\r\n\t\t\t\tobj.searchString += ';'+s[i];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Adding basic colloquialisms\r\n\t\t\tif(obj.colloq)\r\n\t\t\t{\r\n\t\t\t\tobj.searchString += obj.colloq;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Splitting the Object's tags in to search areas\r\n\t\t\tif(obj.tags)\r\n\t\t\t{\r\n\t\t\t\tfor(i=0,j=obj.tags.length;i<j;++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tobj.searchHash[obj.tags[i]] = true;\r\n\t\t\t\t\tobj.searchRaw += ';' + obj.tags[i];\r\n                    var colloqTag = 'colloq_' + obj.tags[i];\r\n                    var translatedColloqTag = fn.t(colloqTag);\r\n                    if(translatedColloqTag === colloqTag)\r\n                    {\r\n                        translatedColloqTag = '';\r\n                    }\r\n                    \r\n\t\t\t\t\tobj.searchString += ';' + fn.tFilter(fn.t(obj.tags[i])) + translatedColloqTag;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t}\r\n};\r\n\r\n/**\r\n * @method parseAllData\r\n * Attempts to parse all currently managed data in a single pass.\r\n */\r\ndd.model.prototype.parseAllData = function()\r\n{\r\n\tif(!this.parsed && this.init)\r\n\t{\r\n\t\tvar i,j;\r\n\t\tfor(i=0,j=this.keys.length;i<j;++i)\r\n\t\t{\r\n\t\t\tthis.get(this.keys[i]);\r\n\t\t}\r\n\t\tthis.parsed = true;\r\n\t}\r\n};\r\n\r\n/**\r\n * @method get\r\n * Retrieves a single peice of data from the model.\r\n * @param {String} id The id of the desired data.\r\n * @param {Boolean} [remap=false] If we should use the alternate ID system associated with this model\r\n * @param {Function} [callback=null] A function to call once the model has finished loading,\r\n * or immediately if it already has. The callback's \"this\" is the model and the first param is the\r\n * desired data from get\r\n * @return {Object} The desired data or a failure object the can be retried (see retryModel);\r\n */\r\ndd.model.prototype.get = function(id, remap, callback)\r\n{\r\n\tremap = remap || false;\r\n\tvar that = this;\r\n\tif(remap)\r\n\t{\r\n\t\tid = this.remapFunc.call(this, id);\r\n\t}\r\n\tif(this.init)\r\n\t{\r\n\t\tvar data = this.data[id];\r\n\t\tif(typeof(data) === 'object')\r\n\t\t{\r\n\t\t\tthis.parseData(id);\r\n\t\t\tif(typeof callback !== 'undefined')\r\n\t\t\t{\r\n\t\t\t\tcallback.call(this, data);\r\n\t\t\t}\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\telse if(typeof(data) === 'string')\r\n\t\t{\r\n\t\t\tif(typeof callback !== 'undefined')\r\n\t\t\t{\r\n\t\t\t\tcallback.call(this, data);\r\n\t\t\t}\r\n\t\t\treturn data;\r\n\t\t}\r\n\t}\r\n\telse if(typeof(callback) !== 'undefined')\r\n\t{\r\n\t\tfn.fire.plan('model', {name: type}, function(planData, execData, fireId) {\r\n\t\t\tif(execData.name === planData.name) {\r\n\t\t\t\tfn.fire.scrap('model', fireId);\r\n\t\t\t\tcallback.call(that, that.get(id, remap));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn {\r\n\t\t_action: 'get',\r\n\t\t_name: this.name,\r\n\t\tid: id\r\n\t};\r\n};\r\n\r\n/**\r\n * @method getFull\r\n * Initializes a single piece of data based on id. If the data is not already in the mode then it\r\n * will be requested from the server.\r\n * @param {String} id The id of the desired data.\r\n * @param {Boolean} [remap=false] If we should use the alternate ID system associated with this model\r\n * @param {Function} [callback=null] A function to call once the model has finished loading,\r\n * or immediately if it already has. The callback's \"this\" is the model and the first param is the\r\n * desired data from get\r\n * @return {Object} The desired data, or an ajax status object.\r\n */\r\ndd.model.prototype.getFull = function(id, remap, callback)\r\n{\r\n\tremap = remap || false;\r\n\tvar that = this;\r\n\tif(remap)\r\n\t{\r\n\t\tid = this.remapFunc.call(this, id);\r\n\t}\r\n\tif(this.init)\r\n\t{\r\n\t\tvar data = this.get(id);\r\n\t\t// If we're getting noncomplex data, or if the complex data is already loaded, we can safely return the full data object\r\n\t\tif(this.format !== 'standAloneComplex' || data.loadedFull)\r\n\t\t{\r\n\t\t\tif(typeof callback !== 'undefined')\r\n\t\t\t{\r\n\t\t\t\tcallback.call(this, data);\r\n\t\t\t}\r\n\t\t\treturn data;\r\n\t\t}\r\n\t\t\r\n\t\t// Don't reproduce ajax calls\r\n\t\tif(!this.loading[id])\r\n\t\t{\r\n\t\t\tthis.loading[id] = true;\r\n\t\t\tfn.getJSON(dd.m.cdn+data.version+'/data/'+dd.m.l+this.type+'/'+id+'.json',function(data)\r\n\t\t\t{\r\n\t\t\t\tthat.loadSingle(data);\r\n\t\t\t\tthat.get(id, remap).loadedFull = true;\r\n\t\t\t\tthat.loading[id] = false;\r\n\t\t\t\tfn.fire.exec('model',{'name':that.name,'sub':id});\r\n\t\t\t\tif(typeof(callback) !== 'undefined')\r\n\t\t\t\t{\r\n\t\t\t\t\tcallback.call(that, that.get(id, remap));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\telse if(typeof(callback) !== 'undefined')\r\n\t{\r\n\t\tfn.fire.plan('model', {name: type, sub: id}, function(planData, execData, fireId) {\r\n\t\t\tif(execData.name === planData.name && execData.id === planData.id) {\r\n\t\t\t\tfn.fire.scrap('model', fireId);\r\n\t\t\t\tcallback.call(that, that.get(id, remap));\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn {\r\n\t\t_action: 'getFull',\r\n\t\t_name: this.name,\r\n\t\tid: id\r\n\t};\r\n}\r\n\r\n/**\r\n * @method getImg\r\n * Returns an image path for a single data object.\r\n * @param {String} id The id of the desired data.\r\n * @param {Object} options The options object for creating the image. See {@link Riot.DDragon.fn#getImg}.\r\n *\r\n * In addition to the standard options available to getImg, this version fills in the version parameter\r\n * automatically and it allows the wrap parameter to go up to 3.\r\n *\r\n * In case of wrap: 3, this adds data-rg-name=\"\" and data-rg-id=\"\" attributes automatically.\r\n * This will cause the result to have the default tooltips and modals.\r\n * @param {Boolean} [remap] If we should use the alternate ID system associated with this model\r\n * for more details.\r\n */\r\ndd.model.prototype.getImg = function(id, options, remap)\r\n{\r\n\tremap = remap || false;\r\n\tif(remap)\r\n\t{\r\n\t\tid = this.remapFunc.call(this, id);\r\n\t}\r\n\tif(this.init)\r\n\t{\r\n\t\t// Options and default options\r\n\t\tvar basic = {\r\n\t\t\tversion: this.version\r\n\t\t};\r\n\t\tif(typeof(options) !== 'object')\r\n\t\t{\r\n\t\t\tvar options = basic;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// If wrap is 3 or greater, we assume the standard rg data attrs should be present\r\n\t\t\tif(options.wrap)\r\n\t\t\t{\r\n\t\t\t\tif(options.wrap > 2)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(typeof(options.attrs) === 'undefined')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\toptions.attrs = '';\r\n\t\t\t\t\t}\r\n\t\t\t\t\toptions.attrs += ' data-rg-name=\"'+this.name+'\" data-rg-id=\"'+id+'\"';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\toptions = fn.rebase(options,basic);\r\n\t\t}\r\n\t\t\r\n\t\treturn fn.getImg(this.get(id),options);\r\n\t}\r\n\treturn '';\r\n};\r\n\r\n/**\r\n * @method all\r\n * Retrieves an array of all item id's.\r\n * @return {String[]} The ids of all currently managed data.\r\n */\r\ndd.model.prototype.all = function()\r\n{\r\n\treturn this.keys.slice(0);\r\n};\r\n\r\n/**\r\n * @method collect\r\n * @member Riot.DDragon\r\n * Controls the collection system and shouldn't be used outside of it.\r\n */\r\ndd.collect = function(parent)\r\n{\r\n\tthis.parent = parent;\r\n\tthis.sData = {};\r\n\tthis.fData = [];\r\n\tif(parent.init)\r\n\t{\r\n\t\tthis.keys = parent.keys.slice(0);\r\n\t}\r\n};\r\n\r\n/**\r\n * @method filterInit\r\n * Initializes a filter.\r\n * @param {Object} filter The desired filter.\r\n */\r\ndd.collect.prototype.filterInit = function(filter)\r\n{\r\n\tthis.f = true;\r\n\tthis.fData = filter;\r\n\tthis.fKeys = {};\r\n\tthis.test = false;\r\n};\r\n\r\n/**\r\n * @method sortInit\r\n * Initializes the sort.\r\n * @param {Object} sort The sort data.\r\n */\r\ndd.collect.prototype.sortInit = function(sort)\r\n{\r\n\tthis.s = true;\r\n\tthis.sData = sort;\r\n};\r\n\r\n/**\r\n * @method filter\r\n * Checks to see if the item at the specified position needs to be removed. If the data at the\r\n * specified position has not been parsed, it will be parsed.\r\n * @param {Number} pos The position of the item being filtered.\r\n * @return {Boolean} Whether the item needs to be removed or not.\r\n */\r\ndd.collect.prototype.filter = function(pos)\r\n{\r\n\tif(!this.f) return false;\r\n\tif(typeof(this.fKeys[this.keys[pos]]) !== 'undefined') return false;\r\n\tthis.fKeys[this.keys[pos]] = 1;\r\n\t\r\n\t// Filter exec takes a bool value\r\n\t// On true, it filters out the current position (truthfully failing a filter)\r\n\t// On false, it says \"test is true\"\r\n\tfunction filterExec(stat)\r\n\t{\r\n\t\tif(stat) this.keys.splice(pos,1);\r\n\t\tthis.test = true;\r\n\t\treturn stat;\r\n\t};\r\n\t\r\n\tvar obj = this.parent.data[this.keys[pos]];\r\n\tvar fi, fi_, fj_, fm, ftemp, fholder, f, fr = false, typeOfFData;\r\n\tfor(fi=0;fi<this.fData.length;++fi)\r\n\t{\r\n\t\ttypeOfFData = typeof(this.fData[fi]);\r\n\t\t// We map it in to an object if it hasn't yet been done\r\n\t\tif(typeOfFData === 'boolean')\r\n\t\t{\r\n\t\t\t// Any true filters we just skip. They've succeeded. Yay.\r\n\t\t\tif(this.fData[fi] === true) continue;\r\n\t\t\t// Otherwise, we have a bad filter. We fail the filter.\r\n\t\t\treturn filterExec.call(this,true);\r\n\t\t\t\r\n\t\t}\r\n\t\t// We need to map strings in to test objects\r\n\t\t// Unlike core's test system, models get to deal with a special type of searching using \"searchKey:\"\r\n\t\t// This is a much more language aware and dynamic search than standard\r\n\t\telse if(typeOfFData === 'string')\r\n\t\t{\r\n\t\t\t// searchKey is special\r\n\t\t\tif(fm = /^searchKey:(.*)$/.exec(this.fData[fi]))\r\n\t\t\t{\r\n\t\t\t\t// This hunts out all possible word spacers for:\r\n\t\t\t\t// Indo-European languages, Korean, Chinese (all), Japanese, and Arabic\r\n\t\t\t\t// And replaces them with a single space (for us to later split)\r\n\t\t\t\t// Truncating end of line and beginning of line is important for sensible searches\r\n\t\t\t\tfm = fn.tFilter(fm[1]).split(' ');\r\n\t\t\t\tftemp = fm.length-1;\r\n\t\t\t\tfor(fi_=0,fj_=fm.length;fi_<fj_;++fi_)\r\n\t\t\t\t{\r\n\t\t\t\t\t// fi is the overall filter loop. We replace the current filter loop with one of the split searchKey filters.\r\n\t\t\t\t\t// Beyond that, we add them at the end of the filters\r\n\t\t\t\t\t// Also, all a searchkey is is a parsed and divided series of searchString includes\r\n\t\t\t\t\tthis.fData[(ftemp === fi_ ? fi : this.fData.length)] = fn.makeTest('searchString*='+fm[fi_]);\r\n\t\t\t\t}\r\n\t\t\t\t// If we break the searchstring, rehash the loop to check for duped filters\r\n\t\t\t\t--fi;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t//  In cases not search string, the core test system will handle our needs\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.fData[fi] = fn.makeTest(this.fData[fi]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Run the filter test\r\n\t\tfr |= !fn.runTest(obj,this.fData[fi]);\r\n\t\t\r\n\t\t// Kill early if a filter checks\r\n\t\tif(fr) return filterExec.call(this,true);\r\n\t}\r\n\t\r\n\t// Return the filtering results\r\n\treturn filterExec.call(this,fr);\r\n};\r\n\r\n/**\r\n * @method sortDefault\r\n * The default sort algorithm.\r\n */\r\ndd.collect.prototype.sortDefault = function(a,b)\r\n{\r\n\treturn a>b;\r\n};\r\n\r\n/**\r\n * @method sort\r\n * The sort worker function. This uses the positions of keya and keyb, checks by the initialized\r\n * sort key and then swap the positions if it is required.\r\n * @param {String} keya The key for the first data item.\r\n * @param {String} keyb The key for the second data tiem.\r\n * @return {Boolean} Whether the items were switched or not.\r\n */\r\ndd.collect.prototype.sort = function(keya,keyb)\r\n{\r\n\tvar sa = fn.objectDig(this.parent.data[keya],this.sData.key),\r\n\t\t\tsb = fn.objectDig(this.parent.data[keyb],this.sData.key),\r\n\t\t\tholder,\r\n\tr = this.sData.callback(sa,sb);\r\n\tif(r)\r\n\t{\r\n\t\tholder = keya;\r\n\t\tkeya = keyb;\r\n\t\tkeyb = holder;\r\n\t}\r\n\treturn r;\r\n};\r\n\r\n/**\r\n * @method merge\r\n * The central sort algorithm. preforms a bottom up merge sort. Unlike convential bottom up merge\r\n * sorts, this one uses a position flip to direct which arrays this bounces data between. Which\r\n * means constant array mapping isn't required.\r\n */\r\ndd.collect.prototype.merge = function(sA,sB,Left,Right,End)\r\n{\r\n\tvar iL = Left, iR = Right, j, iRSwitch;\r\n\tfor(j = Left; j < End; ++j)\r\n\t{\r\n\t\t// Sort Algorithm Here\r\n\t\tif(typeof(sA[iR]) === 'undefined')\r\n\t\t{\r\n\t\t\tiRSwitch = true;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tiRSwitch = !this.sort(sA[iL],sA[iR]);\r\n\t\t}\r\n\t\tif(iL < Right && (iR >= End || iRSwitch))\r\n\t\t{\r\n\t\t\tsB[j] = sA[iL++];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tsB[j] = sA[iR++];\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @method collect\r\n * The core collect function, allows for both filtering and sorting.\r\n * @param {Object/String/String[]} filter The filter strings used to filter the data. If this is the\r\n * only parameter, it will be a sort object.\r\n * \r\n * There are multiple methods a filter rule can be written. The most common pattern is the following:\r\n * object property keyoperatorcomparison value\r\n * \r\n * For example:\r\n * gold.total>1000\r\n * Would produce a rule where 'gold.total' is the object property key, '>' is the operator, and '1000' is the comparison value.\r\n * \r\n * A filter rule removes objects that do not satisfy the given condition. In this case, this is saying that \"If an object has a total gold cost greater than 1000, keep it. Otherwise, remove it.\"\r\n * \r\n * The main piece that directs how this type of filter rule behaves is the operator. The possible operators are:\r\n * \r\n * <table>\r\n * <tr><th>Operator</th><th>Function</th></tr>\r\n * <tr><td>=</td><td>Tests if the two pieces are equal.</td></tr>\r\n * <tr><td>></td><td>Tests if the object property is greater than the comparison value</td></tr>\r\n * <tr><td>&lt;</td><td>Tests if the object property is lesser than the comparison value</td></tr>\r\n * <tr><td>>=</td><td>Tests if the object property is greater than or equal to the comparison value</td></tr>\r\n * <tr><td>&lt;=</td><td>Tests if the object property is lesser than or equal to the comparison value</td></tr>\r\n * <tr><td>+,-,*,/,%</td><td>Mathematical operators. Removes the object if the result is 0</td></tr>\r\n * <tr><td>*=</td><td>(String only, case insensitive) Tests if the comparison value is contained within the object property</td></tr>\r\n * <tr><td>^=</td><td>(String only, case insensitive) Tests if the comparison value is at the beginning of the object property</td></tr>\r\n * <tr><td>$=</td><td>(String only, case insensitive) Tests if the comparison value is at the end of the object property</td></tr>\r\n * <tr><td>-></td><td>(Array only) Tests if the comparison value is one of the array elements within the object property</td></tr>\r\n * </table>\r\n * \r\n * As an example, a possible list of filters may include:\r\n * [\"name*=razor\",\"into->3126\"]\r\n * This will find any item with a name that contains \"razor\" and builds into item id 3126.\r\n * \r\n * Then there is the \"look for\" pattern. This is simply:\r\n * object property key\r\n * \r\n * With this pattern, if the object property exists and it does not contain a value of false, it will return true.\r\n * \r\n * An example of this would be:\r\n * \"maps.CrystalScar\"\r\n * Would detect if an item is enabled on CrystalScar.\r\n * \r\n * Finally, a \"searchKey\" pattern:\r\n * searchKey:operator value\r\n * \r\n * This pattern divides the comparison value in to multiple strings, and then checks if the object's tags or name includes each of these strings, in any combination. this allows for searches such as:\r\n * \"searchKey:ca,mage,iop\"\r\n * Which would find cassiopeia correctly from the champions listing.\r\n * \r\n * searchKey is case insensitive, and accepts many different types of separations between words.\r\n * Separations include: space, tabs, newlines, commas, interpuncts, japanese commas, arabic reverse commas, and periods.\r\n *\r\n *\r\n * String patterns may contain multiple searches that are to be \"or\"ed. In this case, seperate each test with a vertical bar \"|\".\r\n * For example:\r\n * \"maps.CrystalScar|maps.TwistedTreeline\"\r\n * would inform you if an item is on either Crystal Scar OR Twisted Treeline.\r\n *\r\n * @param {Object} [sort] The sort object.\r\n * The sort object has two possible properties that it handles all sorts with, the key and callback properties.\r\n * \r\n * key defines what object property value to sort by. This uses the same method that filter uses to find data, such that a key value of 'gold.total' would map to object.gold.total.\r\n * \r\n * callback is optional. If present, it is an a|b compare function, where a return value of true keeps the current order and a return value of false reorders the sort.\r\n * If this is not present, it uses the default callback function:\r\n * \r\n * \tsortDefault = function(a,b)\r\n * \t{\r\n * \t    return a>b;\r\n * \t};\r\n */\r\ndd.model.prototype.collect = function(filter,sort)\r\n{\r\n\tvar c;\r\n\t// Prepare the collection\r\n\tif(typeof(this.collection) === 'undefined')\r\n\t{\r\n\t\tthis.collection = new dd.collect(this);\r\n\t}\r\n\tc = this.collection;\r\n\tc.s = false;\r\n\tc.f = false;\r\n\t\r\n\t// Filter might actually be sort (if it's an object that isn't an array)\r\n\tif((typeof(filter) === 'object') && !(filter instanceof Array))\r\n\t{\r\n\t\tc.sortInit(filter);\r\n\t}\r\n\t// Otherwise, we do our tests here for what information we actually have to work with\r\n\telse\r\n\t{\r\n\t\tif(typeof(filter) === 'string')\r\n\t\t{\r\n\t\t\tfilter = [filter];\r\n\t\t}\r\n\t\tif(typeof(filter) !== 'undefined')\r\n\t\t{\r\n\t\t\tif(filter[0] !== '') c.filterInit(filter);\r\n\t\t\tif(typeof(sort) === 'object')\r\n\t\t\t{\r\n\t\t\t\tc.sortInit(sort);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t// Init switch\r\n\tif(this.init)\r\n\t{\r\n\t\tvar r = [],i=0,tryagain;\r\n\t\tthis.parseAllData();\r\n\t\t\r\n\t\t// Filter\r\n\t\tif(c.f)\r\n\t\t{\r\n\t\t\twhile(i < c.keys.length)\r\n\t\t\t{\r\n\t\t\t\tif(!c.filter(i))\r\n\t\t\t\t{\r\n\t\t\t\t\t++i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Sort\r\n\t\tc.sN = c.keys.length;\r\n\t\tif(c.s && c.sN > 1)\r\n\t\t{\r\n\t\t\tif(!c.sData.callback)\r\n\t\t\t{\r\n\t\t\t\tc.sData.callback = c.sortDefault;\r\n\t\t\t}\r\n\t\t\tvar sK = [c.keys.slice(0),[]],\r\n\t\t\t\tsA = 0, sB = 1, sW, sI;\r\n\t\t\t\r\n\t\t\tfor(sW = 1; sW < c.sN; sW *= 2)\r\n\t\t\t{\r\n\t\t\t\tfor(sI = 0;sI < c.sN; sI += 2 * sW)\r\n\t\t\t\t{\r\n\t\t\t\t\tc.merge(sK[sA],sK[sB],sI, Math.min(sI + sW, c.sN), Math.min(sI + 2 * sW, c.sN));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tsA ^= 1;\r\n\t\t\t\tsB ^= 1;\r\n\t\t\t}\r\n\t\t\tc.keys = sK[sA].slice(0);\r\n\t\t}\r\n\t\t\r\n\t\t// Return\r\n\t\treturn c.keys;\r\n\t}\r\n\t// Fail\r\n\tthis.deleteCollect();\r\n\t\r\n\treturn {\r\n\t\t_action: 'collect',\r\n\t\t_name: this.name,\r\n\t\ts: c.s,\r\n\t\tf: c.f,\r\n\t\tsData: c.sData,\r\n\t\tfData: c.fData\r\n\t};\r\n};\r\n\r\n/**\r\n * @method deleteCollect\r\n * Deletes the current collection. When collect is called, it will regenerate itself.\r\n */\r\ndd.model.prototype.deleteCollect = function()\r\n{\r\n\tdelete this.collection;\r\n};\r\n\r\n/**\r\n * @method datamap\r\n * Maps an array of ids to an array of objects. Generally this shouldn't be used except as part of a\r\n * model working behaviour (see {@link #remodel}) because placing this behaviour within the view or\r\n * controller is the difference between n time and 2n time.\r\n * @method {Object[]} dataArray The data array to map.\r\n */\r\ndd.model.prototype.datamap = function(dataArray)\r\n{\r\n\tvar i, ndata = {};\r\n\tfor(i=0;i<dataArray.length;++i)\r\n\t{\r\n\t\tndata[this.data[dataArray[i]].id] = this.data;\r\n\t}\r\n\treturn ndata;\r\n};\r\n\r\n/**\r\n * @method remodel\r\n * Creates a new model out of the current model. This will either use the keys specified or the\r\n * current collection state. The model simply provides the name for use with useModel. It's\r\n * recommended to destroy remodel's after use, otherwise they can risk memory leaks.\r\n * @param {String} newModel The name of the new model.\r\n * @param {String[]} newKeys The list of keys that will be added to the model.\r\n * @return {Riot.DDragon.model} The new model, or false if it could not be created.\r\n */\r\ndd.model.prototype.remodel = function(newModel, newKeys)\r\n{\r\n\tif(typeof(newKeys) === 'undefined')\r\n\t{\r\n\t\tnewKeys = this.collect();\r\n\t}\r\n\tif(this.init)\r\n\t{\r\n\t\treturn dd.models[newModel] = (new dd.model(this.type,this.version,JSON.stringify({\r\n\t\t\t'data': this.datamap(newKeys),\r\n\t\t\t'keys': newKeys,\r\n\t\t\t'basic': this.basic\r\n\t\t}))).rename(newModel);\r\n\t}\r\n\telse\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\n/**\r\n * @method rmModel\r\n * @member Riot.DDragon\r\n * Removes the specified model type. This is important for remodeling, as remodels can risk memory\r\n * leaks.\r\n * @param {String} name The name of the model that needs to be removed.\r\n */\r\ndd.rmModel = function(name)\r\n{\r\n\tdelete dd.models[name];\r\n};\r\n\r\n/**\r\n * @method useModel\r\n * @member Riot.DDragon\r\n * Pulls a model based on the given type. If the type is an object, and the desired model does not\r\n * already exist, the model will be created.\r\n * @param {String/Object} type The desired model type.\r\n * @param {String} [version=null] The version of the model desired.\r\n * @param {Function} [callback=null] A function to call once the model has finished loading,\r\n * or immediately if it already has. The callback's \"this\" is the model.\r\n * @return {Riot.DDragon.model} The desired model.\r\n */\r\ndd.useModel = function(type,version,callback)\r\n{\r\n\tvar t = type, model;\r\n\tif(typeof(version) === 'string')\r\n\t{\r\n\t\tt += '_'+version;\r\n\t\tif(typeof(dd.models[t]) !== 'object')\r\n\t\t{\r\n\t\t\tmodel = dd.models[t] = (new dd.model(type,version)).rename(t);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tmodel = dd.models[t];\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tif(typeof(dd.models[t]) !== 'object')\r\n\t\t{\r\n\t\t\tmodel = dd.models[t] = (new dd.model(type)).rename(t);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tmodel = dd.models[t];\r\n\t\t}\r\n\t}\r\n\tif(model.init && typeof(callback) !== 'undefined')\r\n\t{\r\n\t\tcallback.call(model);\r\n\t}\r\n\telse if(typeof(callback) !== 'undefined')\r\n\t{\r\n\t\tfn.fire.plan('model', {name: type}, function(planData, execData, fireId) {\r\n\t\t\tif(execData.name === planData.name) {\r\n\t\t\t\tfn.fire.scrap('model', fireId);\r\n\t\t\t\tcallback.call(model);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn model;\r\n};\r\n\r\n/**\r\n * @method retryModel\r\n * @member Riot.DDragon\r\n * Attempts to use a failed return object and reexecute it, returning the new result.\r\n * @param {Object} action A failed model action.\r\n * @return {Object} The new action object.\r\n */\r\ndd.retryModel = function(action)\r\n{\r\n\tif(typeof(action) === 'object')\r\n\t{\r\n\t\tif(typeof(action._name) === 'string')\r\n\t\t{\r\n\t\t\tvar model = dd.useModel(action._name);\r\n\t\t\tswitch(action._action)\r\n\t\t\t{\r\n\t\t\t\tcase 'collect':\r\n\t\t\t\t\tif(action.s && action.f) return model.collect(action.fData,action.sData);\r\n\t\t\t\t\tif(action.f) return model.collect(action.fData);\r\n\t\t\t\t\tif(action.s) return model.collect(action.sData);\r\n\t\t\t\t\treturn model.collect();\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t\tcase 'get':\r\n\t\t\t\t\treturn model.get(action.id);\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t\tcase 'getFull':\r\n\t\t\t\t\treturn model.getFull(action.id);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * @method modelAux\r\n * @member Riot.DDragon\r\n * Performs a series of special actions against the target element based on model information extracted from it\r\n * as well as the data-rg-aux attribute of that element. Each action must be space seperated.\r\n * The actions, as well as the order they act in, are as follows:\r\n * remap_keys: Replace the data-rg-id attribute with an id remap of that key (important for champions)\r\n * empty: Empty the div\r\n * wrap={Number}: Set the wrap property of the images generated by img\r\n * img={String}: Append an image piece in to the element. String defines the image type\r\n * size={String}: The size of the sprite image (for img=sprite only). Default is 'normal'. 'small' and 'tiny' are also available.\r\n * query={String}: Query's the data via fn.objectDig and appends it to the element\r\n * no_inline: The div does not get an inline-block property set.\r\n * strip_data: This strips the data-rg tags used for modelAux from the element\r\n * @param {HTMLElement} The element to fill\r\n */\r\ndd.modelAux = function(el)\r\n{\r\n\tvar info = fn.rgInfo(el,1);\r\n\t\r\n\tfunction infoAux(key, action)\r\n\t{\r\n\t\tvar val;\r\n\t\tif(fn.hasWord(info.aux, key))\r\n\t\t{\r\n\t\t\taction();\r\n\t\t\tinfo.aux = fn.removeWord(info.aux, key);\r\n\t\t\tel.setAttribute('data-rg-aux', info.aux);\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction valueAux(key, action)\r\n\t{\r\n\t\tvar val;\r\n\t\tif(val = fn.hasValue(info.aux, key))\r\n\t\t{\r\n\t\t\taction(val);\r\n\t\t\tinfo.aux = fn.removeValue(info.aux, key);\r\n\t\t\tel.setAttribute('data-rg-aux', info.aux);\r\n\t\t}\r\n\t}\r\n\t\r\n\tif(info && info.aux)\r\n\t{\r\n\t\tdd.addApp([info.name], function()\r\n\t\t{\r\n\t\t\tinfo.inline = true;\r\n\t\t\tinfo.wrap = 2;\r\n\t\t\tinfo.size = 'normal';\r\n\t\t\r\n\t\t\tinfoAux('remap_keys', function()\r\n\t\t\t{\r\n\t\t\t\tvar model = dd.useModel(info.name);\r\n\t\t\t\tinfo.id = model.remapFunc.call(model, info.id);\r\n\t\t\t\tel.setAttribute('data-rg-id', info.id);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tinfoAux('empty', function()\r\n\t\t\t{\r\n\t\t\t\tel.innerHTML = '';\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvalueAux('wrap', function(value)\r\n\t\t\t{\r\n\t\t\t\tinfo.wrap = parseInt(value,10);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvalueAux('size', function(value)\r\n\t\t\t{\r\n\t\t\t\tinfo.size = value;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvalueAux('img', function(value)\r\n\t\t\t{\r\n\t\t\t\tel.innerHTML += dd.useModel(info.name).getImg(info.id, {src: value, wrap: info.wrap, size: info.size});\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tvalueAux('query', function(value)\r\n\t\t\t{\r\n\t\t\t\tvar obj = dd.useModel(info.name).get(info.id);\r\n\t\t\t\tif(!obj.hasOwnProperty(\"_action\"))\r\n\t\t\t\t{\r\n\t\t\t\t\tel.innerHTML += fn.objectDig(dd.useModel(info.name).get(info.id), value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tinfoAux('no_inline', function()\r\n\t\t\t{\r\n\t\t\t\tinfo.inline = false;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// This MUST be last, or it will get clobbered\r\n\t\t\tinfoAux('strip_data', function()\r\n\t\t\t{\r\n\t\t\t\tel.setAttribute('data-rg-name', '');\r\n\t\t\t\tel.setAttribute('data-rg-id', '');\r\n\t\t\t\tel.setAttribute('data-rg-aux', '');\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tif(info.inline)\r\n\t\t\t{\r\n\t\t\t\tel.style.display = 'inline-block';\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * @method dynamicScan\r\n * @member Riot.DDragon\r\n * Scans the DOM starting at the target element. The scan strips data-rg- classes out and resets them as\r\n * attributes, as well as performs a modelAux on each element.\r\n * Commas (,) are used in place of spaces for complex data values.\r\n * @param {HTMLElement} The element to start the scan at.\r\n */\r\n\r\ndd.dynamicScan = (function()\r\n{\r\n\tvar dataReg = /(data-rg-[a-zA-Z]+)=([a-zA-Z0-9_\\.,]+)/;\r\n\tfunction dynamicScan(el)\r\n\t{\r\n\t\tvar m, i, j, child;\r\n\t\tfor(i=0, j=el.childNodes.length; i<j; ++i)\r\n\t\t{\r\n\t\t\tchild = el.childNodes[i];\r\n\t\t\twhile(m = dataReg.exec(child.className))\r\n\t\t\t{\r\n\t\t\t\tchild.setAttribute(m[1], m[2].replace(/,/g,' '));\r\n\t\t\t\tchild.className = child.className.replace(dataReg, '');\r\n\t\t\t}\r\n\t\t\tdd.modelAux(child);\r\n\t\t\tdynamicScan(child);\r\n\t\t}\r\n\t}\r\n\treturn dynamicScan;\r\n})();\r\n\r\n/**\r\n * @method t\r\n * @member Riot.DDragon.fn\r\n * Translates a string based on the given key.\r\n * @param {String} key The key to the string that needs to be translated.\r\n */\r\nfn.t = function(key)\r\n{\r\n\tvar tr = dd.useModel('language').get(key);\r\n\tif(typeof(tr) === 'string')\r\n\t{\r\n\t\treturn tr;\r\n\t}\r\n\treturn key;\r\n};\r\n\r\n/**\r\n * @method tFilter\r\n * @member Riot.DDragon.fn\r\n * Sanitizes a string for multi language purposes\r\n * @param {String} text The text to sanitize\r\n */\r\nfn.tFilter = function(text)\r\n{\r\n\tvar f,s,i,l = dd.useModel('language').tree;\r\n\tif(l)\r\n\t{\r\n\t\t// Apply searchKeyIgnore rules\r\n\t\ts = l.searchKeyIgnore;\r\n\t\tif(s !== '')\r\n\t\t{\r\n\t\t\tf = new RegExp('['+s+']','g');\r\n\t\t\ttext = text.replace(f,'');\r\n\t\t}\r\n\t\t\r\n\t\t// Apply searchKeyRemap rules\r\n\t\ts = l.searchKeyRemap;\r\n\t\ti = s.length;\r\n\t\twhile(i--)\r\n\t\t{\r\n\t\t\tf = new RegExp('['+s[i].v+']','g');\r\n\t\t\ttext = text.replace(f,s[i].k);\r\n\t\t}\r\n\t\t\r\n\t\ttext = text.toLowerCase().replace(/(\\s+|\\t+|(\\n\\r)+|\\n+|,+|·+|\\u3001+|\\u3002+|\\u060C+)/g,' ').replace(/\\.|'/g,'').replace(/(^\\s+|\\s+$)/g,'');\r\n\t}\r\n\treturn text;\r\n};\r\n\r\n// We'll want to start grabbing the current language early\r\ndd.useModel('language');\r\n// The primary css file the default displays use\r\nfn.getCSS(dd.m.cdn+dd.m.css+'/css/view.css');\r\n\r\n// The default display fail\r\ndd.displayFail = function()\r\n{\r\n\treturn '<img src=\"'+dd.m.cdn+'img/global/load01.gif\" />';\r\n};\r\n\r\n/**\r\n * @class Riot.DDragon.display\r\n * @singleton\r\n * An object that stores all displays, built in and app created.\r\n */\r\ndd.display = {};\r\n\r\n/**\r\n * @method addDisplay\r\n * @member Riot.DDragon\r\n * Adds a display definition.\r\n * @param {Object} config The display contig.\r\n * @param {String} config.type The display type.\r\n * @param {Function} config.success\r\n * The function to execute when data is returned successfully. This function needs to return an html\r\n * string to be placed in the view. In most cases this function will recieve a data object as its\r\n * only parameter.\r\n * @param {Function} config.fail\r\n * This function is used when the model fails to retrieve data. This should generally return\r\n * placeholder html.\r\n * @param {Function} config.onFill\r\n * This function is called when the display is finished rendering. The scope of this function is\r\n * the controller, not the view.\r\n */\r\ndd.addDisplay = function(display)\r\n{\r\n\tdd.display[display.type] = display;\r\n};\r\n\r\n/**\r\n * @method displayList\r\n * @member Riot.DDragon\r\n * Creates a list of display executions.\r\n * @param {String} subname The display part used to render a peice of the list.\r\n * @param {Object[]} data A list of data to pass to each of the pieces.\r\n * @return {String} The generated html.\r\n */\r\ndd.displayList = function(subName, data)\r\n{\r\n\tvar r = '',\r\n\t\tj = data.length,\r\n\t\ti = 0,\r\n\t\tsubDisplay = dd.display[subName].success;\r\n\t\r\n\tfor(;i < j;++i)\r\n\t{\r\n\t\tr += subDisplay.call(this,this.model.get(data[i]));\r\n\t}\r\n\treturn r;\r\n};\r\n\r\n/*\r\n * DISPLAY STRUCTURE *\r\n ****\r\n \r\n\t{\r\n\t\t// This type string simply gives a name for the display\r\n\t\ttype: '',\r\n\t\t\r\n\t\tsuccess: function(data)\r\n\t\t{\r\n\t\t\t// Returns an html string describing how to display data\r\n\t\t\t// data tends to be either an object or array\r\n\t\t\t\r\n\t\t\t// In most cases, when taking in an array, the return might look something like:\r\n\t\t\t//   return dd.displayList.call(this,'itempiece',data);\r\n\t\t\t// This is taking advtange of displayList to list out a different display (a subdisplay) multiple times\r\n\t\t\t\r\n\t\t\t// \"this\" keyword during the success function will refer to the view\r\n\t\t\t// \"this.model\" can easily be used to get the model we're pulling from\r\n\t\t},\r\n\t\t\r\n\t\tfail: function()\r\n\t\t{\r\n\t\t\t// This is optional and will default to dd.displayFail (which can, in of itself, be overwritten)\r\n\t\t\t// The fail function should return placeholder html when the model responds with a fail action\r\n\t\t},\r\n\t\r\n\t\tonFill: function()\r\n\t\t{\r\n\t\t\t// This is a callback for when this display finishes filling out.\r\n\t\t\t// This is called only only from the uppermost display, it is not inherited through any parent displays\r\n\t\t\t// The \"this\" keyword during an onFill event is the controller using the populated data, not the view\r\n\t\t},\r\n\t\t\r\n\t\tonWipe: function()\r\n\t\t{\r\n\t\t\t// This is a callback for when the display gets deconstructed, usually by a controller\r\n\t\t}\r\n\t}\r\n \r\n ****\r\n */\r\n\r\n// ITEMS\r\n/**\r\n * @property item_tree\r\n * @member Riot.DDragon.display\r\n * Draws an item builds from tree.\r\n *\r\n * **Draw Data Type:** item object\r\n *\r\n * **Displays:** Item build from tree, using the data as the top of the tree.\r\n */\r\ndd.addDisplay({\r\n\ttype: 'item_tree',\r\n\tsuccess: function(data)\r\n\t{\r\n\t\t// item_tree_worker uses the select data in order to determine if it should select the first item in the tree\r\n\t\tthis.workingData.select = true;\r\n\t\tthis.workingData.depth = data.depth;\r\n\t\treturn '<div class=\"rg-item-tree\"><div class=\"treebox\">'+this.applyDisplay('item_tree_worker',data)+'</div></div>';\r\n\t}\r\n});\r\n\t\r\ndd.addDisplay({\r\n\ttype: 'item_tree_worker',\r\n\tsuccess: function(data)\r\n\t{\r\n\t\tvar j = data.from.length,\r\n\t\t\tr, i,\r\n\t\t\tselect = false,\r\n\t\t\tself = dd.display.item_tree_worker.success,\r\n\t\t\twidth, spread;\r\n\t\r\n\t\tif(this.workingData.select)\r\n\t\t{\r\n\t\t\tselect = this.workingData.select;\r\n\t\t\tthis.workingData.select = false;\r\n\t\t}\r\n\t\t\r\n\t\t\t// The top of the tree\r\n\t\tr = this.model.getImg(data.id,{\r\n\t\t\tsize: (this.workingData.depth > 3 ? 'small' : 'normal' ),\r\n\t\t\twrap: 3,\r\n\t\t\tclasses: this.runClassTest(data)+(select?'selected ':'')+'treeimg'\r\n\t\t});\r\n\t\t\r\n\t\t// Begin tree building if there are children\r\n\t\tif(j !== 0)\r\n\t\t{\r\n\t\t\twidth = 100/j,\r\n\t\t\tspread = (j===1?'single':'multi');\r\n\t\t\t\r\n\t\t\t// Wrap the parent in the head of the tree. Then build the horizontal bar\r\n\t\t\tr = '<div class=\"treehead '+spread+'\">' + r;\r\n\t\t\tif(spread === 'multi')\r\n\t\t\t{\r\n\t\t\t\tr += '<div class=\"branch multi\"></div><div class=\"branch limb\" style=\"width: '+(100-width)+'%;\"></div>';\r\n\t\t\t}\r\n\t\t\tr += '</div>'; // </treehead>\r\n\t\t\t\r\n\t\t\t// Each child potentially has its own tree\r\n\t\t\tfor(i=0;i<j;i++)\r\n\t\t\t{\r\n\t\t\t\t// Callback\r\n\t\t\t\tr += '<div class=\"treebox\" style=\"width: '+width+'%;\"><div class=\"branch '+spread+'\"></div>'+self.call(this,this.model.get(data.from[i]))+'</div>';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n});\r\n\r\n\r\n/**\r\n * @property item_tooltip\r\n * @member Riot.DDragon.display\r\n * Draws an item tooltip.\r\n *\r\n * **Draw Data Type:** item object\r\n *\r\n * **Displays:** The contents of an item tooltip.\r\n */\r\ndd.addDisplay({\r\n\ttype: 'item_tooltip',\r\n\t// Expects: Individual Item Object\r\n\tsuccess: function(data)\r\n\t{\r\n\t\treturn this.model.getImg(data.id)+\r\n\t\t'<div class=\"info\">'+\r\n\t\t\t'<div class=\"name\">'+data.name+'</div>'+\r\n\t\t\t'<div class=\"description\">'+data.description+'</div>'+\r\n\t\t\t'<div class=\"cost\">'+fn.t('Cost_')+' <span class=\"gold\">' + (data.specialRecipe !== 0 ? fn.t('SpecialRecipeLarge') : data.gold.total+' ('+data.gold.base+')') + '</span></div>'+\r\n\t\t'</div>';\r\n\t}\r\n});\r\n\r\n\r\n\r\n/**\r\n * @property item_modal\r\n * @member Riot.DDragon.display\r\n * Draws an item modal.\r\n *\r\n * **Draw Data Type:** item object\r\n *\r\n * **Displays:** A modal content piecing together an item's build into, build from (using {@link Riot.DDragon.display#item_tree}),\r\n * and a description box. This display hooks events up to be traversable.\r\n */\r\ndd.addDisplay({\r\n\ttype: 'item_modal',\r\n\t// Expects: Individual Item Object\r\n\tsuccess: function(data)\r\n\t{\r\n\t\treturn ''+\r\n\t\t'<div class=\"item-into\">'+this.applyDisplay('item_modal_build',data)+'</div>'+\r\n\t\tthis.applyDisplay('item_tree',data)+\r\n\t\t'<div class=\"item-desc\">'+this.applyDisplay('item_modal_description',data)+'</div>';\r\n\t},\r\n\tonFill: function()\r\n\t{\r\n\t\tvar that = this;\r\n\t\t\r\n\t\tfn.addEvent(this.box,'mousedown',function(data)\r\n\t\t{\r\n\t\t\tvar d = fn.rgInfo(data.target,3);\r\n\t\t\tif(d)\r\n\t\t\t{\r\n\t\t\t\tvar item = dd.useModel(d.name).get(d.id);\r\n\t\t\t\tif(fn.hasClass(data.target, 'treeimg'))\r\n\t\t\t\t{\r\n\t\t\t\t\tfn.removeClass(fn.$('.selected',  this.box)[0], 'selected');\r\n\t\t\t\t\tfn.addClass(data.target, 'selected');\r\n\t\t\t\t\tfn.$('.item-desc', this.box)[0].innerHTML = that.view.applyDisplay('item_modal_description',item);\r\n\t\t\t\t\tfn.$('.item-into', this.box)[0].innerHTML = that.view.applyDisplay('item_modal_build',item);\r\n\t\t\t\t}\r\n\t\t\t\telse if(fn.hasClass(data.target,'intoimg'))\r\n\t\t\t\t{\r\n\t\t\t\t\tthat.redraw('getFull',d.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tonWipe: function()\r\n\t{\r\n\t\tfn.removeEvent(this.box,'mousedown');\r\n\t}\r\n});\r\n\r\ndd.addDisplay({\r\n\ttype: 'item_modal_description',\r\n\tsuccess: function(data)\r\n\t{\r\n\t\treturn ''+\r\n\t\t'<div class=\"title\">'+\r\n\t\t\tthis.model.getImg(data.id,{src:'full'})+\r\n\t\t\t'<div class=\"name\">'+data.name+'</div>'+\r\n\t\t\t'<div class=\"cost\">'+fn.t('Cost_')+' <span class=\"gold\">' + (data.specialRecipe !== 0 ? fn.t('SpecialRecipeLarge') : data.gold.total+' ('+data.gold.base+')') + '</span></div>'+\r\n\t\t'</div>'+\r\n\t\t'<div class=\"description\">'+data.description+'</div>';\r\n\t}\r\n});\r\n\r\ndd.addDisplay({\r\n\ttype: 'item_modal_build',\r\n\tsuccess: function(data)\r\n\t{\r\n\t\tvar i,j, r = '';\r\n\t\tfor(i = 0, j = data.into.length; i < j; ++i)\r\n\t\t{\r\n\t\t\t// Wrap 3 includes the data-rg information for reactive hooking\r\n\t\t\tr += this.model.getImg(data.into[i],{wrap:3,classes:'intoimg'});\r\n\t\t}\r\n\t\treturn r;\r\n\t}\r\n});\r\n\r\n/**\r\n * @property rune_tooltip\r\n * @member Riot.DDragon.display\r\n * Draws a rune tooltip.\r\n *\r\n * **Draw Data Type:** rune object\r\n *\r\n * **Displays:** The contents of a rune tooltip.\r\n */\r\ndd.addDisplay({\r\n\ttype: 'rune_tooltip',\r\n\t// Expects: Individual Rune Object\r\n\tsuccess: function(data)\r\n\t{\r\n\t\treturn this.model.getImg(data.id)+\r\n\t\t'<div class=\"info\">'+\r\n\t\t\t'<div class=\"name\">'+data.name+'</div>'+\r\n\t\t\t'<div class=\"description\">'+data.description+'</div>'+\r\n\t\t'</div>';\r\n\t}\r\n});\r\n\r\n/**\r\n * @property mastery_trunk\r\n * @member Riot.DDragon.display\r\n * Draws a single mastery column.\r\n *\r\n * **Draw Data Type:** mastery trunk object, contained in model.tree\r\n *\r\n * **Displays:** A measured out, full mastery column. Normally, this display is best called\r\n * by a different display.\r\n *\r\n * For example: var Offense = Riot.DDragon.display.mastery_trunk.success(this.model.tree.Offense);\r\n */\r\ndd.addDisplay({\r\n\ttype: 'mastery_trunk',\r\n\tsuccess: function(trunk)\r\n\t{\r\n\t\tvar top = trunk.length,\r\n\t\t\tleft,\r\n\t\t\tr = '',\r\n\t\t\tdata;\r\n\t\tr += '<div class=\"rg-mastery-trunk\">';\r\n\t\twhile(top--)\r\n\t\t{\r\n\t\t\tleft = trunk[top].length;\r\n\t\t\twhile(left--)\r\n\t\t\t{\r\n\t\t\t\tif(trunk[top][left] !== null)\r\n\t\t\t\t{\r\n\t\t\t\t\tdata = this.model.get(trunk[top][left].masteryId);\r\n\t\t\t\t\tr += '<div class=\"mastery left'+left+' top'+top+'\" data-rg-name=\"'+this.model.name+'\" data-rg-id=\"'+data.id+'\">'+\r\n\t\t\t\t\t\tthis.model.getImg(data.id)+\r\n\t\t\t\t\t'</div>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn r + '</div>';\r\n\t}\r\n});\r\n\r\n\r\n/**\r\n * @property champion_tooltip\r\n * @member Riot.DDragon.display\r\n * Draws a champion tooltip.\r\n *\r\n * **Draw Data Type:** champion object\r\n *\r\n * **Displays:** The contents of a champion tooltip.\r\n */\r\ndd.addDisplay({\r\n\ttype: 'champion_tooltip',\r\n\tsuccess: function(data)\r\n\t{\r\n\t\treturn this.model.getImg(data.id)+\r\n\t\t\t'<div class=\"info\">'+\r\n\t\t\t\t'<div class=\"name\">'+data.name+'</div>'+\r\n\t\t\t\t'<div class=\"description\">'+data.blurb+'</div>'+\r\n\t\t\t'</div>';\r\n\t}\r\n});\r\n\r\n\r\n/**\r\n * @property summoner_tooltip\r\n * @member Riot.DDragon.display\r\n * Draws a summoner tooltip.\r\n *\r\n * **Draw Data Type:** summoner object\r\n *\r\n * **Displays:** The contents of a summoner tooltip.\r\n */\r\ndd.addDisplay({\r\n\ttype: 'summoner_tooltip',\r\n\tsuccess: function(data)\r\n\t{\r\n\t\treturn this.model.getImg(data.id)+\r\n\t\t'<div class=\"info\">'+\r\n\t\t\t'<div class=\"name\">'+data.name+'</div>'+\r\n\t\t\t'<div class=\"description\">'+data.description+'</div>'+\r\n\t\t'</div>';\r\n\t}\r\n});\r\n/**\r\n * @class Riot.DDragon.view\r\n * A class used to render the specified display type. This allows for a display to execute methods\r\n * prior to doing various tasks, such as onWipe and onReactive. This class should not be created\r\n * directly, instead use the {@link Riot.DDragon#useView}.\r\n */\r\n \r\ndd.views = {};\r\n\r\ndd.view = function(display)\r\n{\r\n\tthis.init = false;\r\n\tthis.display = dd.display[display];\r\n\tthis.content = '';\r\n\tthis.model = false;\r\n\t\r\n\t// Working data is used and reset whenever a display is loaded.\r\n\t// It's not used internally, it simply provides a reliably resetting data holder for displays\r\n\tthis.workingData = {};\r\n\t\r\n\t// onFill is an event called by the controller that's specific to each display\r\n\tif(dd.display[display].onFill)\r\n\t{\r\n\t\tthis.onFill = function()\r\n\t\t{\r\n\t\t\tvar that = this;\r\n\t\t\t// onFill commonly relies on rendered content to manipulate\r\n\t\t\t// setTimeout forces a frame draw, allowing us to manipulate the real rendered content\r\n\t\t\tsetTimeout(function()\r\n\t\t\t{\r\n\t\t\t\tthat.view.display.onFill.call(that);\r\n\t\t\t},0);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tthis.onFill = function(){};\r\n\t}\r\n\t\r\n\t// The teardown side of onFill\r\n\tthis.onWipe = dd.display[display].onWipe || function(){};\r\n\t\r\n\t// views can respond to controller reactive as well\r\n\tthis.onReactive = dd.display[display].onReactive || function(){};\r\n\t\r\n\t// These holds data tester information\r\n\t// This can be used (see addClassTest below) to optionally add classes based on information in the data\r\n\tthis.classTestsHash = {};\r\n\tthis.classTests = [];\r\n};\r\n\r\n/**\r\n * @method loadModel\r\n * Sets the model type this view uses.\r\n * @param {Riot.DDragon.model} model The model type that this view uses.\r\n */\r\ndd.view.prototype.loadModel = function(model)\r\n{\r\n\tthis.model = model;\r\n};\r\n\r\n/** \r\n * @method applyDisplay\r\n * This executes the specified display but sets the scope to this view. This method will also catch\r\n * errors that are thrown by the fired during the execution of the display.\r\n * @param {String} display The display type to execute.\r\n * @param {Object} data The data that will be passed to the display.\r\n * @return {String} The result of calling the display's success method.\r\n */\r\ndd.view.prototype.applyDisplay = function(display,data)\r\n{\r\n\tvar r;\r\n\ttry\r\n\t{\r\n\t\tr = dd.display[display].success.call(this,data);\r\n\t}\r\n\tcatch(e)\r\n\t{\r\n        if(typeof(dd.display[display]) === 'undefined')\r\n\t\t{\r\n\t\t\tr = fn.er(e, 'view.applyDisplay','Nonexistent display ('+display+')');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tr = fn.er(e, 'view.applyDisplay','Invalid data used for display ('+display+')');\r\n\t\t}\r\n\t}\r\n\treturn r;\r\n};\r\n\r\n/**\r\n * @method load\r\n * Loads the managed display with the specified data and executes it.\r\n * @param {Object} data The data to pass to the display.\r\n */\r\ndd.view.prototype.load = function(data)\r\n{\r\n\tthis.data = data;\r\n\tif(typeof(data) === 'object' && typeof(data._action) === 'string')\r\n\t{\r\n\t\tif(typeof(this.display.fail) === 'object')\r\n\t\t{\r\n\t\t\tthis.content = this.display.fail.call(this);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.content = dd.displayFail();\r\n\t\t}\r\n\t\tthis.init = false;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// Reset working data\r\n\t\tthis.workingData = {};\r\n\t\t\r\n\t\t// Run the display\r\n\t\tthis.content = this.applyDisplay(this.display.type,data);\r\n\t\tthis.init = true;\r\n\t}\r\n};\r\n\r\n/**\r\n * @method reload\r\n * Attempts to retrieve data after a failure.\r\n */\r\ndd.view.prototype.reload = function()\r\n{\r\n\tif(!this.init || (typeof(data) === 'object' && typeof(data._action) === 'string'))\r\n\t{\r\n\t\tthis.load(dd.retryModel(this.data));\r\n\t}\r\n};\r\n\r\n/**\r\r\n * @method addClassTest\r\n * Adds a class test that will be executed when the view renders. If the test passes, then the\r\n * specified classes will be added to the view's container.\r\n * @param {String} test A test that will be passed to the {@link Riot.DDragon.fn#makeTest} method.\r\n * @param {String[]} classes The classes that will be added when the test passes.\r\n */\r\ndd.view.prototype.addClassTest = function(test,classes)\r\n{\r\n\t// Make the test and add the potential classes\r\n\tvar testObj = fn.makeTest(test);\r\n\ttestObj.classes = classes;\r\n\t\r\n\t// If we already have the key we're comparing to in, we replace that test\r\n\tif(typeof(this.classTestsHash[testObj.key]) !== 'undefined')\r\n\t{\r\n\t\tthis.classTests[this.classTestsHash[testObj.key]] = testObj;\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// the testshash just has an array position of the classTests\r\n\t\t// We do this due to the speed of looping through arrays\r\n\t\tthis.classTestsHash[testObj.key] = this.classTests.push(testObj) - 1;\r\n\t}\r\n};\r\n\r\n/**\r\n * @method runClassTest\r\n * Executes all classTests on the specified data.\r\n * @param {Object} data The data to execute the tests against.\r\n * @return {String} The classes that need to be added to the view.\r\n */\r\ndd.view.prototype.runClassTest = function(data)\r\n{\r\n\t// We can run down since loop order doesn't matter when running the class tests\r\n\tvar i = this.classTests.length, classes = '';\r\n\twhile(i--)\r\n\t{\r\n\t\t// If it matches the test, we add the classes\r\n\t\tif(fn.runTest(data,this.classTests[i]))\r\n\t\t{\r\n\t\t\tclasses += this.classTests[i].classes + ' ';\r\n\t\t}\r\n\t}\r\n\treturn classes;\r\n};\r\n\r\n/**\r\n * @method useView\r\n * Creates a new view using a specific display id. Wrapper function.\r\n * @member Riot.DDragon\r\n * @param {String} display The id of the display type this view will execute.\r\n * @return {Riot.DDragon.view} The created view.\r\n */\r\ndd.useView = function(display)\r\n{\r\n\treturn new dd.view(display);\r\n};dd.box = {\r\n  modal: {\r\n    overrides:['target'],\r\n  \r\n   /*\r\n    * The type field is a unique identifier for this type field, used as the reference in the rgbox field\r\n    */\r\n    type: 'modal',\r\n    \r\n   /*\r\n    * dataTarget defines what type of location the target needs to refer to\r\n    * It can be one of target, rel, box, or commonbox\r\n    *  target: This fills the data in to a target element, defined by the target field\r\n    *  rel: This fills the data in to a target element, defined by rel field in the target field\r\n    *  box: This creates a new box within the target field, then fills the data in to that\r\n    *  commonbox: This uses a common box based on this object's type, only allowing a single box. Otherwise works as a box does\r\n    */\r\n    dataTarget: 'commonbox',\r\n    \r\n   /*\r\n    * target is used as either the fill target, fill reference target, or parent of the box used by the dataTarget\r\n    * This is a jQuery selector string\r\n    * a selector string of 'this' will cause it to use jQuery $(this), referring to the DOM element where this box type was called from\r\n    */\r\n    target: 'body',\r\n    \r\n   /*\r\n    * If this should empty the target before append\r\n    * This is ignored on commonbox and box\r\n    * With rel, this refers to emptying the rel target, not the initial target\r\n    */\r\n    empty: false,\r\n    \r\n   /*\r\n    * preselect allows the target selector, as well as the rel selector, to be saved as a whole selector\r\n    * This will increase performance, but won't allow the script to detect changes to the particular element\r\n    * If the target is 'body', this is suggested to be turned on always\r\n    */\r\n    preselect: true,\r\n    \r\n   /*\r\n    * wrapsChildren is a binary switch that defines if the children of the target element should be extracted and wrapped in to\r\n    * a z-index breakdown, then places the data 'above' everything else.\r\n    * This is most commonly used for modals\r\n    */\r\n    wrapsChildren: true,\r\n    \r\n   /*\r\n    * position is used only with box and commonbox dataTargets\r\n    * It's used to define against what the box is positioned. This can either be: none, target, or mouse\r\n    *  none: This drops the box in to the target with no positioning declared,\r\n    *    If none is used, 'from', 'to', 'offsetX', and 'offsetY' are not used.\r\n    *  target: This positions it relative to the target element.\r\n    *  mouse: This positions it based on mouse movement.\r\n    *  viewport: This positions it based on the viewport (visible page).\r\n    */\r\n    position: 'viewport',\r\n    \r\n   /*\r\n    * drawFrom defines the start position to start drawing the box from, relative to the position\r\n    * This is a combo string consisting of a vertical and horizontal positioning, using standard css words.\r\n    * For example, 'top left' or 'bottom right' are valid.\r\n    * 'center' is also used, which tries to center the box relative to the target\r\n    * 'viewport' is used to draw from a direction that has the further coordinates from the sides of the viewport\r\n    *   so that if an element is in the top left quadrant of the viewport, it draws the box from the bottom right of the target\r\n    *\r\n    * In the case of position: mouse, drawFrom is not used. Instead, the drawFrom is assumed to just be the mouse.\r\n    */\r\n    drawFrom: 'center',\r\n    \r\n   /*\r\n    * drawTo defines which direction the box draws in relation to the drawFrom\r\n    * this uses the same wordings that drawFrom uses, then draws in that direction\r\n    */\r\n    drawTo: 'center',\r\n    \r\n   /*\r\n    * offsetX and offsetY are used to offset the resulting position\r\n    */\r\n    offsetX: 0,\r\n    offsetY: 0,\r\n    \r\n   /*\r\n    * classes attaches a number of a classes on to the initial box element\r\n    */\r\n    classes: '',\r\n    \r\n   /*\r\n    * Events are completely optional.\r\n    * There are two types of events for controllers: box events that you define here, and controller events that you define on controller creation\r\n    * They are all the same four: \"onCreate\", \"onDestroy\", \"onShow\", and \"onHide\". The box event always occurs before the controller event.\r\n    * Generally, it's best to place events in the controller stage, as at this stage is very box dependent\r\n    * Modals are a special case as they should deconstruct in the same way for all modals, when you click the background (wDown)\r\n    */\r\n    onCreate: function()\r\n    {\r\n      var modal = this;\r\n      fn.addEvent(this.wDown, 'mousedown', function()\r\n      {\r\n        modal.destroy();\r\n      });\r\n    },\r\n\tonDestroy: function()\r\n\t{\r\n\t  if(this.wDown)\r\n\t  {\r\n\t    fn.removeEvent(this.wDown, 'mousedown');\r\n\t  }\r\n\t}\r\n  },\r\n  tooltip: {\r\n    type: 'tooltip',\r\n    dataTarget: 'commonbox',\r\n    target: 'body',\r\n    empty: false,\r\n    preselect: true,\r\n    wrapsChildren: false,\r\n    position: 'mouse',\r\n    drawTo: 'center',\r\n    offsetX: 30,\r\n    offsetY: 30,\r\n    classes: ''\r\n  },\r\n  container: {\r\n    overrides: ['target'],\r\n    type: 'container',\r\n    dataTarget: 'target',\r\n    target: 'body',\r\n    empty: false,\r\n    preselect: true,\r\n    wrapsChildren: false,\r\n    position: 'none',\r\n    classes: ''\r\n  }\r\n};\r\n\r\n// This really only exists as syntactic sugar\r\ndd.addBox = function(box)\r\n{\r\n  dd.box[box.type] = box;\r\n};\r\n/**\r\n * @class Riot.DDragon.controller\r\n * Used to house event event executions and view renders while passing the proper data to said\r\n * views. To add a controller please refer to {@link Riot.DDragon#buildController}.\r\n */\r\n\r\ndd.controllers = {cur:0};\r\n\r\ndd.controller = function(boxType)\r\n{\r\n\tvar overrides = [],i;\r\n\t\r\n\t// Load the box data. Split based on if there were overrides specified\r\n\tif(boxType.indexOf('_') !== -1)\r\n\t{\r\n\t\toverrides = boxType.split('_');\r\n\t\t// The box type is the first argument\r\n\t\tthis.loadBox(overrides.shift());\r\n\t\t\r\n\t\t// Everything else is an override\r\n\t\tfor(i = 0;i<overrides.length;i++)\r\n\t\t{\r\n\t\t\tthis.boxData[this.boxData.overrides[i]] = overrides[i];\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tthis.loadBox(boxType);\r\n\t}\r\n\t\r\n\t// Default view just has empty content\r\n\tthis.view = false;\r\n\tthis.model = false;\r\n\t\r\n\t// Default display properties\r\n\tthis.visible = false;\r\n\tthis.repos = false;\r\n\tthis.refix = dd.fixed==='absolute';\r\n\tthis.ranView = false;\r\n\t\r\n\t// There is no starting box DOM object\r\n\tthis.box = false;\r\n\t\r\n\t// Additional classes to add to the box\r\n\tthis.classes = '';\r\n\t\r\n\t// Controllers, since they must interact with each other, has direct control over the controllers group\r\n\t// id keeps this tracing sane\r\n\tthis.id = 'cont'+(++dd.controllers.cur);\r\n\tdd.controllers[this.id] = this;\r\n\t\r\n\t// Some storage area for various box types\r\n\tthis.wrapper = [];\r\n\tthis.wDown = false;\r\n\tthis.wChildren = [];\r\n\tthis.current = '';\r\n\tthis.store = {};\r\n\t\r\n\t// Events\r\n\tthis.onCreate = function(){};\r\n\tthis.onDestroy = function(){};\r\n\tthis.onShow = function(){};\r\n\tthis.onHide = function(){};\r\n\tthis.onReactive = function(){};\r\n};\r\n\r\n/**\r\n * @method loadBox\r\n * Initializes the box events of this controller.\r\n * @param {String} type The box type to use as the base for this controller.\r\n */\r\ndd.controller.prototype.loadBox = function(type)\r\n{\r\n\tthis.boxData = fn.rebase({},dd.box[type],{\r\n\t\tonCreate: function(){},\r\n\t\tonDestroy: function(){},\r\n\t\tonShow: function(){},\r\n\t\tonHide: function(){},\r\n\t\tonReactive: function(){}\r\n\t});\r\n\t\r\n\tthis.initSingleWrap = false;\r\n\tif(window.rg_force_reducereflow && this.boxData.wrapsChildren && this.boxData.dataTarget === 'commonbox')\r\n\t{\r\n\t\tthis.singleWrap = true;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tthis.singleWrap = false;\r\n\t}\r\n};\r\n\r\n/**\r\n * @method create\r\n * Creates the box element that will be controlled.\r\n */\r\ndd.controller.prototype.create = function()\r\n{\r\n\t// Shorthand\r\n\tvar bd = this.boxData,\r\n\t\tbSelect = '',\r\n\t\ti, j;\r\n\t\r\n\tif(typeof bd.target === 'string')\r\n\t{\r\n\t\tthis.target = fn.$(bd.target, bd.preselect)[0];\r\n\t}\r\n\telse\r\n\t{\r\n\t\tthis.target = bd.target;\r\n\t}\r\n\t\r\n\t// Destroy the box if it exists, so we don't have wandering lost elements\r\n\tif(this.box !== false)\r\n\t{\r\n\t\tthis.destroy();\r\n\t}\r\n\t\r\n\t// Make the box\r\n\tthis.box = fn.mkDiv({\r\n\t\tclasses:'ninja rg-box-'+bd.type+this.classes,\r\n\t\tdata: [{k:'control',v:this.id}]\r\n\t});\r\n\t\r\n\t// There are multiple methods that may happen depending on what type the dataTarget is\r\n\tswitch(bd.dataTarget)\r\n\t{\r\n\t\t// rel shifts the target to be the one defined by the first target's rel attribute\r\n\t\tcase 'rel':\r\n\t\t\tthis.target = fn.$(this.target.getAttribute('rel'),bd.preselect)[0];\r\n\t\t\t\r\n\t\t// If it's just target (or rel morphing in to target), there's only one choice path:\r\n\t\t// Whether or not to empty out the target\r\n\t\tcase 'target':\r\n\t\t\tif(bd.empty) this.target.innerHTML = '';\r\n\t\tbreak;\r\n\t\t\r\n\t\t// Common boxes are single box restrictions for specific box types\r\n\t\tcase 'commonbox':\r\n\t\t\tbSelect = 'rg-commonbox-'+bd.type;\r\n\t\t\t\r\n\t\t\t// If this ID already exists, we kill it\r\n\t\t\tif((holder = fn.$('#'+bSelect,true)).length)\r\n\t\t\t{\r\n\t\t\t\tdd.destroyBox(holder[0]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// We set the container to be the new commonbox\r\n\t\t\tthis.box.id = bSelect;\r\n\t\t\t\r\n\t\tcase 'box':\r\n\t\t\tif(bd.position === 'target')\r\n\t\t\t{\r\n\t\t\t\tthis.box.style.position = 'absolute';\r\n\t\t\t\tthis.repos = true;\r\n\t\t\t}\r\n\t\t\tswitch(bd.position)\r\n\t\t\t{\r\n\t\t\t\tcase 'mouse':\r\n\t\t\t\t\tbd.drawFrom = 'mouse';\r\n\t\t\t \r\n\t\t\t\tcase 'viewport':\r\n\t\t\t\t\tthis.repos = true;\r\n\t\t\t\t\tthis.box.style.position = dd.fixed;\r\n\t\t\t\t\tthis.refix &= true;\r\n\t\t\t\t\r\n\t\t\t\tcase 'target':\r\n\t\t\t\t\tthis.target.style.position = 'relative';\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(this.repos)\r\n\t\t\t{\r\n\t\t\t\t// Divides the positioning in to something more easy to programatically read\r\n\t\t\t\t// drawFrom\r\n\t\t\t\tswitch(bd.drawFrom)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'mouse':\r\n\t\t\t\t\tcase 'center':\r\n\t\t\t\t\tcase 'page':\r\n\t\t\t\t\t\tthis.repos = [bd.drawFrom,bd.drawFrom];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthis.repos = bd.drawFrom.split(' ');\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// drawTo\r\n\t\t\t\tswitch(bd.drawTo)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'center':\r\n\t\t\t\t\tcase 'page':\r\n\t\t\t\t\t\tthis.repos.push(bd.drawTo,bd.drawTo);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthis.repos = this.repos.concat(bd.drawTo.split(' '));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// If the box wraps its children, then we need to do some div moving magic\r\n\t\t\tif(bd.wrapsChildren)\r\n\t\t\t{\r\n\t\t\t\tthis.box.className += ' wrap-ceil';\r\n\t\t\t\tif(this.singleWrap && this.initSingleWrap)\r\n\t\t\t\t{\r\n\t\t\t\t\tfn.removeClass(this.wDown, 'ninja');\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// We need a non-living list of the target's children\r\n\t\t\t\t\t// This is because they will change\r\n\t\t\t\t\tthis.wChildren = fn.deadChildren(this.target);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Build the wrappers\r\n\t\t\t\t\tthis.groupWrapper = fn.mkDiv({classes:'wrap-floor',append:this.target});\r\n\t\t\t\t\tthis.wDown = fn.mkDiv({classes:'wrap-wall',append:this.target,style:'position:'+dd.fixed+';'});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tif(this.singleWrap)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.initSingleWrap = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.wrapper = [\r\n\t\t\t\t\t\t\tthis.groupWrapper,\r\n\t\t\t\t\t\t\tthis.wDown,\r\n\t\t\t\t\t\t\tthis.box\r\n\t\t\t\t\t\t];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Move all the dead children in to the first wrapper\r\n\t\t\t\t\tfor(i=0,j=this.wChildren.length;i<j;i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.groupWrapper.appendChild(this.wChildren[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\tbreak;\r\n\t}\r\n\tthis.target.appendChild(this.box);\r\n\t\r\n\t// The actual repositioning must occur after the element is already present\r\n\tthis.move();\r\n\t\r\n\t// event triggers\r\n\tthis.boxData.onCreate.call(this);\r\n\tthis.onCreate.call(this);\r\n};\r\n\r\n/**\r\n * @method addClass\r\n * Adds a css class to the managed box element.\r\n * @param {String} class_ The css class to add.\r\n */\r\ndd.controller.prototype.addClass = function(class_)\r\n{\r\n\t// Only add classes that aren't there\r\n\tif(!fn.hasWord(this.classes,class_))\r\n\t{\r\n\t\tthis.classes += ' '+class_;\r\n\t\tif(this.box !== false)\r\n\t\t{\r\n\t\t\tfn.addClass(this.box,class_);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @method removeClass\r\n * Removes a css class from the managed box element.\r\n * @param {String} class_ The css class to remove.\r\n */\r\ndd.controller.prototype.removeClass = function(class_)\r\n{\r\n\tthis.classes = fn.removeWord(this.classes,class_);\r\n\tif(this.box !== false)\r\n\t{\r\n\t\tfn.removeClass(this.box,class_);\r\n\t}\r\n};\r\n\r\n/**\r\n * @method destroy\r\n * Destroys the controller including the managed box element. This will execute the box's onDestroy\r\n * method.\r\n */\r\ndd.controller.prototype.destroy = function()\r\n{\r\n\tif(this.singleWrap && this.initSingleWrap)\r\n\t{\r\n\t\tfn.addClass(this.wDown, 'ninja');\r\n\t\tthis.target.removeChild(this.box);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tvar i,j;\r\n\t\tif(this.boxData.wrapsChildren)\r\n\t\t{\r\n\t\t\tfor(i=0, j=this.wChildren.length;i<j;++i)\r\n\t\t\t{\r\n\t\t\t\tthis.target.appendChild(this.wChildren[i]);\r\n\t\t\t}\r\n\t\t\tfor(i=0, j=this.wrapper.length;i<j;++i)\r\n\t\t\t{\r\n\t\t\t\tthis.target.removeChild(this.wrapper[i]);\r\n\t\t\t}\r\n\t\t\tthis.wDown = false;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfn.rmDiv(this.box);\r\n\t\t}\r\n\t}\r\n\tthis.box = false;\r\n\tthis.visible = false;\r\n\tif(this.view)\r\n\t{\r\n\t\tthis.view.onWipe.call(this);\r\n\t\tthis.ranView = false;\r\n\t}\r\n\tthis.boxData.onDestroy.call(this);\r\n\tthis.onDestroy.call(this);\r\n};\r\n\r\n/**\r\n * @method newMV\r\n * Updates both the current model and the current view being used.\r\n * @param {String} model The new model type that will be used.\r\n * @param {String} [view]\r\n * The new view type that will be used. If this is not supplied, it will attempt to determine which\r\n * view is desired based on the {modelName}_{controllerBoxType}.\r\n */\r\ndd.controller.prototype.newMV = function(model,view)\r\n{\r\n\t// If no view was specified, \r\n\tif(arguments.length < 2)\r\n\t{\r\n\t\tvar view = model+'_'+this.boxData.type;\r\n\t}\r\n    this.removeClass('rg-display-[A-Za-z_0-9.]+');\r\n\tthis.model = dd.useModel(model);\r\n\tthis.view = dd.useView(view);\r\n\tthis.view.controller = this;\r\n\tthis.addClass('rg-display-'+this.view.display.type);\r\n\tthis.view.loadModel(this.model);\r\n};\r\n\r\n/**\r\n * @method fillInView\r\n * Sets the innerHTML of the box with the specified view. Generally this is not needed.\r\n * @param {Riot.DDragon.view} view The view that needs to be rendered.\r\n */\r\ndd.controller.prototype.fillInView = function(view)\r\n{\r\n\tif(this.ranView)\r\n\t{\r\n\t\tview.onWipe.call(this);\r\n\t}\r\n\telse\r\n\t{\r\n\t\tthis.ranView = true;\r\n\t}\r\n\tthis.box.innerHTML = view.content;\r\n};\r\n\r\n/**\r\n * @method runView\r\n * Runs the view and places the data in the box's html. Any fire plans in place will be called at\r\n * this time. This can only run after the controller has been created.\r\n */\r\ndd.controller.prototype.runView = function()\r\n{\r\n\tif(this.box !== false && this.view)\r\n\t{\r\n\t\tthis.fillInView(this.view);\r\n\t\tif(this.view.init === false)\r\n\t\t{\r\n\t\t\tfn.fire.plan('model',{'view': this.view, 'controller': this},function(p,e,fireId)\r\n\t\t\t{\r\n\t\t\t\tif(typeof(p.view.data) !== 'undefined' && p.view.data._name === e.name)\r\n\t\t\t\t{\r\n\t\t\t\t\tp.view.reload();\r\n\t\t\t\t\tp.controller.fillInView(p.view);\r\n\t\t\t\t\tp.controller.view.onFill.call(p.controller);\r\n\t\t\t\t\tfn.fire.scrap(fireId);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.view.onFill.call(this);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @method redraw\r\n * Redraws the controller using the specified model call.\r\n * @param {String} modelCall The method to call. These parameters are mapped as such:\r\n * \r\n * - get => get(arg[1])\r\n * - get => get(arg[1], arg[2])\r\n * - getFull => getFull(arg[1])\r\n * - getFull => getFull(arg[1], arg[2])\r\n * - collect => collect()\r\n * - collect => collect(arg[1])\r\n * - collect => collect(arg[1], arg[2])\r\n *\r\n * @param {Object...} args Any other arguments that need to be passed to the model's call.\r\n */\r\ndd.controller.prototype.redraw = function(modelCall)\r\n{\r\n\tswitch(modelCall+arguments.length)\r\n\t{\r\n\t\tcase 'get2':\r\n\t\t\tthis.view.load(this.model.get(arguments[1]));\r\n\t\tbreak;\r\n\t\t\r\n\t\tcase 'get3':\r\n\t\t\tthis.view.load(this.model.get(arguments[1],arguments[2]));\r\n\t\tbreak;\r\n\t\t\r\n\t\tcase 'getFull2':\r\n\t\t\tthis.view.load(this.model.getFull(arguments[1]));\r\n\t\tbreak;\r\n\t\t\r\n\t\tcase 'getFull3':\r\n\t\t\tthis.view.load(this.model.getFull(arguments[1],arguments[2]));\r\n\t\tbreak;\r\n\t\t\r\n\t\tcase 'collect1':\r\n\t\t\tthis.view.load(this.model.collect());\r\n\t\tbreak;\r\n\t\t\r\n\t\tcase 'collect2':\r\n\t\t\tthis.view.load(this.model.collect(arguments[1]));\r\n\t\tbreak;\r\n\t\t\r\n\t\tcase 'collect3':\r\n\t\t\tthis.view.load(this.model.collect(arguments[1],arguments[2]));\r\n\t\tbreak;\r\n\t};\r\n\t\r\n\tthis.runView();\r\n};\r\n\r\n\r\n/**\r\n * @method moveXY\r\n * Repositions the box to the specified location.\r\n * @param {Number} x The left position of the box.\r\n * @param {Number} y The top position of the box.\r\n */\r\ndd.controller.prototype.moveXY = function(x,y)\r\n{\r\n\tif(this.refix)\r\n\t{\r\n\t\tx += document.documentElement.scrollLeft;\r\n\t\ty += document.documentElement.scrollTop;\r\n\t}\r\n\tthis.box.style.left = x+'px';\r\n\tthis.box.style.top = y+'px';\r\n};\r\n\r\n/**\r\n * @method move\r\n * Moves the box based on the given settings and the supplied event. This allows for the box to be\r\n * positioned in line with the mouse cursor easily.\r\n * @param {Object} event The event object supplied by a handler. \r\n */\r\ndd.controller.prototype.move = function(event)\r\n{\r\n\tif(typeof(event) === 'undefined')\r\n\t{\r\n\t\tevent = {\r\n\t\t\tclientY: 0,\r\n\t\t\tclientX: 0\r\n\t\t};\r\n\t}\r\n\t// Dynamic Repositioning\r\n\tif(this.repos)\r\n\t{\r\n\t\tvar top, left, vs;\r\n\t\t\r\n\t\t// There are different ways to position based on what we measure against\r\n\t\tswitch(this.boxData.position)\r\n\t\t{\r\n\t\t\tcase 'target':\r\n\t\t\t\tvs = [this.target.offsetHeight,this.target.offsetWidth];\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'mouse':\r\n\t\t\tcase 'viewport':\r\n\t\t\t\tvs = [\r\n\t\t\t\t\twindow.innerHeight || document.documentElement.clientHeight || document.body.clientHeight,\r\n\t\t\t\t\twindow.innerWidth || document.documentElement.clientWidth || document.body.clientWidth\r\n\t\t\t\t];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t\r\n\t\t// The actual repositioning\r\n\t\t// repos[0] is positioning from, top or bottom\r\n\t\tswitch(this.repos[0])\r\n\t\t{\r\n\t\t\tcase 'center':\r\n\t\t\t\ttop = vs[0]/2;\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'page':\r\n\t\t\t\ttop = vs[0];\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'mouse':\r\n\t\t\t\ttop = event.clientY;\r\n\t\t\t\tif(top < (vs[0]/2))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.repos[2] = 'bottom';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.repos[2] = 'top';\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t// repos[1] is positioning from, left or right\r\n\t\tswitch(this.repos[1])\r\n\t\t{\r\n\t\t\tcase 'center':\r\n\t\t\t\tleft = vs[1]/2;\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'page':\r\n\t\t\t\tleft = vs[1];\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'mouse':\r\n\t\t\t\tleft = event.clientX;\r\n\t\t\t\tif(left < (vs[1]/2))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.repos[3] = 'right';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.repos[3] = 'left';\r\n\t\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t// repos[2] is positioning to, top or bottom\r\n\t\tswitch(this.repos[2])\r\n\t\t{\r\n\t\t\tcase 'center':\r\n\t\t\t\ttop -= this.box.offsetHeight/2;\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'top':\r\n\t\t\t\ttop -= this.box.offsetHeight + this.boxData.offsetY;\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'bottom':\r\n\t\t\t\ttop += this.boxData.offsetY;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t// repos[3] is positioning to, left or right\r\n\t\tswitch(this.repos[3])\r\n\t\t{\r\n\t\t\tcase 'center':\r\n\t\t\t\tleft -= this.box.offsetWidth/2;\r\n\t\t\t\t//msh(top + ' -- ' + left + ' & ' + this.box.offsetHeight + ' -- ' + this.box.offsetWidth);\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'left':\r\n\t\t\t\tleft -= this.box.offsetWidth + this.boxData.offsetX;\r\n\t\t\tbreak;\r\n\t\t\t\r\n\t\t\tcase 'right':\r\n\t\t\t\tleft += this.boxData.offsetX;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t\r\n\t\tthis.moveXY(left,top);\r\n\t}\r\n};\r\n\r\n/**\r\n * @method show\r\n * Shows the box.\r\n */\r\ndd.controller.prototype.show = function()\r\n{\r\n\tif(!this.visible)\r\n\t{\r\n\t\tfn.removeClass(this.box,'ninja');\r\n\t\tthis.visible = true;\r\n\t\tthis.boxData.onShow.call(this);\r\n\t\tthis.onShow.call(this);\r\n\t}\r\n};\r\n\r\n/** \r\n * @method hide\r\n * Hides the box.\r\n */\r\ndd.controller.prototype.hide = function()\r\n{\r\n\tif(this.visible)\r\n\t{\r\n\t\tfn.addClass(this.box,'ninja');\r\n\t\tthis.visible = false;\r\n\t\tthis.boxData.onHide.call(this);\r\n\t\tthis.onHide.call(this);\r\n\t}\r\n};\r\n\r\n// Uses fn.addEvent, but 'this' is the controller, and target is box\r\n/**\r\n * @method addEvent\r\n * Adds an event to the box, however the scope of the callback will be the controller.\r\n * @param {String} event The event to listen for.\r\n * @param {Function} callback The function to execute when the event fires.\r\n */\r\ndd.controller.prototype.addEvent = function(event,callback)\r\n{\r\n\tvar self = this;\r\n\tfn.addEvent(this.target || fn.$(this.boxData.target)[0], event, (function(e)\r\n\t{\r\n\t\tcallback.call(self,e);\r\n\t}));\r\n};\r\n\r\n\r\n/**\r\n * @method reactive\r\n * This is the most commmon method for controllers to react to event information it controls digging\r\n * for data, button handling, similar event propogation restriction and success/fail events. It\r\n * expects a data object returned by fn.addEvent callbacks. This data object can be manipulated\r\n * before hand in order to change how reactive reacts\r\n * @param {Object} data The data object passed from an {@link Riot.DDragon.fn#addEvent} callback.\r\n */\r\ndd.controller.prototype.reactive = function(data)\r\n{\r\n\t// First: Extending out the event data\r\n\tvar basic = {\r\n\t\taction:'get',\r\n\t\treactDepth:5,\r\n\t\tstopSimilar:false,\r\n\t\tallowShow:true,\r\n\t\tallowMove:true,\r\n\t\tallowHide:true,\r\n\t\tallowModelChange:true,\r\n\t\tallowBoxCreate:true,\r\n\t\tonReactive:function(){},\r\n\t\tsuccess:function(){},\r\n\t\tfail:function(){},\r\n\t\texecute:true\r\n\t},\r\n\t\tpotential;\r\n\tdata = fn.rebase(data,basic);\r\n\t\r\n\t// Button Settings kill early\r\n\tif(data.buttonRestrict !== -1 && data.button !== data.buttonRestrict) return;\r\n\t\r\n\t// Get more data and kill process if there was no event to react to\r\n\tdata.info = fn.rgInfo(data.target,data.reactDepth);\r\n\tif(data.info === false)\r\n\t{\r\n\t\tif(data.allowHide)\r\n\t\t{\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t\tdata.fail.call(this,data);\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t// We give the controller and view a chance to respond to the data, then the onReactive setting here\r\n\t// Reactive events can return false to kill this process\r\n\tif(this.onReactive(data) === false ||\r\n\t\t(this.view && this.view.onReactive.call(this,data) === false) ||\r\n\t\t(data.onReactive.call(this,data) === false)\r\n\t){\r\n\t\tdata.execute = false;\r\n\t}\r\n\t\r\n\t// Kill false executes by this point\r\n\tif(data.execute === false)\r\n\t{\r\n\t\tdata.fail.call(this,data)\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t// Potential model change\r\n\tdata.info.wrongModel = (data.info.name !== this.model.name);\r\n\tdata.info.modelChange = data.info.wrongModel && data.allowModelChange;\r\n\tif(data.info.modelChange)\r\n\t{\r\n\t\tthis.newMV(data.info.name);\r\n\t}\r\n\telse if(data.info.wrongModel)\r\n\t{\r\n\t\treturn;\r\n\t}\r\n\t\r\n\t// Potential box creation\r\n\tif(data.allowBoxCreate && this.box === false)\r\n\t{\r\n\t\tthis.create();\r\n\t\t// Force a redraw\r\n\t\tthis.current = '';\r\n\t}\r\n\t\t\t\t\r\n\t// Check for an id change (or model change)\r\n\t// Run action if there was a change\r\n\tdata.info.idChange = (data.info.id !== this.current) || data.info.modelChange;\r\n\tif(data.info.idChange)\r\n\t{\r\n\t\tif(data.action === 'collect')\r\n\t\t{\r\n\t\t\tthis.redraw('collect');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.redraw(data.action,data.info.id);\r\n\t\t}\r\n\t\tthis.current = data.info.id;\r\n\t}\r\n\t\r\n\t// stop similar events\r\n\tif(data.stopSimilar)\r\n\t{\r\n\t\tvar subEvent = function(_data)\r\n\t\t{\r\n\t\t\t_data.event.stopPropagation();\r\n\t\t};\r\n\t\tfn.addEvent(this.box,data.type,subEvent);\r\n\t\tthis.onDestroy = function()\r\n\t\t{\r\n\t\t\tfn.removeEvent(this.box,data.type,subEvent);\r\n\t\t};\r\n\t}\r\n\t\r\n\t// show and move\r\n\tif(data.allowShow)\r\n\t{\r\n\t\tvar moveTest = this.visible;\r\n\t\tthis.show();\r\n\t\tif(data.allowMove || !moveTest)\r\n\t\t{\r\n\t\t\tthis.move(data.event);\r\n\t\t}\r\n\t}\r\n\tdata.success.call(this,data);\r\n};\r\n\r\n/*\r\n * Mixes addEvent with reactive\r\n */\r\n/**\r\n * @method addReactiveEvent\r\n * Combines the functionality of reactive and addEvent. This also allows for a global default to be\r\n * applied to the eventData prior to the call to reactive.\r\n * @param {String} event The event to listen for.\r\n * @param {Object} extendData The data to be applied to the eventData prior to execution.\r\n */\r\ndd.controller.prototype.addReactiveEvent = function(event,extendData)\r\n{\r\n\tthis.addEvent(event,function(eventData)\r\n\t{\r\n\t\tthis.reactive(fn.rebase(eventData,extendData || {}));\r\n\t});\r\n};\r\n\r\n/**\r\n * @method\r\n * @member Riot.DDragon\r\n * Destroys the controller associated with the specified box element.\r\n * @param {HTMLElement} elem The element that is being managed.\r\n */\r\ndd.destroyBox = function(elem)\r\n{\r\n\tvar contId = elem.getAttribute('data-control');\r\n\tif(contId !== null || contId !== '')\r\n\t{\r\n\t\tdd.controllers[contId].destroy();\r\n\t}\r\n\telse\r\n\t{\r\n\t\tfn.rmDiv(elem);\r\n\t}\r\n};\r\n\r\n/**\r\n * @method\r\n * @member Riot.DDragon\r\n * Creates a new controller with the specified box.\r\n * @param {String} box The box this controller manages.\r\n */\r\ndd.useController = function(box)\r\n{\r\n\treturn new dd.controller(box);\r\n};\r\n\r\n/**\r\n * @method\r\n * @member Riot.DDragon\r\n * Combines a modle, view, and controller into a single object.\r\n * @param {Boolean} create\r\n * Whether to create the box element or not. If this is not required, it can be dropped from the\r\n * argument list.\r\n * @param {String} model The name of the model to use in the view.\r\n * @param {String} view The name of the view to use.\r\n * @param {String} box The box the controller will manage.\r\n * @return {Riot.DDragon.controller} The created controller.\r\n */\r\ndd.buildController = function()\r\n{\r\n\t// Optional create parameter. If there are 4 parameters\r\n\tvar i = arguments.length, create = true;\r\n\tif(i === 4) create = arguments[0];\r\n\t\r\n\tvar c = dd.useController(arguments[i-1]);\r\n\tc.newMV(arguments[i-3],arguments[i-2]);\r\n\t\r\n\tif(create) c.create();\r\n\treturn c;\r\n};\r\ndd.players = {};\r\n\r\n/**\r\n * @class Riot.DDragon.player\r\n * A data container class representing total player character data, intended to be a bucket data holder\r\n * @param {Object} [options] Default data to store on to the player object at creation\r\n */\r\ndd.player = function(options)\r\n{\r\n\toptions = options || {};\r\n\tfn.rebase(this, options, {\r\n\t\tname: '',\r\n\t\tsummonerlevel: 30,\r\n\t\tchampion: false,\r\n\t\tlevel: 1,\r\n\t\tsummoner: [],\r\n\t\titem: [],\r\n\t\trune: {\r\n\t\t\tred: [],\r\n\t\t\tyellow: [],\r\n\t\t\tblue: [],\r\n\t\t\tblack: []\r\n\t\t},\r\n\t\tmastery: {},\r\n\t\tmasteryString: '',\r\n\t\tstacks: {}\r\n\t});\r\n\t\r\n\tvar masteryC = 3*6*4;\r\n\twhile(masteryC--) {\r\n\t\tthis.masteryString += '0';\r\n\t}\r\n\t\r\n\tthis.stats = this.basicStats();\r\n};\r\n\r\ndd.player.prototype.basicStats = function()\r\n{\r\r\n\treturn {\r\n\t\tarmor: 0,\r\n\t\tbasearmor: 0,\r\n\t\tbonusarmor: 0,\r\n\t\tspellblock: 0,\r\n\t\tbasespellblock: 0,\r\n\t\tbonusspellblock: 0,\r\n\t\tattackdamage: 0,\r\n\t\tspelldamage: 0,\r\n\t\tdodge: 0,\r\n\t\tflatarmorpenetration: 0,\r\n\t\tflatmagicpenetration: 0,\r\n\t\tpercentarmorpenetration: 0,\r\n\t\tpercentmagicpenetration: 0,\r\n\t\tcooldown: 0,\r\n\t\tcooldownsummoner: 0,\r\n\t\tattackrange: 0,\r\n\t\tattackspeed: 0,\r\n\t\tcrit: 0,\r\n\t\tcritdamage: 2,\r\n\t\thp: 0,\r\n\t\thpregen: 0,\r\n\t\tmp: 0,\r\n\t\tmpregen: 0,\r\n\t\tmovespeed: 300,\r\n\t\tgoldper10: 0,\r\n\t\ttimedead: 0\r\n\t};\r\n};\r\n\r\ndd.player.prototype.setMastery = function(id, points)\r\n{\r\n\tthis.mastery[id] = points;\r\n\tthis.updateMasteryStringFor(id);\r\n\treturn true;\r\n};\r\n\r\ndd.player.prototype.addMastery = function(id)\r\n{\r\n\tvar masteryModel = dd.useModel('mastery');\r\n\tif(!masteryModel.init)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\tvar mastery = masteryModel.get(id),\r\n\t\tcount = this.getMastery(id);\r\n\tif(count >= mastery.ranks)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\tthis.mastery[id] += 1;\r\n\tthis.updateMasteryStringFor(id);\r\n\treturn true;\r\n};\r\n\r\ndd.player.prototype.setMasteryByString = function(masteryString)\r\n{\r\n\tvar tree = 3+1,\r\n\t\tcol = 6+1,\r\n\t\trow = 4+1,\r\n\t\tpos, points, id;\r\n\t\r\n\twhile(--tree)\r\n\t{\r\n\t\twhile(--col)\r\n\t\t{\r\n\t\t\twhile(--row)\r\n\t\t\t{\r\n\t\t\t\tpos = tree*24 + col*4 + row;\r\n\t\t\t\tpoints = parseInt(masteryString.charAt(pos), 10);\r\n\t\t\t\tif(points) {\r\n\t\t\t\t\tid = (tree + '' + col + '' + row);\r\n\t\t\t\t\tthis.mastery[id] = points;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tthis.masteryString = masteryString;\r\n};\r\n\r\ndd.player.prototype.updateMasteryStringFor = function(id)\r\n{\r\n\tvar tree = parseInt(id.charAt(0), 10) -2,\r\n\t\tcol = parseInt(id.charAt(1), 10) -1,\r\n\t\trow = parseInt(id.charAt(2), 10) -1,\r\n\t\tpos = tree*24 + col*4 + row;\r\n\t\r\n\tthis.masteryString = this.masteryString.slice(0, pos) + this.mastery[id] + this.masteryString.slice(pos + 1);\r\n};\r\n\r\ndd.player.prototype.getMastery = function(id)\r\n{\r\n\tif(typeof this.mastery[id] === 'undefined')\r\n\t{\r\n\t\tthis.mastery[id] = 0;\r\n\t}\r\n\treturn this.mastery[id];\r\n};\r\n\r\ndd.player.prototype.setRune = function(id)\r\n{\r\n\tvar runeModel = dd.useModel('rune');\r\n\tif(!runeModel.init)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\tvar rune = runeModel.get(id),\r\n\t\ttype = rune.rune.type,\r\n\t\tcount = this.rune[type].length;\r\n\t\r\n\tif(\r\n\t\t(type === 'black' && count >= 3) ||\r\n\t\t(count >= 9)\r\n\t)\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\tthis.rune[type].push(rune.id);\r\n\treturn true;\r\n};\r\n\r\ndd.player.prototype.setChampion = function(id)\r\n{\r\n\tthis.champion = id;\r\n\treturn true;\r\n};\r\n\r\ndd.defaultPlayer = new dd.player();/**\r\n * @method\r\n * @member Riot.DDragon.fn\r\n * Uses a series of stats to figure out a champion's current attack speed\r\n * @param {Number} level The current champion level\r\n * @param {Number} offset The current champion's attack speed offset (in stats)\r\n * @param {Number} aspdper The current champion's attack speed per level\r\n * @param {Number} aspd (Optional) Attack speed bonus from other sources\r\n */\r\nfn.calcAspd = function(level, offset, aspdper, aspd)\r\n{\r\n\taspd = aspd || 0;\r\n\tvar i = 1/(1.6 * (1+offset)) * (1+aspd + aspdper*(level-1)/100);\r\n\treturn Math.round(i*1000)/1000;\r\n};\r\n\r\ndd._spellDataLink = function(calc, spell, spellLevel, player)\r\n{\r\n\tthis.calc = calc;\r\n\tthis.spell = spell;\r\n\tthis.spellLevel = spellLevel;\r\n\tthis.player = player;\r\n\t\r\n\tthis.data = fn.rebase({}, spell.datavalues);\r\n\tthis.generateLinks();\r\n};\r\n\r\ndd._spellDataLink.prototype.generateLinks = function()\r\n{\r\n\tvar i,j, v;\r\n\t\r\n\t// vars\r\n\tfor(i=0, j=this.spell.vars.length; i<j; ++i)\r\n\t{\r\n\t\tv = this.spell.vars[i];\r\n\t\tthis.data[v.key] = this.generateLink(v);\r\n\t}\r\n\t\r\n\t// effects\r\n\tfor(i=1, j=this.spell.effect.length; i<j; ++i)\r\n\t{\r\n\t\tthis.data['e'+i] = ( this.calc === 0 ?\r\n\t\t\tthis.spell.effectBurn[i] :\r\n\t\t\tthis.spell.effect[i][this.spellLevel-1]\r\n\t\t);\r\n\t}\r\n};\r\n\r\n/*\r\n * Basic Link Types:\r\n *   bonusattackdamage, attackdamage, bonushealth, health, abilitypower,\r\n *   bonusarmor, armor, bonusspellblock, spellblock, bonusmovespeed, movespeed,\r\n *   bonusmana, mana\r\n *\r\n * All basic links can be preceded by @dynamic. in order to clear out the ( ) around\r\n * them in calc levels less than 2 (calc by player == calc 2)\r\n *\r\n * Special Link Types:\r\n *   @text = should always be equivalent to default\r\n *   @cooldownchampion = uses spell cooldown reduction (player.cooldown)\r\n *   @cooldownsummoner = uses summoner spell cooldown reduction (player.cooldownsummoner)\r\n *   @stacks = Multiplicative based on spell stacks\r\n *   @player.* = Gets a direct stat from the player object (usually level)\r\n *   @special.* = Must have specialized code written just for it\r\n */\r\ndd._spellDataLink.prototype.generateLink = function(v)\r\n{\r\n\t// No Calculations, using primarily burned in values\r\n\tif(this.calc === 0)\r\n\t{\r\n\t\tswitch(v.link)\r\n\t\t{\r\n\t\t\tcase '@player.level':\r\n\t\t\t\treturn v.coeff[0] + ' - ' + v.coeff[v.coeff.length-1];\r\n\t\t\t\r\n\t\t\tcase '@cooldownsummoner':\r\n\t\t\tcase '@cooldownchampion':\r\n\t\t\t\treturn this.spell.cooldownBurn;\r\n\t\t\t\t\r\n\t\t\tcase '@stacks':\r\n\t\t\t\tif(typeof(v.coeff) === 'object')\r\n\t\t\t\t{\r\n\t\t\t\t\treturn v.coeff.join('/') + ' ' + fn.t('perStack');\r\n\t\t\t\t}\r\n\t\t\t\treturn v.coeff + ' ' + fn.t('perStack');\r\n\t\t\t\t\r\n\t\t\tdefault:\r\n\t\t\t\tif(v.link.indexOf('@dynamic.') === 0)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn ''; // (+{{ ... }}) / ({{ }})\r\n\t\t\t\t}\r\n\t\t\t\tif(typeof(v.coeff) === 'object')\r\n\t\t\t\t{\r\n\t\t\t\t\treturn v.coeff.join('/');\r\n\t\t\t\t}\r\n\t\t\t\treturn v.coeff;\r\n\t\t}\r\n\t}\r\n\t// Calculations are via the individual spell itself. No player calculations.\r\n\telse if(this.calc === 1)\r\n\t{\r\n\t\tswitch(v.link)\r\n\t\t{\r\n\t\t\tcase '@player.level':\r\n\t\t\t\treturn v.coeff[0] + ' - ' + v.coeff[v.coeff.length-1];\r\n\t\t\t\t\r\n\t\t\tcase '@stacks':\r\n\t\t\t\tif(typeof(v.coeff) === 'object')\r\n\t\t\t\t{\r\n\t\t\t\t\treturn v.coeff[this.spellLevel-1] + ' ' + fn.t('perStack');\r\n\t\t\t\t}\r\n\t\t\t\treturn v.coeff + ' ' + fn.t('perStack');\r\n\t\t\t\r\n\t\t\tcase '@cooldownsummoner':\r\n\t\t\tcase '@cooldownchampion':\r\n\t\t\t\treturn this.spell.cooldown[this.spellLevel-1];\r\n\t\t\t\t\r\n\t\t\tdefault:\r\n\t\t\t\tif(typeof(v.coeff) === 'object')\r\n\t\t\t\t{\r\n\t\t\t\t\treturn v.coeff[this.spellLevel-1];\r\n\t\t\t\t}\r\n\t\t\t\treturn v.coeff;\r\n\t\t}\r\n\t}\r\n\t// Calculations use all player stats, multiplying out coefficients and similar.\r\n\telse if(this.calc === 2)\r\n\t{\r\n\t\tswitch(v.link)\r\n\t\t{\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn '';\r\n};\r\n\r\n\r\n\r\ndd._spellDataLink.prototype.getLeveltip = function()\r\n{\r\n\t//return fn.format(this.spell.leveltip[].replace(/{%/g,'{{').replace(/%}/g,'}}'), data);\r\n};\r\n\r\ndd._spellDataLink.prototype.getTooltip = function()\r\n{\r\n\treturn fn.format(this.spell.tooltip, this.data);\r\n};\r\n\r\n/**\r\n * @method\r\n * @member Riot.DDragon.fn\r\n * Creates tooltip text out of a spell object and all the data that goes in to it\r\n * This is an expensive process, use it sparingly.\r\n * @param {Number} calc A determination of we're going to pull data and show the data.\r\n * Possible values:\r\n *   0: No calculations are performed and the preburned values are used.\r\n *   1: spellLevel is used to determine how spells are shown\r\n *   2: Same as 1, except coefficients are also calculated in to player data.\r\n * @param {Object} spell The spell object we're trying to get tooltip data off of\r\n * @param {Number} [spellLevel=1] The spell level we're referencing\r\n * @param {Riot.DDragon.player} [player=defaultPlayer] A player object to fill data in with\r\n */\r\ndd.spellDataLink = function(calc, spell, spellLevel, player)\r\n{\r\n\tspellLevel = spellLevel || 1;\r\n\tplayer = player || dd.defaultPlayer;\r\n\treturn new dd._spellDataLink(calc, spell, spellLevel, player);\r\n};\r\nif(typeof(w.rg_force_endapp) !== 'undefined')\r\n{\r\n\tw.rg_force_endapp();\r\n}\r\nelse\r\n{\r\n\t// The Default End Application\r\n\tdd.dynamicScan(fn.$('body')[0]);\r\n\t\r\n\tdd.endApp = {\r\n\t\ttooltip: dd.buildController('item','item_tooltip','tooltip'),\r\n\t\titemmodal: dd.buildController(false, 'item', 'item_modal', 'modal')\r\n\t};\r\n\t\r\n\t// Tooltips (All)\r\n\tdd.endApp.tooltip.addReactiveEvent('mousemove');\r\n\t\r\n\t// item modal\r\n\tdd.endApp.itemmodal.addReactiveEvent('click', {\r\n\t\tbuttonRestrict: 0,\r\n\t\tstopSimilar: true,\r\n\t\tallowModelChange: false,\r\n\t\taction: 'getFull',\r\n\t\tsuccess: function () {\r\n\t\t\tdd.endApp.tooltip.hide();\r\n\t\t}\r\n\t});\r\n}\r\n\r\n(function()\r\n{\r\n\t// Takes app data (as produced by addApp), checks for requirements\r\n\t// Executes based on presence of requirements. Otherwise delay executes\r\n\tfunction appCycle(app)\r\n\t{\r\n\t\tvar m;\r\n\t\treqstrip: for(m = 0;m < app.ms.length;++m)\r\n\t\t{\r\n\t\t\t// Strip out all requirements that are already loaded\r\n\t\t\twhile(dd.useModel(app.ms[m]).init)\r\n\t\t\t{\r\n\t\t\t\tapp.ms.splice(m,1);\r\n\t\t\t\tif(typeof(app.ms[m]) === 'undefined')\r\n\t\t\t\t{\r\n\t\t\t\t\tbreak reqstrip;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Respond to applications that will soon load\r\n\t\t\tfn.fire.plan('model',{index: m, app: app},function(planData,execData,fireId)\r\n\t\t\t{\r\n\t\t\t\tif(planData.app.ms[planData.index] === execData.name)\r\n\t\t\t\t{\r\n\t\t\t\t\tplanData.app.ms.splice(planData.index,1);\r\n\t\t\t\t\tif(planData.app.ms.length === 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tplanData.app.app();\r\n\t\t\t\t\t\tfn.fire.scrap(fireId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(app.ms.length === 0)\r\n\t\t{\r\n\t\t\tapp.app();\r\n\t\t}\r\n\t};\r\n\t\r\n\t/**\r\n\t* @method\r\n\t* @member Riot.DDragon\r\n\t* Adds an application definition to DataDragon.\r\n\t* @param {Array} ms The required models that need to be loaded before the app can be run.\r\n\t* @param {Function} app The function to execute once the models have been loaded.\r\n\t*/\r\n\tdd.addApp = function(ms,app)\r\n\t{\r\n\t\tappCycle({'app':app,'ms':ms});\r\n\t};\r\n\t\r\n\t// Execute all the apps added before\r\n\tvar i,j;\r\n\tfor(i = 0,j = dd.app.length;i<j;++i)\r\n\t{\r\n\t\tappCycle(dd.app[i]);\r\n\t}\r\n})();\r\n};\r\n\r\n/* END OF DDRAGON */"]},"metadata":{},"sourceType":"module"}